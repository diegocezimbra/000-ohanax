<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex, nofollow">
<title>09 — Microservices vs Monolito | Full-Stack Mastery</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;500;600;700;800&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--bg:#0c0e12;--bg2:#12151b;--bg3:#181c24;--bg4:#1e2330;
--text:#d4d8e0;--text2:#8b92a0;--text3:#5c6370;
--accent:#3dd68c;--accent2:#2bb87a;--accent-dim:rgba(61,214,140,.08);
--orange:#e8915a;--blue:#5b9cf5;--purple:#b07aee;--red:#e05c6c;--yellow:#e2c55a;--cyan:#56b6c2;
--code-bg:#0d1017;--code-border:#1a1f2a;
--card:#151921;--card-border:#1e2430;
--radius:12px;--radius-sm:8px;
}
html{scroll-behavior:smooth;font-size:16px}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);line-height:1.7;-webkit-font-smoothing:antialiased}
::selection{background:var(--accent);color:var(--bg)}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}

/* ── TOP NAV ── */
.topnav{position:fixed;top:0;left:0;right:0;height:56px;background:var(--bg2);border-bottom:1px solid var(--card-border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100;backdrop-filter:blur(12px)}
.topnav a{color:var(--text2);text-decoration:none;font-size:.82rem;font-weight:500;transition:color .2s}
.topnav a:hover{color:var(--accent)}
.topnav .nav-center{font-size:.75rem;color:var(--text3);font-weight:600;letter-spacing:1px;text-transform:uppercase}
.topnav .nav-center span{color:var(--accent)}
.topnav .nav-home{color:var(--text3);text-decoration:none;font-size:.82rem;font-weight:500;padding:4px 12px;border:1px solid var(--card-border);border-radius:var(--radius-sm);transition:all .2s;display:inline-flex;align-items:center;gap:4px}
.topnav .nav-home:hover{color:var(--accent);border-color:var(--accent);background:var(--accent-dim)}
.topnav .nav-right{display:flex;align-items:center;gap:12px}

/* ── PROGRESS BAR ── */
.progress-bar{position:fixed;top:56px;left:0;right:0;height:3px;background:var(--bg4);z-index:99}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .3s;border-radius:0 2px 2px 0}

/* ── MAIN ── */
.main{margin-top:64px;min-height:100vh}
.content{max-width:900px;margin:0 auto;padding:48px 32px 120px}

/* ── SECTIONS ── */
.section{margin-bottom:64px;scroll-margin-top:80px}
.section-num{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--accent);letter-spacing:2px;margin-bottom:8px;display:block}
.section h2{font-size:1.8rem;font-weight:700;letter-spacing:-.01em;margin-bottom:8px;line-height:1.3}
.section-line{width:48px;height:3px;background:var(--accent);border-radius:2px;margin-bottom:28px}
.section h3{font-size:1.15rem;font-weight:600;color:var(--text);margin:32px 0 12px;padding-left:14px;border-left:3px solid var(--accent)}
.section h4{font-size:.95rem;font-weight:600;color:var(--orange);margin:24px 0 8px}
.section p{color:var(--text2);margin-bottom:14px;font-size:.95rem}
.section p strong{color:var(--text);font-weight:600}
.section ul,.section ol{color:var(--text2);margin:8px 0 16px 20px;font-size:.9rem}
.section li{margin-bottom:6px;line-height:1.6}
.section li strong{color:var(--text);font-weight:600}
.section li code{background:var(--bg4);padding:2px 7px;border-radius:4px;font-size:.8rem;color:var(--orange);font-family:'JetBrains Mono',monospace}

/* ── CODE BLOCKS ── */
pre{background:var(--code-bg);border:1px solid var(--code-border);border-radius:var(--radius);padding:20px 24px;overflow-x:auto;margin:16px 0 20px;position:relative}
pre::before{content:attr(data-lang);position:absolute;top:8px;right:12px;font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;background:var(--bg4);padding:2px 8px;border-radius:4px}
code{font-family:'JetBrains Mono',monospace;font-size:.82rem;line-height:1.6;color:#c5cdd8}
p code,.inline-code{background:var(--bg4);padding:2px 7px;border-radius:4px;font-size:.82rem;color:var(--orange);font-family:'JetBrains Mono',monospace}
.kw{color:#c678dd}.fn{color:#61afef}.str{color:#98c379}.cm{color:#5c6370;font-style:italic}
.num{color:#d19a66}.ann{color:#e5c07b}.tp{color:#e06c75}.op{color:#56b6c2}

/* ── CARDS ── */
.card{background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);padding:24px;margin:16px 0}
.card-title{font-size:.8rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--accent);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card-title::before{content:'';width:8px;height:8px;background:var(--accent);border-radius:50%}
.card.blue .card-title{color:var(--blue)}.card.blue .card-title::before{background:var(--blue)}
.card.purple .card-title{color:var(--purple)}.card.purple .card-title::before{background:var(--purple)}
.card.orange .card-title{color:var(--orange)}.card.orange .card-title::before{background:var(--orange)}

/* ── DIAGRAMS ── */
.diagram{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;margin:20px 0;padding:24px;background:var(--bg3);border-radius:var(--radius);border:1px solid var(--card-border)}
.diagram-box{padding:12px 20px;border-radius:var(--radius-sm);font-size:.8rem;font-weight:600;text-align:center;min-width:120px}
.diagram-box.green{background:rgba(61,214,140,.12);border:1px solid rgba(61,214,140,.3);color:var(--accent)}
.diagram-box.blue{background:rgba(91,156,245,.12);border:1px solid rgba(91,156,245,.3);color:var(--blue)}
.diagram-box.purple{background:rgba(176,122,238,.12);border:1px solid rgba(176,122,238,.3);color:var(--purple)}
.diagram-box.orange{background:rgba(232,145,90,.12);border:1px solid rgba(232,145,90,.3);color:var(--orange)}
.diagram-box.red{background:rgba(224,92,108,.12);border:1px solid rgba(224,92,108,.3);color:var(--red)}
.diagram-box.cyan{background:rgba(86,182,194,.12);border:1px solid rgba(86,182,194,.3);color:var(--cyan)}
.diagram-arrow{color:var(--text3);font-size:1.2rem}

/* ── TIPS ── */
.tip{display:flex;gap:14px;padding:16px 20px;border-radius:var(--radius);margin:16px 0;font-size:.88rem;line-height:1.6}
.tip.good{background:rgba(61,214,140,.06);border:1px solid rgba(61,214,140,.15);color:var(--accent)}
.tip.warn{background:rgba(226,197,90,.06);border:1px solid rgba(226,197,90,.15);color:var(--yellow)}
.tip.info{background:rgba(91,156,245,.06);border:1px solid rgba(91,156,245,.15);color:var(--blue)}
.tip.bad{background:rgba(224,92,108,.06);border:1px solid rgba(224,92,108,.15);color:var(--red)}
.tip-icon{font-size:1.1rem;flex-shrink:0;margin-top:2px}

/* ── Q&A ── */
.qa{background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);margin:12px 0;overflow:hidden}
.qa-q{padding:16px 20px;font-weight:600;color:var(--text);cursor:pointer;display:flex;align-items:center;gap:10px;font-size:.9rem;transition:background .15s}
.qa-q:hover{background:var(--accent-dim)}
.qa-q::before{content:'Q';font-family:'JetBrains Mono',monospace;font-size:.65rem;background:var(--accent);color:var(--bg);padding:3px 7px;border-radius:4px;font-weight:700}
.qa-a{padding:0 20px 16px 20px;color:var(--text2);font-size:.88rem;display:none}
.qa.open .qa-a{display:block}
.qa.open .qa-q{border-bottom:1px solid var(--card-border)}

/* ── TABLES ── */
.table-wrap{overflow-x:auto;margin:16px 0 20px;border-radius:var(--radius);border:1px solid var(--card-border)}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th{background:var(--bg4);color:var(--accent);font-weight:600;text-transform:uppercase;font-size:.7rem;letter-spacing:1px;padding:12px 16px;text-align:left}
td{padding:10px 16px;border-top:1px solid var(--card-border);color:var(--text2)}
tr:hover td{background:var(--accent-dim)}

/* ── TAGS ── */
.tag-list{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
.tag{display:inline-block;padding:4px 12px;background:var(--bg3);border:1px solid var(--card-border);border-radius:16px;font-size:.72rem;color:var(--text2);font-weight:500;transition:all .2s}

/* ── QUIZ ── */
.quiz-section{margin-top:64px;padding-top:32px;border-top:2px solid var(--card-border)}
.quiz-section h3{border-left-color:var(--purple)}
.quiz-card{background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);padding:24px;margin:16px 0}
.quiz-question{font-weight:600;color:var(--text);margin-bottom:16px;font-size:.92rem;display:flex;gap:10px}
.quiz-question .q-num{font-family:'JetBrains Mono',monospace;color:var(--accent);font-size:.8rem;min-width:28px}
.quiz-options{display:flex;flex-direction:column;gap:8px;margin-bottom:8px}
.quiz-option{display:flex;align-items:center;gap:12px;padding:10px 16px;background:var(--bg3);border:1px solid var(--card-border);border-radius:var(--radius-sm);cursor:pointer;transition:all .2s;font-size:.88rem;color:var(--text2)}
.quiz-option:hover{border-color:var(--accent);background:var(--accent-dim)}
.quiz-option.selected{border-color:var(--accent);background:var(--accent-dim);color:var(--text)}
.quiz-option.correct{border-color:var(--accent);background:rgba(61,214,140,.15);color:var(--accent)}
.quiz-option.wrong{border-color:var(--red);background:rgba(224,92,108,.1);color:var(--red)}
.quiz-option input[type="radio"]{accent-color:var(--accent)}
.quiz-explanation{display:none;padding:12px 16px;background:var(--bg3);border-radius:var(--radius-sm);margin-top:8px;font-size:.82rem;color:var(--text2);border-left:3px solid var(--accent)}
.quiz-explanation.visible{display:block}
.quiz-actions{display:flex;gap:12px;margin-top:24px;flex-wrap:wrap}
.btn{padding:12px 28px;border-radius:var(--radius-sm);font-family:'Outfit',sans-serif;font-size:.88rem;font-weight:600;cursor:pointer;border:none;transition:all .2s}
.btn-primary{background:var(--accent);color:var(--bg)}
.btn-primary:hover{background:var(--accent2)}
.btn-secondary{background:var(--bg3);color:var(--text2);border:1px solid var(--card-border)}
.btn-secondary:hover{border-color:var(--accent);color:var(--accent)}
.btn:disabled{opacity:.4;cursor:not-allowed}
.quiz-result{display:none;padding:24px;background:var(--card);border:1px solid var(--card-border);border-radius:var(--radius);margin-top:24px;text-align:center}
.quiz-result.visible{display:block}
.quiz-score{font-size:2.4rem;font-weight:800;color:var(--accent);margin:8px 0}
.quiz-score.low{color:var(--red)}
.quiz-score.mid{color:var(--yellow)}

/* ── WIZARD NAV ── */
.wizard-nav{display:flex;justify-content:space-between;align-items:center;margin-top:64px;padding:32px 0;border-top:1px solid var(--card-border)}
.wizard-nav a{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:var(--bg3);border:1px solid var(--card-border);border-radius:var(--radius-sm);color:var(--text2);text-decoration:none;font-size:.88rem;font-weight:500;transition:all .2s}
.wizard-nav a:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}
.wizard-nav a.primary{background:var(--accent);color:var(--bg);border-color:var(--accent)}
.wizard-nav a.primary:hover{background:var(--accent2)}
.wizard-nav .wizard-home{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:var(--bg3);border:1px solid var(--card-border);border-radius:var(--radius-sm);color:var(--text2);text-decoration:none;font-size:.88rem;font-weight:500;transition:all .2s}
.wizard-nav .wizard-home:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

/* ── RESPONSIVE ── */
@media(max-width:768px){
.content{padding:32px 16px 80px}
.topnav{padding:0 12px}
.section h2{font-size:1.4rem}
}

/* ── ANIMATIONS ── */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.section{animation:fadeUp .5s ease both}
</style>
<script> var MemberSpace = window.MemberSpace || {"subdomain":"ohanax"}; (function(d){ var s = d.createElement("script"); s.src = "https://cdn.memberspace.com/scripts/widgets.js"; var e = d.getElementsByTagName("script")[0]; e.parentNode.insertBefore(s,e); }(document)); </script>
</head>
<body>
<!-- MemberSpace Extra Security -->
<style>#__memberspace_modal_protected_page{position:fixed;top:0;left:0;width:100%;height:100%;background:#0c0e12;z-index:2147483646}</style>
<div id="__memberspace_modal_protected_page"></div>

<!-- ── TOP NAVIGATION ── -->
<nav class="topnav">
<a href="08-mvc-mvp-mvvm-mvi.html">&#8592; Anterior</a>
<div class="nav-center">Seção <span>09</span> / 66</div>
<div class="nav-right"><a href="../fullstack-mastery.html" class="nav-home" title="Voltar ao Dashboard">&#8962; Home</a>
<a href="10-cqrs-event-sourcing.html">Próximo &#8594;</a></div>
</nav>
<div class="progress-bar"><div class="progress-bar-fill" style="width:13.6%"></div></div>

<!-- ── MAIN CONTENT ── -->
<div class="main">
<div class="content">

<div class="section">
<span class="section-num">SEÇÃO 09</span>
<h2>Microservices vs Monolito</h2>
<div class="section-line"></div>

<p>A decisão entre monolito e microservices é uma das mais impactantes na vida de um projeto. Escolher errado cedo custa <strong>meses de retrabalho</strong>. A verdade inconveniente: a maioria das startups que começou com microservices voltou para monolito. E a maioria das empresas que cresceu com monolito eventualmente precisou extrair serviços. O segredo esta em entender <strong>quando</strong> cada abordagem faz sentido — e conhecer o caminho do meio.</p>

<p>Esta seção cobre os três modelos arquiteturais, seus trade-offs reais, padrões de comunicação, estratégias de migração e as armadilhas que destroem projetos. Não e sobre qual é "melhor" — e sobre qual é <strong>certo para o seu contexto</strong>.</p>

<!-- ═══ MONOLITO ═══ -->
<h3>Monolito: A Base de Tudo</h3>

<p><strong>Monolito é uma única unidade de deploy.</strong> Todo o código — API, regras de negócio, acesso a dados — vive no mesmo processo, compartilha a mesma memória é o mesmo banco de dados. Quando você faz deploy, tudo vai junto.</p>

<h4>Tipos de Monolito</h4>
<ul>
<li><strong>Big Ball of Mud</strong> — Sem estrutura clara. Tudo depende de tudo. Mudar um módulo quebra outro. E o monolito que da ma fama ao modelo. A maioria dos sistemas legados se encaixa aqui</li>
<li><strong>Monolito Modular</strong> — Código organizado em módulos com fronteiras claras. Cada módulo tem sua interface publica e seus dados encapsulados. Pode ser extraido para microservice depois. <strong>E o melhor ponto de partida para 90% dos projetos</strong></li>
<li><strong>Monolito em Camadas (Layered)</strong> — Organizado por camada técnica (Controller, Service, Repository). Simples de entender, mas tende a criar dependências cruzadas entre domínios</li>
</ul>

<h4>Quando Monolito é a Escolha Certa</h4>
<ul>
<li><strong>Startups e MVPs</strong> — Velocidade de iteráção e tudo. Você não sabe quais são as fronteiras do seu domínio ainda</li>
<li><strong>Times pequenós (1-8 devs)</strong> — O overhead de microservices não se paga com times pequenos</li>
<li><strong>Dominios simples</strong> — Se seu sistema é um CRUD com pouca lógica complexa, microservices são overkill</li>
<li><strong>Quando não ha necessidade de escala independente</strong> — Se todos os módulos escalam juntos, um monolito é mais eficiente</li>
</ul>

<div class="tip good">
<span class="tip-icon">&#10022;</span>
<div><strong>Regra de ouro:</strong> Comece com um monolito modular. Extraia microservices somente quando a dor de manter tudo junto superar a dor de distribuir. Na prática, isso acontece quando times diferentes precisam deployar em ritmos diferentes.</div>
</div>

<!-- ═══ MICROSERVICES ═══ -->
<h3>Microservices: Serviços Independentes</h3>

<p><strong>Microservices são serviços pequenós é independentes, cada um com seu proprio banco de dados, deploy e ciclo de vida.</strong> Cada serviço representa uma capacidade de negócio e se comúnica com outros via rede (HTTP, gRPC, mensagens).</p>

<h4>Beneficios Reais</h4>
<ul>
<li><strong>Deploy independente</strong> — Time A deploya o serviço de pagamentos sem afetar o serviço de usuários. Reduz risco e acelera ciclos</li>
<li><strong>Diversidade tecnológica</strong> — Serviço de ML em Python, API em Node, processamento de video em Go. Cada serviço usa a melhor ferramenta</li>
<li><strong>Autonomia de times</strong> — Cada time e dono do seu serviço de ponta a ponta (build, deploy, monitor). Escala organizacional</li>
<li><strong>Isolamento de falhas</strong> — Se o serviço de recomendações cair, o checkout continua funcionando (se projetado com fallbacks)</li>
<li><strong>Escala independente</strong> — O serviço de busca precisa de 20 instancias? Escale só ele, sem gastar recursos nós outros</li>
</ul>

<h4>Custos Reais (que ninguem conta no tutorial)</h4>
<ul>
<li><strong>Complexidade de rede</strong> — Latencia, timeouts, retries, circuit breakers. Uma chamada local de 1ms vira uma chamada de rede de 50ms</li>
<li><strong>Consistência de dados</strong> — Sem transações ACID entre serviços. Eventual consistency é a norma, e é difícil de acertar</li>
<li><strong>Overhead operacional</strong> — Precisa de: service discovery, load balancing, logging distribuido, tracing, CI/CD por serviço, monitoring por serviço</li>
<li><strong>Debugging distribuido</strong> — Um request atravessa 5 serviços. Onde falhou? Precisa de tracing (Jaeger, Zipkin, Datadog)</li>
<li><strong>Complexidade de testes</strong> — Testes de integração precisam de múltiplos serviços rodando. Contract testing vira obrigatório</li>
</ul>

<div class="tip warn">
<span class="tip-icon">&#9888;</span>
<div><strong>Lei de Conway:</strong> "Organizacoes projetam sistemas que são copias de suas estruturas de comunicação." Microservices funcionam quando a estrutura organizacional já é distribuida. Se você tem um time so, microservices vao criar overhead sem benefício.</div>
</div>

<!-- ═══ MONOLITO MODULAR ═══ -->
<h3>Monolito Modular: O Melhor dos Dois Mundos</h3>

<p>O monolito modular combina a <strong>simplicidade operacional do monolito</strong> com a <strong>separacao de responsabilidades dos microservices</strong>. Cada módulo tem fronteiras claras, interfaces publicas definidas e dados encapsulados. A comunicação entre módulos acontece por interfaces, não por acesso direto ao banco.</p>

<h4>Estrutura de um Monolito Modular (NestJS)</h4>
<pre data-lang="text"><code>src/
├── modules/
│   ├── users/
│   │   ├── users.module.ts          <span class="cm">// NestJS module — fronteira do domínio</span>
│   │   ├── users.controller.ts      <span class="cm">// Interface HTTP publica</span>
│   │   ├── users.service.ts         <span class="cm">// Logica de negócio</span>
│   │   ├── users.repository.ts      <span class="cm">// Acessó a dados (encapsulado)</span>
│   │   ├── entities/
│   │   │   └── user.entity.ts
│   │   └── dto/
│   │       └── create-user.dto.ts
│   ├── orders/
│   │   ├── orders.module.ts
│   │   ├── orders.controller.ts
│   │   ├── orders.service.ts
│   │   ├── orders.repository.ts
│   │   └── interfaces/
│   │       └── user-lookup.interface.ts  <span class="cm">// Interface para depender de Users</span>
│   ├── payments/
│   │   ├── payments.module.ts
│   │   ├── payments.service.ts
│   │   └── ...
│   └── notifications/
│       ├── notifications.module.ts
│       └── ...
├── shared/                           <span class="cm">// Código compartilhado (cuidado!)</span>
│   ├── database/
│   └── common/
└── main.ts</code></pre>

<p><strong>Regras do Monolito Modular:</strong></p>
<ul>
<li>Modulos se comúnicam apenas por <strong>interfaces publicas</strong> (services exportados), nunca por acesso direto ao repositório de outro módulo</li>
<li>Cada módulo pode ter seu proprio <strong>schema/tabelas</strong> no banco — preparando para a separacao futura</li>
<li>O diretório <code>shared/</code> deve ser <strong>mínimo</strong> — apenas útilitarios genuinamente transversais</li>
<li>Testes de cada módulo devem rodar <strong>independentemente</strong> (mockando dependências externas)</li>
</ul>

<!-- ═══ DECOMPOSICAO ═══ -->
<h3>Estrategias de Decomposicao de Serviços</h3>

<p>Quando chega a hora de migrar, como decidir onde cortar? Existem três estratégias principais:</p>

<h4>1. Por Capacidade de Negocio (Business Capability)</h4>
<p>Cada serviço representa uma capacidade de negócio: <strong>Pagamentos</strong>, <strong>Gestão de Usuarios</strong>, <strong>Catalogo de Produtos</strong>, <strong>Logistica</strong>. E a abordagem mais intuitiva e alinhada com a organização.</p>

<h4>2. Por Subdomínio (DDD)</h4>
<p>Usando Domain-Driven Design, identifique <strong>Bounded Contexts</strong> é crie um serviço por contexto. Cada contexto tem seu proprio modelo de domínio, ubiquitous language e banco de dados. Um "Usuario" no contexto de Autenticação é diferente do "Usuario" no contexto de Pedidos.</p>

<h4>3. Strangler Fig Pattern (para migração gradual)</h4>
<p>Não reescreva tudo de uma vez. Coloque um <strong>proxy/API Gateway</strong> na frente do monolito. Gradualmente, extraia funcionalidades para novos serviços. O proxy roteia requests: funcionalidades migradas vao para os microservices, o resto continua no monolito.</p>

<div class="diagram">
<div class="diagram-box orange">Monolito<br><small>(sistema atual)</small></div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box blue">API Gateway<br><small>(proxy/router)</small></div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box green">Microservice A<br><small>(extraido)</small></div>
</div>
<div class="diagram">
<div class="diagram-box orange">Monolito<br><small>(menor)</small></div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box blue">API Gateway</div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box green">Service A</div>
<div class="diagram-arrow" style="visibility:hidden">&rarr;</div>
<div class="diagram-box green">Service B<br><small>(extraido)</small></div>
</div>
<div class="diagram">
<div class="diagram-box red">Monolito<br><small>(apósentado)</small></div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box blue">API Gateway</div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box green">Service A</div>
<div class="diagram-arrow" style="visibility:hidden">&rarr;</div>
<div class="diagram-box green">Service B</div>
<div class="diagram-arrow" style="visibility:hidden">&rarr;</div>
<div class="diagram-box green">Service C</div>
</div>

<!-- ═══ COMUNICACAO ═══ -->
<h3>Padroes de Comúnicação entre Serviços</h3>

<h4>Comúnicação Sincrona (Request/Response)</h4>
<ul>
<li><strong>REST (HTTP/JSON)</strong> — Mais simples, universalmente suportado. Bom para operações CRUD e queries simples. Overhead de serialização JSON</li>
<li><strong>gRPC (HTTP/2 + Protocol Buffers)</strong> — Mais rápido (binário), contrato forte via .proto files, streaming bidirecional. Ideal para comunicação interna entre serviços</li>
</ul>

<h4>Comúnicação Assíncrona (Event-Driven)</h4>
<ul>
<li><strong>Message Queues (RabbitMQ, SQS)</strong> — Produtor envia mensagem, consumidor processa quando puder. Desacoplamento temporal. Bom para tarefas em background</li>
<li><strong>Event Streaming (Kafka, EventBridge)</strong> — Eventos publicados em tópicos, múltiplos consumidores. Historico de eventos mantido. Ideal para event sourcing e pipelines de dados</li>
</ul>

<h4>Saga Pattern: Transacoes Distribuidas</h4>
<p>Em microservices não existe transação ACID entre serviços. O <strong>Saga Pattern</strong> coordena uma sequência de transações locais, com <strong>compensacoes</strong> em caso de falha. Existem dois estilos:</p>
<ul>
<li><strong>Coreografia</strong> — Cada serviço escuta eventos e reage. Não ha coordenador central. Mais simples, mas difícil de rastrear o fluxo</li>
<li><strong>Orquestracao</strong> — Um serviço coordenador (orchestrator) controla a sequência. Mais visível, mas cria ponto central</li>
</ul>

<h4>API Gateway</h4>
<p>Ponto de entrada único para todos os clientes. Responsavel por: roteamento, autenticação, raté limiting, agregação de respostas, transformacao de protocolo. Ferramentas: Kong, AWS API Gateway, Nginx, Traefik.</p>

<!-- ═══ PADROES DE DADOS ═══ -->
<h3>Padroes de Dados em Microservices</h3>

<ul>
<li><strong>Database per Service</strong> — Cada serviço tem seu proprio banco. Garante encapsulamento e independência. E o padrão recomendado</li>
<li><strong>Shared Database (anti-pattern)</strong> — Multiplos serviços acessam o mesmo banco. Cria acoplamento oculto — mudar uma tabela pode quebrar N serviços. Evite sempre que possível</li>
<li><strong>Eventual Consistency</strong> — Dados entre serviços não estão imediatamente sincronizados. Atualizacoes se propagam via eventos. A UI precisa lidar com estados intermediários</li>
<li><strong>CQRS</strong> — Separa modelo de leitura (query) do modelo de escrita (command). Cada serviço pode otimizar seu banco para o tipo de operação que mais faz</li>
</ul>

<!-- ═══ TABELA COMPARATIVA ═══ -->
<h3>Comparativo: Monolito vs Microservices vs Modular</h3>

<div class="table-wrap">
<table>
<thead>
<tr>
<th>Aspecto</th>
<th>Monolito Classico</th>
<th>Monolito Modular</th>
<th>Microservices</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Deploy</strong></td>
<td>Tudo junto, único artefato</td>
<td>Tudo junto, único artefato</td>
<td>Independente por serviço</td>
</tr>
<tr>
<td><strong>Complexidade inicial</strong></td>
<td>Baixa</td>
<td>Baixa-Media</td>
<td>Alta</td>
</tr>
<tr>
<td><strong>Escala</strong></td>
<td>Vertical (toda a app)</td>
<td>Vertical (toda a app)</td>
<td>Horizontal (por serviço)</td>
</tr>
<tr>
<td><strong>Consistência de dados</strong></td>
<td>ACID (transações locais)</td>
<td>ACID (transações locais)</td>
<td>Eventual (sagas, eventos)</td>
</tr>
<tr>
<td><strong>Latencia interna</strong></td>
<td>In-process (microseg)</td>
<td>In-process (microseg)</td>
<td>Network (miliseg)</td>
</tr>
<tr>
<td><strong>Autonomia de times</strong></td>
<td>Baixa (merge conflicts)</td>
<td>Media (módulos claros)</td>
<td>Alta (serviços independentes)</td>
</tr>
<tr>
<td><strong>Observabilidade</strong></td>
<td>Simples (1 processo)</td>
<td>Simples (1 processo)</td>
<td>Complexa (tracing distribuido)</td>
</tr>
<tr>
<td><strong>Custo operacional</strong></td>
<td>Baixo</td>
<td>Baixo</td>
<td>Alto (infra, CI/CD, monitoring)</td>
</tr>
<tr>
<td><strong>Ideal para</strong></td>
<td>Scripts, prototipos</td>
<td>Startups, times medios</td>
<td>Empresas grandes, multi-time</td>
</tr>
<tr>
<td><strong>Migracao futura</strong></td>
<td>Dificil (tudo acoplado)</td>
<td>Facil (módulos extraiveis)</td>
<td>Ja esta distribuido</td>
</tr>
</tbody>
</table>
</div>

<!-- ═══ EXEMPLOS DE CODIGO ═══ -->
<h3>Exemplos de Código</h3>

<h4>Monolito Modular: Comúnicação entre Modulos (NestJS)</h4>
<pre data-lang="typescript"><code><span class="cm">// ── modules/users/interfaces/user-lookup.interface.ts ──</span>
<span class="cm">// Interface publica que outros módulos usam para consultar usuários</span>
<span class="kw">export interface</span> <span class="tp">IUserLookup</span> {
  <span class="fn">findById</span>(id: <span class="tp">string</span>): <span class="tp">Promise</span>&lt;<span class="tp">UserSummary</span> | <span class="kw">null</span>&gt;;
  <span class="fn">findByEmail</span>(email: <span class="tp">string</span>): <span class="tp">Promise</span>&lt;<span class="tp">UserSummary</span> | <span class="kw">null</span>&gt;;
}

<span class="kw">export interface</span> <span class="tp">UserSummary</span> {
  id: <span class="tp">string</span>;
  name: <span class="tp">string</span>;
  email: <span class="tp">string</span>;
}

<span class="cm">// ── modules/users/users.module.ts ──</span>
<span class="ann">@Module</span>({
  providers: [
    <span class="tp">UsersService</span>,
    { provide: <span class="str">'USER_LOOKUP'</span>, useExisting: <span class="tp">UsersService</span> },
  ],
  exports: [<span class="str">'USER_LOOKUP'</span>], <span class="cm">// Exporta apenas a interface, não o serviço inteiro</span>
})
<span class="kw">export class</span> <span class="tp">UsersModule</span> {}

<span class="cm">// ── modules/orders/orders.service.ts ──</span>
<span class="cm">// Orders depende de Users via interface — não via acesso direto</span>
<span class="ann">@Injectable</span>()
<span class="kw">export class</span> <span class="tp">OrdersService</span> {
  <span class="kw">constructor</span>(
    <span class="ann">@Inject</span>(<span class="str">'USER_LOOKUP'</span>)
    <span class="kw">private</span> <span class="kw">readonly</span> userLookup: <span class="tp">IUserLookup</span>,
    <span class="kw">private</span> <span class="kw">readonly</span> ordersRepo: <span class="tp">OrdersRepository</span>,
  ) {}

  <span class="kw">async</span> <span class="fn">createOrder</span>(userId: <span class="tp">string</span>, dto: <span class="tp">CreateOrderDto</span>) {
    <span class="kw">const</span> user = <span class="kw">await</span> <span class="kw">this</span>.userLookup.<span class="fn">findById</span>(userId);
    <span class="kw">if</span> (!user) <span class="kw">throw new</span> <span class="tp">NotFoundException</span>(<span class="str">'Usuario não encontrado'</span>);

    <span class="kw">const</span> order = <span class="kw">new</span> <span class="tp">Order</span>();
    order.userId = user.id;
    order.userName = user.name;
    order.items = dto.items;
    order.total = <span class="kw">this</span>.<span class="fn">calculateTotal</span>(dto.items);

    <span class="kw">return</span> <span class="kw">this</span>.ordersRepo.<span class="fn">save</span>(order);
  }
}</code></pre>

<h4>Microservice: Comúnicação via HTTP (TypeScript)</h4>
<pre data-lang="typescript"><code><span class="cm">// ── orders-service/src/clients/users.client.ts ──</span>
<span class="cm">// Client HTTP para comúnicar com o Users Service</span>
<span class="ann">@Injectable</span>()
<span class="kw">export class</span> <span class="tp">UsersClient</span> {
  <span class="kw">private</span> <span class="kw">readonly</span> baseUrl: <span class="tp">string</span>;

  <span class="kw">constructor</span>(<span class="kw">private</span> http: <span class="tp">HttpService</span>, config: <span class="tp">ConfigService</span>) {
    <span class="kw">this</span>.baseUrl = config.<span class="fn">get</span>(<span class="str">'USERS_SERVICE_URL'</span>);
  }

  <span class="kw">async</span> <span class="fn">findById</span>(id: <span class="tp">string</span>): <span class="tp">Promise</span>&lt;<span class="tp">UserSummary</span> | <span class="kw">null</span>&gt; {
    <span class="kw">try</span> {
      <span class="kw">const</span> { data } = <span class="kw">await</span> firstValueFrom(
        <span class="kw">this</span>.http.<span class="fn">get</span>&lt;<span class="tp">UserSummary</span>&gt;(<span class="str">`${<span class="kw">this</span>.baseUrl}/users/${id}`</span>, {
          timeout: <span class="num">3000</span>, <span class="cm">// Timeout de 3s — crucial em microservices</span>
        })
      );
      <span class="kw">return</span> data;
    } <span class="kw">catch</span> (err) {
      <span class="kw">if</span> (err.response?.status === <span class="num">404</span>) <span class="kw">return null</span>;
      <span class="kw">throw new</span> <span class="tp">ServiceUnavailableException</span>(<span class="str">'Users service indisponível'</span>);
    }
  }
}

<span class="cm">// ── orders-service/src/orders.service.ts ──</span>
<span class="ann">@Injectable</span>()
<span class="kw">export class</span> <span class="tp">OrdersService</span> {
  <span class="kw">constructor</span>(
    <span class="kw">private</span> usersClient: <span class="tp">UsersClient</span>,  <span class="cm">// Chamada de rede ao inves de local</span>
    <span class="kw">private</span> ordersRepo: <span class="tp">OrdersRepository</span>,
    <span class="kw">private</span> eventBus: <span class="tp">EventBusClient</span>,  <span class="cm">// Para publicar eventos</span>
  ) {}

  <span class="kw">async</span> <span class="fn">createOrder</span>(userId: <span class="tp">string</span>, dto: <span class="tp">CreateOrderDto</span>) {
    <span class="kw">const</span> user = <span class="kw">await</span> <span class="kw">this</span>.usersClient.<span class="fn">findById</span>(userId);
    <span class="kw">if</span> (!user) <span class="kw">throw new</span> <span class="tp">NotFoundException</span>(<span class="str">'Usuario não encontrado'</span>);

    <span class="kw">const</span> order = <span class="kw">await</span> <span class="kw">this</span>.ordersRepo.<span class="fn">save</span>({
      userId: user.id,
      items: dto.items,
      total: <span class="kw">this</span>.<span class="fn">calculateTotal</span>(dto.items),
      status: <span class="str">'CREATED'</span>,
    });

    <span class="cm">// Publica evento para outros serviços reagirem</span>
    <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'order.created'</span>, {
      orderId: order.id,
      userId: order.userId,
      total: order.total,
      items: order.items,
    });

    <span class="kw">return</span> order;
  }
}</code></pre>

<h4>Saga Pattern: Coreografia com Eventos (TypeScript)</h4>
<pre data-lang="typescript"><code><span class="cm">// ═══ Saga: Criar Pedido → Reservar Estoque → Cobrar Pagamento</span>
<span class="cm">// Cada serviço escuta eventos e reage (coreografia)</span>

<span class="cm">// ── orders-service: cria pedido e publica evento ──</span>
<span class="kw">async</span> <span class="fn">createOrder</span>(dto: <span class="tp">CreateOrderDto</span>) {
  <span class="kw">const</span> order = <span class="kw">await</span> <span class="kw">this</span>.repo.<span class="fn">save</span>({ ...dto, status: <span class="str">'PENDING'</span> });
  <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'order.created'</span>, { orderId: order.id, items: order.items });
  <span class="kw">return</span> order;
}

<span class="cm">// ── inventory-service: escuta order.created, reserva estoque ──</span>
<span class="ann">@EventHandler</span>(<span class="str">'order.created'</span>)
<span class="kw">async</span> <span class="fn">handleOrderCreated</span>(event: <span class="tp">OrderCreatedEvent</span>) {
  <span class="kw">try</span> {
    <span class="kw">await</span> <span class="kw">this</span>.<span class="fn">reserveItems</span>(event.items);
    <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'inventory.reserved'</span>, {
      orderId: event.orderId,
      items: event.items,
    });
  } <span class="kw">catch</span> (err) {
    <span class="cm">// Compensacao: notifica que estoque falhou</span>
    <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'inventory.failed'</span>, {
      orderId: event.orderId,
      reason: err.message,
    });
  }
}

<span class="cm">// ── payment-service: escuta inventory.reserved, cobra pagamento ──</span>
<span class="ann">@EventHandler</span>(<span class="str">'inventory.reserved'</span>)
<span class="kw">async</span> <span class="fn">handleInventoryReserved</span>(event: <span class="tp">InventoryReservedEvent</span>) {
  <span class="kw">try</span> {
    <span class="kw">await</span> <span class="kw">this</span>.<span class="fn">chargeCustomer</span>(event.orderId);
    <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'payment.success'</span>, { orderId: event.orderId });
  } <span class="kw">catch</span> (err) {
    <span class="cm">// Compensacao: cancela pagamento e libera estoque</span>
    <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'payment.failed'</span>, {
      orderId: event.orderId,
      reason: err.message,
    });
  }
}

<span class="cm">// ── orders-service: escuta resultados finais ──</span>
<span class="ann">@EventHandler</span>(<span class="str">'payment.success'</span>)
<span class="kw">async</span> <span class="fn">handlePaymentSuccess</span>(event: <span class="tp">PaymentSuccessEvent</span>) {
  <span class="kw">await</span> <span class="kw">this</span>.repo.<span class="fn">update</span>(event.orderId, { status: <span class="str">'CONFIRMED'</span> });
}

<span class="ann">@EventHandler</span>(<span class="str">'inventory.failed'</span>)
<span class="kw">async</span> <span class="fn">handleInventoryFailed</span>(event: <span class="tp">InventoryFailedEvent</span>) {
  <span class="kw">await</span> <span class="kw">this</span>.repo.<span class="fn">update</span>(event.orderId, { status: <span class="str">'CANCELLED'</span> });
}

<span class="ann">@EventHandler</span>(<span class="str">'payment.failed'</span>)
<span class="kw">async</span> <span class="fn">handlePaymentFailed</span>(event: <span class="tp">PaymentFailedEvent</span>) {
  <span class="kw">await</span> <span class="kw">this</span>.repo.<span class="fn">update</span>(event.orderId, { status: <span class="str">'CANCELLED'</span> });
  <span class="cm">// Compensa: libera estoque reservado</span>
  <span class="kw">await</span> <span class="kw">this</span>.eventBus.<span class="fn">publish</span>(<span class="str">'order.cancelled'</span>, { orderId: event.orderId });
}</code></pre>

<h4>Docker Compose: Microservices Local</h4>
<pre data-lang="yaml"><code><span class="cm"># docker-compose.yml — ambiente local com microservices</span>
<span class="tp">version</span>: <span class="str">'3.8'</span>

<span class="tp">services</span>:
  <span class="cm"># ── API Gateway ──</span>
  <span class="tp">gateway</span>:
    <span class="tp">build</span>: <span class="str">./gateway</span>
    <span class="tp">ports</span>:
      - <span class="str">"3000:3000"</span>
    <span class="tp">environment</span>:
      - <span class="str">USERS_SERVICE_URL=http://users:3001</span>
      - <span class="str">ORDERS_SERVICE_URL=http://orders:3002</span>
      - <span class="str">PAYMENTS_SERVICE_URL=http://payments:3003</span>
    <span class="tp">depends_on</span>:
      - <span class="str">users</span>
      - <span class="str">orders</span>
      - <span class="str">payments</span>

  <span class="cm"># ── Users Service ──</span>
  <span class="tp">users</span>:
    <span class="tp">build</span>: <span class="str">./users-service</span>
    <span class="tp">ports</span>:
      - <span class="str">"3001:3001"</span>
    <span class="tp">environment</span>:
      - <span class="str">DATABASE_URL=postgres://user:pass@users-db:5432/users</span>
    <span class="tp">depends_on</span>:
      - <span class="str">users-db</span>

  <span class="cm"># ── Orders Service ──</span>
  <span class="tp">orders</span>:
    <span class="tp">build</span>: <span class="str">./orders-service</span>
    <span class="tp">ports</span>:
      - <span class="str">"3002:3002"</span>
    <span class="tp">environment</span>:
      - <span class="str">DATABASE_URL=postgres://user:pass@orders-db:5432/orders</span>
      - <span class="str">USERS_SERVICE_URL=http://users:3001</span>
      - <span class="str">RABBITMQ_URL=amqp://rabbit:5672</span>
    <span class="tp">depends_on</span>:
      - <span class="str">orders-db</span>
      - <span class="str">rabbit</span>

  <span class="cm"># ── Payments Service ──</span>
  <span class="tp">payments</span>:
    <span class="tp">build</span>: <span class="str">./payments-service</span>
    <span class="tp">ports</span>:
      - <span class="str">"3003:3003"</span>
    <span class="tp">environment</span>:
      - <span class="str">DATABASE_URL=postgres://user:pass@payments-db:5432/payments</span>
      - <span class="str">RABBITMQ_URL=amqp://rabbit:5672</span>
    <span class="tp">depends_on</span>:
      - <span class="str">payments-db</span>
      - <span class="str">rabbit</span>

  <span class="cm"># ── Databases (um por serviço) ──</span>
  <span class="tp">users-db</span>:
    <span class="tp">image</span>: <span class="str">postgres:16-alpine</span>
    <span class="tp">environment</span>:
      <span class="tp">POSTGRES_DB</span>: <span class="str">users</span>
      <span class="tp">POSTGRES_USER</span>: <span class="str">user</span>
      <span class="tp">POSTGRES_PASSWORD</span>: <span class="str">pass</span>

  <span class="tp">orders-db</span>:
    <span class="tp">image</span>: <span class="str">postgres:16-alpine</span>
    <span class="tp">environment</span>:
      <span class="tp">POSTGRES_DB</span>: <span class="str">orders</span>
      <span class="tp">POSTGRES_USER</span>: <span class="str">user</span>
      <span class="tp">POSTGRES_PASSWORD</span>: <span class="str">pass</span>

  <span class="tp">payments-db</span>:
    <span class="tp">image</span>: <span class="str">postgres:16-alpine</span>
    <span class="tp">environment</span>:
      <span class="tp">POSTGRES_DB</span>: <span class="str">payments</span>
      <span class="tp">POSTGRES_USER</span>: <span class="str">user</span>
      <span class="tp">POSTGRES_PASSWORD</span>: <span class="str">pass</span>

  <span class="cm"># ── Message Broker ──</span>
  <span class="tp">rabbit</span>:
    <span class="tp">image</span>: <span class="str">rabbitmq:3-management-alpine</span>
    <span class="tp">ports</span>:
      - <span class="str">"5672:5672"</span>
      - <span class="str">"15672:15672"</span>   <span class="cm"># Management UI</span></code></pre>

<!-- ═══ MINI SYSTEM DESIGN ═══ -->
<h3>Mini System Design: Quando Migrar de Monolito para Microservices</h3>

<p><strong>Cenário:</strong> Sua startup cresceu de 5 para 40 desenvolvedores. O monolito tem 200k linhas. Deploy leva 45 minutos. Um bug no módulo de recomendações derrubou o checkout na semana passada. Tres times estão esperando merge do mesmo arquivo. E hora de migrar?</p>

<div class="card blue">
<div class="card-title">Matriz de Decisao: Quando Microservices Fazem Sentido</div>
<ul>
<li><strong>Time > 15 devs</strong> com conflitos frequentes de merge e deploys bloqueados</li>
<li><strong>Necessidade de escala independente</strong> — ex: serviço de busca precisa de 10x mais recursos que o CRUD de usuários</li>
<li><strong>Dominio bem definido</strong> — você já sabe onde estão as fronteiras de negócio (Bounded Contexts claros)</li>
<li><strong>Falha em cascata</strong> — um módulo derruba todos os outros (e você precisa de isolamento de falha)</li>
<li><strong>Requisitos tecnológicos diferentes</strong> — um serviço precisa de GPU para ML, outro e IO-bound</li>
<li><strong>Frequencia de deploy diferentes</strong> — time de pagamentos deploya 1x/semana, time de catalog deploya 5x/dia</li>
</ul>
</div>

<div class="card orange">
<div class="card-title">Sinais de que NAO e hora de migrar</div>
<ul>
<li><strong>Time < 10 devs</strong> — o overhead operacional não se paga</li>
<li><strong>Você não consegue definir as fronteiras</strong> — se não sabe onde cortar, vai criar um monolito distribuido</li>
<li><strong>Sem observabilidade básica</strong> — se não tem logging, monitoring e alerting no monolito, vai ter caos em microservices</li>
<li><strong>Motivacao e "esta na moda"</strong> — microservices são uma solução para problemas organizacionais e de escala, não uma badge de senioridade</li>
</ul>
</div>

<p><strong>Caminho recomendado:</strong></p>
<div class="diagram">
<div class="diagram-box orange">Big Ball of Mud</div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box blue">Monolito Modular</div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box green">Strangler Fig</div>
<div class="diagram-arrow">&rarr;</div>
<div class="diagram-box purple">Microservices<br><small>(gradual)</small></div>
</div>

<p>A chave é que cada passó e <strong>incremental e reversivel</strong>. Você não precisa migrar tudo de uma vez. Comece pelo módulo que mais da dor (deploys travados, escala diferente, time diferente) e extraia apenas ele.</p>

<!-- ═══ ARMADILHAS ═══ -->
<h3>Armadilhas Comuns</h3>

<div class="tip bad">
<span class="tip-icon">&#10060;</span>
<div><strong>Comecar com microservices (distribuição prematura):</strong> O maior erro em arquitetura moderna. Você não conhece o domínio, não sabe onde estão as fronteiras, e esta adicionando complexidade de rede, dados e operações a um sistema que poderia ser um monolito simples. "Se você não consegue construir um monolito bem estruturado, o que faz você pensar que consegue projetar microservices?" — Simon Brown</div>
</div>

<div class="tip bad">
<span class="tip-icon">&#10060;</span>
<div><strong>Monolito distribuido (tight coupling entre serviços):</strong> E o pior dos dois mundos. Tem toda a complexidade operacional de microservices com todo o acoplamento de um monolito. Sintomas: deploy de um serviço exige deploy de outros, serviços compartilham banco, mudança em um contrato quebra N serviços. Se você precisa deployar 3 serviços juntos, você não tem microservices — tem um monolito com latência de rede.</div>
</div>

<div class="tip bad">
<span class="tip-icon">&#10060;</span>
<div><strong>Banco de dados compartilhado entre serviços:</strong> Destroi a independência dos serviços. Se Orders e Payments leem a mesma tabela, uma migração de schema pode quebrar ambos. Cada serviço deve ter seu proprio banco, mesmo que isso signifique duplicação controlada de dados.</div>
</div>

<div class="tip warn">
<span class="tip-icon">&#9888;</span>
<div><strong>Não investir em observabilidade antes de dividir:</strong> Antes de criar microservices, você PRECISA ter: logging centralizado (ELK, CloudWatch), distributed tracing (Jaeger, Datadog), métricas e alertas (Prometheus, Grafana), health checks. Sem isso, você vai gastar 80% do tempo debugando problemas de comunicação entre serviços.</div>
</div>

<div class="tip good">
<span class="tip-icon">&#10022;</span>
<div><strong>Regra prática de Martin Fowler:</strong> "Monolith First — quase todos os casos de microservices bem-sucedidos começaram como um monolito que ficou grande demais e foi decomposto." A migração gradual (Strangler Fig) e quase sempre melhor que a reescrita completa.</div>
</div>

<!-- ═══ EXERCICIOS PRATICOS ═══ -->
<h3>Exercícios Praticos</h3>

<div class="qa">
<div class="qa-q" onclick="this.parentElement.classList.toggle('open')">Exercício 1: Sua empresa tem 6 desenvolvedores é um monolito Django com 50k linhas. O CTO quer migrar para microservices porque "e o que empresas serias usam". Como você argumentaria?</div>
<div class="qa-a">
<p><strong>Resposta:</strong> Com 6 devs e 50k linhas, microservices vao <strong>desacelerar</strong> o time. O overhead operacional (CI/CD por serviço, infra distribuida, tracing, consistência eventual) não se paga com um time pequeno. A abordagem correta e: (1) organizar o monolito em <strong>módulos com fronteiras claras</strong> (Monolito Modular), (2) garantir que cada módulo comúnica via interfaces, não acesso direto ao banco, (3) investir em observabilidade (logs, métricas). Quando (e se) o time crescer para 20+ devs e os módulos precisarem de deploy independente, extraia microservices gradualmente via Strangler Fig. Cite Martin Fowler: "Monolith First."</p>
</div>
</div>

<div class="qa">
<div class="qa-q" onclick="this.parentElement.classList.toggle('open')">Exercício 2: Você tem 3 microservices: Orders, Inventory e Payments. Um pedido precisa reservar estoque E cobrar pagamento. Se o pagamento falhar, o estoque precisa ser liberado. Como resolver sem transação distribuida?</div>
<div class="qa-a">
<p><strong>Resposta:</strong> Use o <strong>Saga Pattern com coreografia</strong>. Fluxo: (1) Orders publica <code>order.created</code>, (2) Inventory escuta, reserva estoque, publica <code>inventory.reserved</code>, (3) Payments escuta, cobra, publica <code>payment.success</code> ou <code>payment.failed</code>, (4) Se <code>payment.failed</code>, Orders publica <code>order.cancelled</code>, (5) Inventory escuta <code>order.cancelled</code> é libera o estoque (compensação). Cada serviço é responsável por sua compensação. Use um message broker (RabbitMQ/Kafka) para garantir entrega. Considere idempotencia em cada handler para lidar com retries.</p>
</div>
</div>

<div class="qa">
<div class="qa-q" onclick="this.parentElement.classList.toggle('open')">Exercício 3: Dois microservices (Users e Orders) precisam do nome do usuário. Users é a fonte da verdade. Como Orders obtém essa informação sem compartilhar banco?</div>
<div class="qa-a">
<p><strong>Resposta:</strong> Tres opcoes: (1) <strong>Chamada síncrona</strong> — Orders chama <code>GET /users/:id</code> no momento que precisa. Simples, mas cria dependência de disponibilidade. Use circuit breaker. (2) <strong>Dados cacheados via eventos</strong> — Users publica <code>user.updated</code> com nome. Orders escuta e salva uma copia local (projecao). Não depende de Users estar online, mas o dado pode estar defasado (eventual consistency). (3) <strong>API Composition no Gateway</strong> — O gateway busca dados de ambos os serviços e combina. A opcao 2 é geralmente a melhor para dados acessados frequentemente.</p>
</div>
</div>

</div><!-- /section -->

<!-- ═══════════════════ QUIZ ═══════════════════ -->
<div class="quiz-section">
<h3>Quiz — Microservices vs Monolito</h3>
<p style="color:var(--text2);margin-bottom:24px;font-size:.9rem">Teste seus conhecimentos. 10 perguntas de multipla escolha. Sua pontuação será salva localmente.</p>

<div id="quiz-container"></div>

<div class="quiz-actions">
<button class="btn btn-primary" id="btn-submit" onclick="submitQuiz()">Verificar Respostas</button>
<button class="btn btn-secondary" id="btn-retry" onclick="resetQuiz()" style="display:none">Refazer Quiz</button>
</div>

<div class="quiz-result" id="quiz-result">
<p style="color:var(--text3);font-size:.8rem;text-transform:uppercase;letter-spacing:1px">Sua Pontuação</p>
<div class="quiz-score" id="quiz-score">0/10</div>
<p style="color:var(--text2);font-size:.88rem" id="quiz-message"></p>
</div>
</div>

<!-- ═══════════════════ WIZARD NAV ═══════════════════ -->
<div class="wizard-nav">
<a href="08-mvc-mvp-mvvm-mvi.html">&#8592; MVC/MVP/MVVM/MVI</a>
<a href="../fullstack-mastery.html" class="wizard-home" title="Voltar ao Dashboard">&#8962; Home</a>
<a href="10-cqrs-event-sourcing.html" class="primary">Próximo: CQRS &amp; Event Sourcing &#8594;</a>
</div>

</div><!-- /content -->
</div><!-- /main -->

<script>
// ══════════════════════════════════════════
// QUIZ DATA — Seção 09: Microservices vs Monolito
// ══════════════════════════════════════════
const SECTION_NUM = 9;
const STORAGE_KEY = 'fsm_quiz_' + SECTION_NUM;

const QUIZ_DATA = [
  {
    question: "Qual é a principal vantagem do Monolito Modular sobre o Monolito Classico?",
    options: [
      "Deploy independente por módulo",
      "Fronteiras claras entre módulos, fácilitando futura extracao para microservices",
      "Cada módulo roda em seu proprio processo",
      "Permite usar diferentes linguagens por módulo"
    ],
    correct: 1,
    explanation: "O Monolito Modular mantém a simplicidade operacional de um único deploy, mas organiza o código com fronteiras claras entre módulos. Isso fácilita a extracao futura para microservices quando necessário, sem o overhead de distribuição."
  },
  {
    question: "Qual é o maior risco de começar um projeto com microservices desde o dia 1?",
    options: [
      "O custo de infraestrutura será muito alto",
      "Não é possível usar TypeScript com microservices",
      "Você não conhece as fronteiras do domínio e vai criar um monolito distribuido",
      "Microservices não suportam bancos relacionais"
    ],
    correct: 2,
    explanation: "Sem conhecer bem o domínio, você vai definir fronteiras erradas entre serviços. O resultado é um 'monolito distribuido' — toda a complexidade de microservices com todo o acoplamento de um monolito. Martin Fowler recomenda 'Monolith First'."
  },
  {
    question: "O que é o Strangler Fig Pattern?",
    options: [
      "Um padrão para testes de integração entre microservices",
      "Uma técnica de cache distribuido entre serviços",
      "Uma estratégia de migração gradual do monolito para microservices usando um proxy",
      "Um padrão de compensação em transações distribuidas"
    ],
    correct: 2,
    explanation: "O Strangler Fig Pattern coloca um proxy/API Gateway na frente do monolito e gradualmente redireciona funcionalidades para novos microservices. O monolito vai 'encolhendo' até ser apósentado. E mais seguro que reescrever tudo de uma vez."
  },
  {
    question: "Qual é o anti-pattern mais comum ao adotar microservices?",
    options: [
      "Usar REST ao inves de gRPC",
      "Compartilhar banco de dados entre serviços",
      "Ter poucos serviços (menós de 10)",
      "Usar Docker para deploy"
    ],
    correct: 1,
    explanation: "Compartilhar banco de dados entre serviços destroi a independência. Uma migração de schema pode quebrar múltiplos serviços. Cada serviço deve ter seu proprio banco. Dados compartilhados devem ser sincronizados via eventos ou chamadas de API."
  },
  {
    question: "No Saga Pattern com coreografia, como funciona a coordenacao entre serviços?",
    options: [
      "Um serviço central (orchestrator) envia comandos para cada serviço na sequência",
      "Cada serviço escuta eventos e reage publicando seus proprios eventos, sem coordenador central",
      "Todos os serviços compartilham uma transação distribuida via 2PC",
      "O API Gateway coordena a sequência de chamadas"
    ],
    correct: 1,
    explanation: "Na coreografia, não ha coordenador central. Cada serviço escuta eventos relevantes, executa sua lógica local, e publica novos eventos. Em caso de falha, publica eventos de compensação. E mais desacoplado, mas pode ser difícil de rastrear o fluxo completo."
  },
  {
    question: "Qual ferramenta é essencial ANTES de migrar para microservices?",
    options: [
      "Kubernetes",
      "GraphQL",
      "Observabilidade: logging centralizado, distributed tracing e métricas",
      "Service mesh (Istio)"
    ],
    correct: 2,
    explanation: "Sem observabilidade (logging, tracing, métricas), debugar problemas em microservices e práticamente impossível. Um request pode atravessar 5 serviços — você precisa saber onde falhou. Kubernetes e service mesh são uteis, mas observabilidade e pre-requisito."
  },
  {
    question: "Qual afirmacao sobre a Lei de Conway esta CORRETA?",
    options: [
      "Sistemas distribuídos são sempre mais rápidos que monolitos",
      "Organizacoes projetam sistemas que espelham suas estruturas de comunicação",
      "Microservices só funcionam com times de mais de 100 pessoas",
      "A lei se aplica apenas a empresas de tecnologia"
    ],
    correct: 1,
    explanation: "A Lei de Conway diz que a arquitetura de um sistema tende a refletir a estrutura organizacional. Times pequenós e coesos produzem monolitos coesos. Times distribuídos e autônomos produzem microservices naturalmente. Forca a arquitetura a seguir a organização."
  },
  {
    question: "Qual é a diferença principal entre comunicação síncrona e assíncrona em microservices?",
    options: [
      "Sincrona usa JSON e assíncrona usa XML",
      "Sincrona bloqueia esperando resposta (request/response); assíncrona usa eventos/mensagens sem esperar resposta imediata",
      "Sincrona é mais rápida porque usa HTTP/2",
      "Assíncrona só funciona com Kafka"
    ],
    correct: 1,
    explanation: "Na comunicação síncrona (REST, gRPC), o chamador espera a resposta. Na assíncrona (eventos, filas), o produtor envia a mensagem e continua — o consumidor processa quando puder. Assíncrona desacopla temporalmente os serviços e é mais resiliente."
  },
  {
    question: "Um 'monolito distribuido' e caracterizado por:",
    options: [
      "Um monolito que roda em múltiplos servidores via load balancer",
      "Microservices que precisam ser deployados juntos e compartilham banco de dados",
      "Um monolito que usa Docker para deploy",
      "Um sistema com mais de 50 microservices"
    ],
    correct: 1,
    explanation: "O monolito distribuido é o pior dos mundos: tem toda a complexidade operacional de microservices (rede, deploy, monitoring) com todo o acoplamento de um monolito (deploy conjunto obrigatório, banco compartilhado). Se você precisa deployar N serviços juntos, não são microservices."
  },
  {
    question: "Qual abordagem Martin Fowler recomenda como ponto de partida para a maioria dos projetos?",
    options: [
      "Microservices desde o início com DDD rigoroso",
      "Serverless com funções independentes",
      "Monolith First — comece com monolito e decomponha quando necessário",
      "Micro-frontends com backend distribuido"
    ],
    correct: 2,
    explanation: "Martin Fowler defende 'Monolith First': quase todos os casos de sucessó com microservices começaram como monolitos que cresceram e foram decompostos. Comecar distribuido sem conhecer o domínio leva a fronteiras erradas e monolitos distribuídos."
  }
];

// ══════════════════════════════════════════
// QUIZ ENGINE
// ══════════════════════════════════════════
let submitted = false;

function renderQuiz() {
  const container = document.getElementById('quiz-container');
  let html = '';

  QUIZ_DATA.forEach((q, i) => {
    html += '<div class="quiz-card" id="q' + i + '">';
    html += '<div class="quiz-question"><span class="q-num">' + (i + 1) + '.</span><span>' + q.question + '</span></div>';
    html += '<div class="quiz-options">';
    q.options.forEach((opt, j) => {
      html += '<label class="quiz-option" id="q' + i + 'o' + j + '" onclick="selectOption(' + i + ',' + j + ')">';
      html += '<input type="radio" name="q' + i + '" value="' + j + '"> ' + opt;
      html += '</label>';
    });
    html += '</div>';
    html += '<div class="quiz-explanation" id="q' + i + 'exp">' + q.explanation + '</div>';
    html += '</div>';
  });

  container.innerHTML = html;
}

function selectOption(qIdx, oIdx) {
  if (submitted) return;
  const options = document.querySelectorAll('#q' + qIdx + ' .quiz-option');
  options.forEach(o => o.classList.remove('selected'));
  document.getElementById('q' + qIdx + 'o' + oIdx).classList.add('selected');
}

function submitQuiz() {
  if (submitted) return;
  submitted = true;

  let score = 0;

  QUIZ_DATA.forEach((q, i) => {
    const selected = document.querySelector('input[name="q' + i + '"]:checked');
    const selectedIdx = selected ? parseInt(selected.value) : -1;

    // Show explanation
    document.getElementById('q' + i + 'exp').classList.add('visible');

    // Mark correct/wrong
    if (selectedIdx === q.correct) {
      score++;
      document.getElementById('q' + i + 'o' + selectedIdx).classList.add('correct');
    } else {
      if (selectedIdx >= 0) {
        document.getElementById('q' + i + 'o' + selectedIdx).classList.add('wrong');
      }
      document.getElementById('q' + i + 'o' + q.correct).classList.add('correct');
    }
  });

  // Show result
  const result = document.getElementById('quiz-result');
  const scoreEl = document.getElementById('quiz-score');
  const msgEl = document.getElementById('quiz-message');
  result.classList.add('visible');
  scoreEl.textContent = score + '/10';

  if (score >= 8) {
    scoreEl.className = 'quiz-score';
    msgEl.textContent = 'Excelente! Você domina Microservices vs Monolito.';
  } else if (score >= 5) {
    scoreEl.className = 'quiz-score mid';
    msgEl.textContent = 'Bom, mas revise os conceitos que errou.';
  } else {
    scoreEl.className = 'quiz-score low';
    msgEl.textContent = 'Recomendado: releia a seção e tente novamente.';
  }

  // Save to localStorage
  const data = { score: score, total: 10, completedAt: new Date().toISOString() };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

  // Toggle buttons
  document.getElementById('btn-submit').style.display = 'none';
  document.getElementById('btn-retry').style.display = 'inline-flex';
}

function resetQuiz() {
  submitted = false;
  document.getElementById('quiz-result').classList.remove('visible');
  document.getElementById('btn-submit').style.display = 'inline-flex';
  document.getElementById('btn-retry').style.display = 'none';
  renderQuiz();
}

// Check for previous score
function loadPreviousScore() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    try {
      const data = JSON.parse(saved);
      const tip = document.createElement('div');
      tip.className = 'tip info';
      tip.innerHTML = '<span class="tip-icon">i</span><div>Você já fez este quiz antes e tirou <strong>' + data.score + '/10</strong>. Pode refazer para melhorar sua nota.</div>';
      document.querySelector('.quiz-section').insertBefore(tip, document.getElementById('quiz-container'));
    } catch(e) {}
  }
}

// Init
renderQuiz();
loadPreviousScore();
</script>
</body>
</html>
