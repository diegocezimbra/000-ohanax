<div class="header">
  <h2>Dashboard Overview</h2>
  <div class="header-actions">
    <div class="date-filter">
      <select id="overview-period" onchange="onPeriodChange('overview')">
        <option value="7">Ultimos 7 dias</option>
        <option value="30" selected>Ultimos 30 dias</option>
        <option value="90">Ultimos 90 dias</option>
        <option value="365">Ultimo ano</option>
        <option value="custom">Personalizado</option>
      </select>
      <div class="date-range-inputs" id="overview-custom-dates" style="display: none;">
        <input type="date" id="overview-start-date">
        <span>ate</span>
        <input type="date" id="overview-end-date">
      </div>
    </div>
    <button class="refresh-btn" onclick="loadAllData()">Atualizar</button>
  </div>
</div>

<div class="cards">
  <div class="card highlight">
    <div class="card-title">MRR Total <span class="info-tooltip" data-tooltip="Monthly Recurring Revenue - Receita que voce recebe todo mes de assinaturas ativas. E a metrica mais importante para negocios SaaS pois mostra receita previsivel."></span></div>
    <div class="card-value" id="total-mrr">R$ --</div>
    <div class="card-subtitle">Receita mensal recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Receita One-Time <span class="info-tooltip" data-tooltip="Receita de vendas unicas (pacotes avulsos). Diferente de assinaturas, o cliente paga uma vez e nao ha cobranca recorrente."></span></div>
    <div class="card-value" id="total-onetime">R$ --</div>
    <div class="card-subtitle">Pacotes vendidos</div>
  </div>
  <div class="card">
    <div class="card-title">Receita Total <span class="info-tooltip" data-tooltip="Soma de toda receita: MRR (assinaturas) + One-Time (pacotes avulsos). Mostra o total de dinheiro entrando no negocio."></span></div>
    <div class="card-value" id="total-revenue">R$ --</div>
    <div class="card-subtitle">MRR + One-Time</div>
  </div>
  <div class="card">
    <div class="card-title">Usuarios Total <span class="info-tooltip tooltip-left" data-tooltip="Total de usuarios cadastrados em todos os servicos (Auth, Billing, Security, oEntregador). Inclui pagantes, em trial e gratuitos."></span></div>
    <div class="card-value" id="total-users">--</div>
    <div class="card-subtitle">Todos os servicos</div>
  </div>
</div>

<div class="cards" style="margin-top: -10px;">
  <div class="card">
    <div class="card-title">ARR Total <span class="info-tooltip" data-tooltip="Annual Recurring Revenue - Receita anual recorrente. E o MRR multiplicado por 12. Mostra quanto voce faturaria em um ano mantendo o MRR atual."></span></div>
    <div class="card-value" id="total-arr">R$ --</div>
    <div class="card-subtitle">Receita anual recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Assinantes Ativos <span class="info-tooltip" data-tooltip="Quantidade de clientes com assinatura ativa (status 'active'). Sao os clientes que pagam mensalmente de forma recorrente."></span></div>
    <div class="card-value" id="active-subs">--</div>
    <div class="card-subtitle">Assinantes pagantes</div>
  </div>
  <div class="card">
    <div class="card-title">Pacotes Vendidos <span class="info-tooltip" data-tooltip="Quantidade total de pacotes one-time vendidos. Cada venda conta como um pacote, mesmo que seja o mesmo cliente comprando varias vezes."></span></div>
    <div class="card-value" id="total-purchases">--</div>
    <div class="card-subtitle">One-time pagos</div>
  </div>
  <div class="card">
    <div class="card-title">Clientes Unicos <span class="info-tooltip tooltip-left" data-tooltip="Total de clientes que pagaram pelo menos uma vez. Conta cada email uma unica vez, seja assinante ou comprador de pacote avulso."></span></div>
    <div class="card-value" id="total-customers">--</div>
    <div class="card-subtitle">Assinantes + Compradores</div>
  </div>
</div>

<div class="section">
  <div class="section-title">Funil de Conversao (90 dias) <span class="info-tooltip" data-tooltip="Mostra a jornada do usuario: de visitante ate pagante. Cada etapa mostra quantos usuarios chegaram e a porcentagem de conversao. Dados dos ultimos 90 dias."></span></div>
  <div class="funnel-grid">
    <div class="funnel-chart-container">
      <div id="funnel-chart"></div>
    </div>
    <div class="funnel-stats">
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon visitor"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="funnel-visitors">--</div>
          <div class="funnel-stat-label">Visitantes <span class="info-tooltip" data-tooltip="Pessoas que acessaram o site. Coletado via Umami Analytics. E o topo do funil."></span></div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon registered"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="funnel-registered">--</div>
          <div class="funnel-stat-label">Cadastrados <span class="info-tooltip" data-tooltip="Visitantes que criaram uma conta. A porcentagem mostra quantos visitantes se cadastraram."></span></div>
          <div class="funnel-stat-percent" id="funnel-reg-percent">--% dos visitantes</div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon trial"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="funnel-trial">--</div>
          <div class="funnel-stat-label">Em Trial <span class="info-tooltip" data-tooltip="Usuarios que iniciaram periodo de teste. Mostra quantos cadastrados decidiram experimentar o produto."></span></div>
          <div class="funnel-stat-percent" id="funnel-trial-percent">--% dos cadastros</div>
        </div>
      </div>
      <div class="funnel-stat-card highlight">
        <div class="funnel-stat-icon paying"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="funnel-paying">--</div>
          <div class="funnel-stat-label">Pagantes <span class="info-tooltip" data-tooltip="Usuarios que se tornaram clientes pagantes. A porcentagem total mostra a conversao de visitante para pagante."></span></div>
          <div class="funnel-stat-percent" id="funnel-paying-percent">--% total</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="grid-2">
  <div class="section">
    <div class="section-title">MRR por Projeto <span class="info-tooltip" data-tooltip="Compara o MRR de cada projeto (Auth, Billing, Security, oEntregador). Ajuda a identificar qual produto gera mais receita recorrente."></span></div>
    <div id="chart-mrr-project" style="height: 300px;"></div>
  </div>
  <div class="section">
    <div class="section-title">Usuarios por Projeto <span class="info-tooltip" data-tooltip="Compara a quantidade de usuarios de cada projeto. Mostra onde esta a maior base de usuarios."></span></div>
    <div id="chart-users-project" style="height: 300px;"></div>
  </div>
</div>

<div class="grid-2">
  <div class="section">
    <div class="section-title">Distribuicao de Receita <span class="info-tooltip" data-tooltip="Grafico que mostra a proporcao entre receita de assinaturas (MRR) e receita de pacotes avulsos (One-Time)."></span></div>
    <div id="chart-revenue-dist" style="height: 300px;"></div>
  </div>
  <div class="section">
    <div class="section-title">Assinantes por Status <span class="info-tooltip" data-tooltip="Distribuicao dos assinantes por status: Ativos (pagando), Em Trial (testando), Cancelados (churn)."></span></div>
    <div id="chart-subs-status" style="height: 300px;"></div>
  </div>
</div>

<div class="section">
  <div class="section-title">Comparativo de Projetos <span class="info-tooltip" data-tooltip="Compara metricas-chave de todos os projetos lado a lado: usuarios, assinantes, MRR, etc."></span></div>
  <div id="chart-projects-comparison" style="height: 350px;"></div>
</div>

<div class="section">
  <div class="section-title">Ultimos Assinantes <span class="info-tooltip" data-tooltip="Lista das assinaturas mais recentes de todos os projetos. Mostra email, plano, projeto, valor mensal e status."></span></div>
  <table>
    <thead>
      <tr><th>Email</th><th>Plano</th><th>Projeto</th><th>MRR</th><th>Status</th></tr>
    </thead>
    <tbody id="overview-subscribers-table"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
  </table>
</div>
