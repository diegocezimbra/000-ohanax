<div class="header">
  <h2><span class="service-badge auth">AUTH</span> Auth Service</h2>
  <div class="header-actions">
    <div class="date-filter">
      <select id="auth-period" onchange="onPeriodChange('auth')">
        <option value="7">Ultimos 7 dias</option>
        <option value="30" selected>Ultimos 30 dias</option>
        <option value="90">Ultimos 90 dias</option>
        <option value="365">Ultimo ano</option>
        <option value="custom">Personalizado</option>
      </select>
      <div class="date-range-inputs" id="auth-custom-dates" style="display: none;">
        <input type="date" id="auth-start-date">
        <span>ate</span>
        <input type="date" id="auth-end-date">
      </div>
    </div>
    <button class="refresh-btn" onclick="loadProjectPage('auth')">Atualizar</button>
  </div>
</div>

<div class="cards">
  <div class="card highlight">
    <div class="card-title">MRR Total <span class="info-tooltip" data-tooltip="Monthly Recurring Revenue - Receita mensal recorrente do Auth Service. Soma de todas as assinaturas ativas neste projeto."></span></div>
    <div class="card-value" id="auth-mrr">R$ --</div>
    <div class="card-subtitle">Receita mensal recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Receita One-Time <span class="info-tooltip" data-tooltip="Receita de vendas unicas de pacotes avulsos do Auth Service. Pagamentos unicos sem recorrencia."></span></div>
    <div class="card-value" id="auth-onetime-revenue">R$ --</div>
    <div class="card-subtitle">Pacotes vendidos</div>
  </div>
  <div class="card">
    <div class="card-title">Receita Total <span class="info-tooltip" data-tooltip="Soma total de receita do Auth: MRR (assinaturas) + One-Time (pacotes avulsos)."></span></div>
    <div class="card-value" id="auth-total-revenue">R$ --</div>
    <div class="card-subtitle">MRR + One-Time</div>
  </div>
  <div class="card">
    <div class="card-title">Usuarios Total <span class="info-tooltip tooltip-left" data-tooltip="Total de usuarios cadastrados no Auth Service. Inclui todos os status: ativos, inativos, verificados e nao verificados."></span></div>
    <div class="card-value" id="auth-users">--</div>
    <div class="card-subtitle">Usuarios registrados</div>
  </div>
</div>

<div class="cards" style="margin-top: -10px;">
  <div class="card">
    <div class="card-title">ARR Total <span class="info-tooltip" data-tooltip="Annual Recurring Revenue - MRR x 12. Projecao anual baseada na receita recorrente atual."></span></div>
    <div class="card-value" id="auth-arr">R$ --</div>
    <div class="card-subtitle">Receita anual recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Assinantes Ativos <span class="info-tooltip" data-tooltip="Clientes com assinatura ativa pagando mensalmente pelo Auth Service."></span></div>
    <div class="card-value" id="auth-subs">--</div>
    <div class="card-subtitle">Assinantes pagantes</div>
  </div>
  <div class="card">
    <div class="card-title">Pacotes Vendidos <span class="info-tooltip" data-tooltip="Total de pacotes avulsos vendidos no Auth Service. Cada compra conta como uma unidade."></span></div>
    <div class="card-value" id="auth-onetime-count">--</div>
    <div class="card-subtitle">One-time pagos</div>
  </div>
  <div class="card">
    <div class="card-title">Clientes Unicos <span class="info-tooltip tooltip-left" data-tooltip="Clientes unicos que pagaram pelo Auth (assinatura ou one-time). Cada email conta uma vez."></span></div>
    <div class="card-value" id="auth-unique-customers">--</div>
    <div class="card-subtitle">Assinantes + Compradores</div>
  </div>
</div>

<div class="grid-2">
  <div class="section">
    <div class="section-title">Usuarios <span class="info-tooltip" data-tooltip="Metricas de usuarios do Auth Service. Mostra diferentes segmentacoes da base de usuarios."></span></div>
    <div class="metric-row">
      <span class="metric-label">Total <span class="info-tooltip" data-tooltip="Todos os usuarios cadastrados no Auth Service, independente de status."></span></span>
      <span class="metric-value" id="auth-users-total">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Verificados <span class="info-tooltip" data-tooltip="Usuarios que confirmaram o email. Importante para qualidade da base."></span></span>
      <span class="metric-value" id="auth-users-verified">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Ativos (7d) <span class="info-tooltip" data-tooltip="Usuarios que fizeram login nos ultimos 7 dias. Mostra engajamento real."></span></span>
      <span class="metric-value" id="auth-users-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Novos hoje <span class="info-tooltip" data-tooltip="Usuarios que se cadastraram hoje. Mostra aquisicao diaria."></span></span>
      <span class="metric-value" id="auth-users-today">--</span>
    </div>
  </div>
  <div class="section">
    <div class="section-title">Assinaturas <span class="info-tooltip" data-tooltip="Metricas de assinaturas do Auth Service. Mostra a distribuicao por status."></span></div>
    <div class="metric-row">
      <span class="metric-label">Ativos <span class="info-tooltip" data-tooltip="Assinaturas com status 'active' - clientes pagando mensalmente."></span></span>
      <span class="metric-value" id="auth-subs-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Em Trial <span class="info-tooltip" data-tooltip="Usuarios em periodo de teste gratuito. Potenciais clientes pagantes."></span></span>
      <span class="metric-value" id="auth-subs-trial">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Cancelados <span class="info-tooltip" data-tooltip="Assinaturas canceladas (churn). Importante monitorar para reduzir cancelamentos."></span></span>
      <span class="metric-value" id="auth-subs-canceled">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Receita Total <span class="info-tooltip" data-tooltip="Soma de toda receita gerada pelas assinaturas do Auth."></span></span>
      <span class="metric-value" id="auth-revenue">R$ --</span>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">Funil de Conversao - Auth (90 dias) <span class="info-tooltip" data-tooltip="Jornada do usuario no Auth Service: visitante -> cadastro -> trial -> pagante. Dados dos ultimos 90 dias."></span></div>
  <div class="funnel-grid">
    <div class="funnel-chart-container">
      <div id="auth-funnel-chart"></div>
    </div>
    <div class="funnel-stats">
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon visitor"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="auth-funnel-visitors">--</div>
          <div class="funnel-stat-label">Visitantes <span class="info-tooltip" data-tooltip="Visitantes unicos no site do Auth. Coletado via Umami Analytics."></span></div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon registered"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="auth-funnel-registered">--</div>
          <div class="funnel-stat-label">Cadastrados <span class="info-tooltip" data-tooltip="Usuarios que criaram conta. A porcentagem mostra taxa de conversao de visitante para cadastro."></span></div>
          <div class="funnel-stat-percent" id="auth-funnel-reg-percent">--% dos visitantes</div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon trial"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="auth-funnel-trial">--</div>
          <div class="funnel-stat-label">Em Trial <span class="info-tooltip" data-tooltip="Cadastrados que iniciaram trial. Mostra interesse no produto."></span></div>
          <div class="funnel-stat-percent" id="auth-funnel-trial-percent">--% dos cadastros</div>
        </div>
      </div>
      <div class="funnel-stat-card highlight">
        <div class="funnel-stat-icon paying"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="auth-funnel-paying">--</div>
          <div class="funnel-stat-label">Pagantes <span class="info-tooltip" data-tooltip="Clientes que converteram para pagantes. Metrica mais importante do funil."></span></div>
          <div class="funnel-stat-percent" id="auth-funnel-paying-percent">--% total</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">Crescimento de Usuarios <span class="info-tooltip" data-tooltip="Grafico mostrando a evolucao de novos cadastros ao longo do tempo no Auth Service."></span></div>
  <div id="authChart" style="height: 250px;"></div>
</div>

<div class="section">
  <div class="section-title">Assinantes Recentes <span class="info-tooltip" data-tooltip="Lista das assinaturas mais recentes do Auth Service. Mostra os ultimos clientes a assinar."></span></div>
  <table>
    <thead>
      <tr><th>Email</th><th>Plano</th><th>MRR</th><th>Status</th><th>Data</th></tr>
    </thead>
    <tbody id="auth-table"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
  </table>
</div>

<!-- SEÇÃO: Métricas de Segurança -->
<div class="cards" style="margin-top: 20px;">
  <div class="card">
    <div class="card-title">Logins Hoje <span class="info-tooltip" data-tooltip="Total de tentativas de login hoje (sucesso + falha). Alto numero pode indicar bot ou ataque."></span></div>
    <div class="card-value" id="auth-logins-today">--</div>
    <div class="card-subtitle">Total de logins</div>
  </div>
  <div class="card">
    <div class="card-title">Logins Falhos <span class="info-tooltip" data-tooltip="Tentativas de login que falharam nos ultimos 7 dias. Muitas falhas podem indicar ataques de forca bruta."></span></div>
    <div class="card-value" id="auth-failed-logins">--</div>
    <div class="card-subtitle">Ultimos 7 dias</div>
  </div>
  <div class="card">
    <div class="card-title">Novos Dispositivos <span class="info-tooltip" data-tooltip="Dispositivos/navegadores novos usados para login. Pico pode indicar conta comprometida."></span></div>
    <div class="card-value" id="auth-new-devices">--</div>
    <div class="card-subtitle">Ultimos 7 dias</div>
  </div>
  <div class="card">
    <div class="card-title">Eventos Criticos <span class="info-tooltip tooltip-left" data-tooltip="Eventos de seguranca criticos nao resolvidos (ex: multiplas tentativas de brute force, IPs suspeitos)."></span></div>
    <div class="card-value" id="auth-critical-events">--</div>
    <div class="card-subtitle">Nao resolvidos</div>
  </div>
</div>

<!-- SEÇÃO: Gráfico de Logins -->
<div class="section">
  <div class="section-title">Atividade de Login (7 dias) <span class="info-tooltip" data-tooltip="Grafico de logins por dia: barras verdes = sucesso, vermelhas = falha. Ajuda a identificar padroes e anomalias."></span></div>
  <div id="auth-logins-chart" style="height: 200px;"></div>
</div>

<!-- SEÇÃO: Histórico de Logins Recentes -->
<div class="section">
  <div class="section-header">
    <div class="section-title">Ultimos Logins <span class="info-tooltip" data-tooltip="Historico detalhado de tentativas de login. Mostra IP, dispositivo, metodo e se foi sucesso ou falha."></span></div>
    <div class="filters">
      <select id="auth-login-filter" onchange="loadAuthLogins()">
        <option value="">Todos</option>
        <option value="true">Sucesso</option>
        <option value="false">Falha</option>
      </select>
    </div>
  </div>
  <table>
    <thead>
      <tr>
        <th>Data/Hora</th>
        <th>Usuario</th>
        <th>IP</th>
        <th>Metodo</th>
        <th>Status</th>
        <th>Device</th>
      </tr>
    </thead>
    <tbody id="auth-logins-table">
      <tr><td colspan="6" class="loading">Carregando...</td></tr>
    </tbody>
  </table>
  <div class="pagination" id="auth-logins-pagination"></div>
</div>

<!-- SEÇÃO: Eventos de Segurança -->
<div class="section">
  <div class="section-header">
    <div class="section-title">Eventos de Seguranca <span class="info-tooltip" data-tooltip="Eventos de seguranca detectados pelo sistema. Severidade indica urgencia: critico requer atencao imediata."></span></div>
    <div class="filters">
      <select id="auth-severity-filter" onchange="loadAuthSecurityEvents()">
        <option value="">Todas</option>
        <option value="critical">Critico</option>
        <option value="high">Alto</option>
        <option value="medium">Medio</option>
      </select>
    </div>
  </div>
  <table>
    <thead>
      <tr>
        <th>Data/Hora</th>
        <th>Tipo</th>
        <th>Severidade</th>
        <th>Usuario</th>
        <th>IP</th>
        <th>Status</th>
        <th>Acao</th>
      </tr>
    </thead>
    <tbody id="auth-security-table">
      <tr><td colspan="7" class="loading">Carregando...</td></tr>
    </tbody>
  </table>
</div>

<!-- SEÇÃO: Ações Administrativas Recentes -->
<div class="section">
  <div class="section-title">Acoes Administrativas <span class="info-tooltip" data-tooltip="Registro de acoes feitas por administradores. Importante para auditoria e compliance."></span></div>
  <table>
    <thead>
      <tr>
        <th>Data/Hora</th>
        <th>Admin</th>
        <th>Acao</th>
        <th>Recurso</th>
        <th>Detalhes</th>
      </tr>
    </thead>
    <tbody id="auth-admin-actions-table">
      <tr><td colspan="5" class="loading">Carregando...</td></tr>
    </tbody>
  </table>
</div>
