<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testes - Smart Noter</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/shared/nav-header.js" defer></script>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1><i class="fas fa-microphone"></i> Smart Noter</h1>
            <span class="version">v1.0</span>
        </div>
        <div class="header-right">
            <a href="index.html" class="header-link"><i class="fas fa-home"></i> Inicio</a>
        </div>
    </header>

    <nav class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Inicio</div>
            <ul class="sidebar-nav">
                <li><a href="index.html"><i class="fas fa-home"></i> Visao Geral</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Fundamentos</div>
            <ul class="sidebar-nav">
                <li><a href="design-system.html"><i class="fas fa-palette"></i> Design System</a></li>
                <li><a href="arquitetura.html"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Tecnologia</div>
            <ul class="sidebar-nav">
                <li><a href="stack-tecnologico.html"><i class="fas fa-code"></i> Stack Tecnologico</a></li>
                <li><a href="banco-de-dados.html"><i class="fas fa-database"></i> Banco de Dados</a></li>
                <li><a href="apis-endpoints.html"><i class="fas fa-plug"></i> APIs</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Desenvolvimento</div>
            <ul class="sidebar-nav">
                <li><a href="pipeline-ia.html"><i class="fas fa-brain"></i> Pipeline IA</a></li>
                <li><a href="implementacao.html"><i class="fas fa-hammer"></i> Implementacao</a></li>
                <li><a href="seguranca.html"><i class="fas fa-shield-alt"></i> Seguranca</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Deploy</div>
            <ul class="sidebar-nav">
                <li><a href="devops.html"><i class="fas fa-server"></i> DevOps</a></li>
                <li><a href="testes.html" class="active"><i class="fas fa-vial"></i> Testes</a></li>
                <li><a href="guia-desenvolvimento.html"><i class="fas fa-road"></i> Guia</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="breadcrumb">
            <a href="index.html">Inicio</a> <i class="fas fa-chevron-right"></i> Testes
        </div>

        <h1>Testes</h1>

        <h2>Cobertura de Testes</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-vial"></i>
                <h3>Matriz de Cobertura</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Framework</th>
                        <th>Cobertura Minima</th>
                        <th>Descricao</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Unit Tests</strong></td>
                        <td>Jest</td>
                        <td><span class="badge badge-success">80%</span></td>
                        <td>Funcoes isoladas</td>
                    </tr>
                    <tr>
                        <td><strong>Integration Tests</strong></td>
                        <td>Supertest</td>
                        <td><span class="badge badge-success">70%</span></td>
                        <td>APIs e endpoints</td>
                    </tr>
                    <tr>
                        <td><strong>Component Tests</strong></td>
                        <td>React Native Testing Library</td>
                        <td><span class="badge badge-success">70%</span></td>
                        <td>Componentes React</td>
                    </tr>
                    <tr>
                        <td><strong>E2E Tests</strong></td>
                        <td>Detox</td>
                        <td><span class="badge badge-warning">Fluxos criticos</span></td>
                        <td>End-to-end mobile</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>Exemplo de Unit Test</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-code"></i>
                <h3>NotesService - Unit Test</h3>
            </div>
            <pre><code class="language-typescript">describe('NotesService', () => {
  let notesService: NotesService;
  let testUserId: string;

  beforeEach(async () => {
    notesService = new NotesService();
    const user = await prisma.user.create({
      data: {
        email: 'test@example.com',
        password: 'hashedpassword',
      },
    });
    testUserId = user.id;
  });

  describe('createNote', () => {
    it('should create a note successfully', async () => {
      const mockFile = {
        buffer: Buffer.from('mock audio data'),
        mimetype: 'audio/mpeg',
        originalname: 'test.mp3',
      } as Express.Multer.File;

      const note = await notesService.createNote(testUserId, mockFile);

      expect(note).toHaveProperty('id');
      expect(note.userId).toBe(testUserId);
      expect(note.status).toBe('PROCESSING');
    });

    it('should throw error for invalid file type', async () => {
      const mockFile = {
        buffer: Buffer.from('not audio'),
        mimetype: 'text/plain',
        originalname: 'test.txt',
      } as Express.Multer.File;

      await expect(
        notesService.createNote(testUserId, mockFile)
      ).rejects.toThrow('Invalid file type');
    });
  });

  describe('getNoteById', () => {
    it('should return note with transcript', async () => {
      const note = await notesService.getNoteById(testNoteId, testUserId);

      expect(note).toBeDefined();
      expect(note.transcript).toBeDefined();
      expect(note.summary).toBeDefined();
    });

    it('should throw NotFoundError for non-existent note', async () => {
      await expect(
        notesService.getNoteById('invalid-id', testUserId)
      ).rejects.toThrow('Note not found');
    });
  });
});</code></pre>
        </div>

        <h2>Exemplo de Integration Test</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-plug"></i>
                <h3>Auth API - Integration Test</h3>
            </div>
            <pre><code class="language-typescript">import request from 'supertest';
import { app } from '../src/app';

describe('Auth API', () => {
  describe('POST /api/v1/auth/register', () => {
    it('should register a new user', async () => {
      const response = await request(app)
        .post('/api/v1/auth/register')
        .send({
          email: 'newuser@example.com',
          password: 'SecurePass123!',
          firstName: 'John',
          lastName: 'Doe',
        });

      expect(response.status).toBe(201);
      expect(response.body.data).toHaveProperty('accessToken');
      expect(response.body.data).toHaveProperty('refreshToken');
      expect(response.body.data.user.email).toBe('newuser@example.com');
    });

    it('should reject duplicate email', async () => {
      const response = await request(app)
        .post('/api/v1/auth/register')
        .send({
          email: 'existing@example.com',
          password: 'SecurePass123!',
          firstName: 'Jane',
          lastName: 'Doe',
        });

      expect(response.status).toBe(409);
    });
  });
});</code></pre>
        </div>

        <div class="nav-buttons">
            <a href="devops.html" class="nav-button prev"><i class="fas fa-arrow-left"></i> DevOps</a>
            <a href="guia-desenvolvimento.html" class="nav-button"><span>Guia</span> <i class="fas fa-arrow-right"></i></a>
        </div>

        <footer class="footer">
            <p><strong>Smart Noter v1.0</strong> | <a href="index.html">Inicio</a> | <a href="#top">Topo â†‘</a></p>
        </footer>
    </main>

    <div class="scroll-top" id="scrollTop"><i class="fas fa-arrow-up"></i></div>

    <script>
        hljs.highlightAll();
        const btn = document.getElementById('scrollTop');
        window.addEventListener('scroll', () => btn.classList.toggle('visible', window.pageYOffset > 300));
        btn.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));
    </script>
</body>
</html>
