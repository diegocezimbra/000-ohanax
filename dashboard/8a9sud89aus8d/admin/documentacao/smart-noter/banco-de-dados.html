<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Dados - Smart Noter</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/shared/nav-header.js" defer></script>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1><i class="fas fa-microphone"></i> Smart Noter</h1>
            <span class="version">v1.0</span>
        </div>
        <div class="header-right">
            <a href="index.html" class="header-link"><i class="fas fa-home"></i> Início</a>
        </div>
    </header>

    <nav class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Início</div>
            <ul class="sidebar-nav">
                <li><a href="index.html"><i class="fas fa-home"></i> Visão Geral</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Fundamentos</div>
            <ul class="sidebar-nav">
                <li><a href="design-system.html"><i class="fas fa-palette"></i> Design System</a></li>
                <li><a href="arquitetura.html"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Tecnologia</div>
            <ul class="sidebar-nav">
                <li><a href="stack-tecnologico.html"><i class="fas fa-code"></i> Stack Tecnológico</a></li>
                <li><a href="banco-de-dados.html"><i class="fas fa-database"></i> Banco de Dados</a></li>
                <li><a href="apis-endpoints.html"><i class="fas fa-plug"></i> APIs</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Desenvolvimento</div>
            <ul class="sidebar-nav">
                <li><a href="pipeline-ia.html"><i class="fas fa-brain"></i> Pipeline IA</a></li>
                <li><a href="implementacao.html"><i class="fas fa-hammer"></i> Implementação</a></li>
                <li><a href="seguranca.html"><i class="fas fa-shield-alt"></i> Segurança</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Deploy</div>
            <ul class="sidebar-nav">
                <li><a href="devops.html"><i class="fas fa-server"></i> DevOps</a></li>
                <li><a href="testes.html"><i class="fas fa-vial"></i> Testes</a></li>
                <li><a href="guia-desenvolvimento.html"><i class="fas fa-road"></i> Guia</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="breadcrumb">
            <a href="index.html">Início</a> <i class="fas fa-chevron-right"></i> Banco de Dados
        </div>

        <h1>Banco de Dados</h1>

        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <div>
                O banco de dados utiliza <strong>PostgreSQL</strong> com <strong>Prisma ORM</strong>. O schema completo inclui <strong>14 models</strong>.
            </div>
        </div>

        <!-- ===== Models Principais ===== -->
        <h2><i class="fas fa-cubes"></i> Models Principais</h2>

        <div class="card">
            <div class="card-header">
                <i class="fas fa-database"></i>
                <h3>Prisma Schema</h3>
            </div>
            <pre><code class="language-prisma">model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String?
  lastName      String?
  profileImage  String?
  isPro         Boolean   @default(false)
  notes         Note[]
  folders       Folder[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Note {
  id          String   @id @default(uuid())
  title       String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  audioUrl    String
  duration    Int
  status      NoteStatus @default(PROCESSING)
  transcript  Transcript?
  summary     Summary?
  speakers    Speaker[]
  tags        Tag[]
  folderId    String?
  folder      Folder?  @relation(fields: [folderId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Transcript {
  id          String   @id @default(uuid())
  noteId      String   @unique
  note        Note     @relation(fields: [noteId], references: [id])
  text        String
  language    String
  confidence  Float
  segments    Json
  createdAt   DateTime @default(now())
}

model Summary {
  id          String   @id @default(uuid())
  noteId      String   @unique
  note        Note     @relation(fields: [noteId], references: [id])
  text        String
  keyPoints   Json
  actionItems Json
  createdAt   DateTime @default(now())
}

model Speaker {
  id       String @id @default(uuid())
  noteId   String
  note     Note   @relation(fields: [noteId], references: [id])
  label    String
  segments Json
}

model Folder {
  id        String   @id @default(uuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  notes     Note[]
  createdAt DateTime @default(now())
}

model Tag {
  id    String @id @default(uuid())
  name  String @unique
  notes Note[]
}

enum NoteStatus {
  PROCESSING
  TRANSCRIBING
  ANALYZING
  READY
  FAILED
}</code></pre>
        </div>

        <!-- ===== Redis Cache Strategy ===== -->
        <h2><i class="fas fa-bolt"></i> Redis Cache Strategy</h2>

        <div class="card">
            <div class="card-header">
                <i class="fas fa-memory"></i>
                <h3>Mapeamento de Cache</h3>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Chave</th>
                        <th>TTL</th>
                        <th>Descrição</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>user:{userId}</code></td>
                        <td>1 hora</td>
                        <td>Dados do usuário</td>
                    </tr>
                    <tr>
                        <td><code>user:{userId}:notes</code></td>
                        <td>30 min</td>
                        <td>Lista de notas</td>
                    </tr>
                    <tr>
                        <td><code>note:{noteId}</code></td>
                        <td>30 min</td>
                        <td>Dados da nota</td>
                    </tr>
                    <tr>
                        <td><code>note:{noteId}:transcript</code></td>
                        <td>30 min</td>
                        <td>Transcrição</td>
                    </tr>
                    <tr>
                        <td><code>session:{sessionId}</code></td>
                        <td>24 horas</td>
                        <td>Sessão</td>
                    </tr>
                    <tr>
                        <td><code>ratelimit:{ip}:{endpoint}</code></td>
                        <td>1 min</td>
                        <td>Rate limiting</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ===== MinIO/S3 Object Storage ===== -->
        <h2><i class="fas fa-hdd"></i> MinIO/S3 Object Storage</h2>

        <div class="card">
            <div class="card-header">
                <i class="fas fa-archive"></i>
                <h3>Configuração de Armazenamento</h3>
            </div>

            <h4><i class="fas fa-bucket"></i> Buckets</h4>
            <ul>
                <li><code>audio-original</code></li>
                <li><code>audio-processed</code></li>
                <li><code>exports</code></li>
                <li><code>profile-images</code></li>
            </ul>

            <h4><i class="fas fa-folder-tree"></i> Estrutura de Paths</h4>
            <pre><code class="language-bash"># Áudio original enviado pelo usuário
audio-original/{userId}/{noteId}/original.{ext}

# Áudio processado (normalizado, convertido)
audio-processed/{userId}/{noteId}/processed.wav

# Exportações (PDF, DOCX, etc.)
exports/{userId}/{noteId}/{format}/{filename}

# Imagens de perfil
profile-images/{userId}/avatar.{ext}</code></pre>
        </div>

        <div class="nav-buttons">
            <a href="stack-tecnologico.html" class="nav-button prev"><i class="fas fa-arrow-left"></i> Stack</a>
            <a href="apis-endpoints.html" class="nav-button"><span>APIs</span> <i class="fas fa-arrow-right"></i></a>
        </div>

        <footer class="footer">
            <p><strong>Smart Noter v1.0</strong> | <a href="index.html">Início</a> | <a href="#top">Topo ↑</a></p>
        </footer>
    </main>

    <div class="scroll-top" id="scrollTop"><i class="fas fa-arrow-up"></i></div>

    <script>
        hljs.highlightAll();
        const btn = document.getElementById('scrollTop');
        window.addEventListener('scroll', () => btn.classList.toggle('visible', window.pageYOffset > 300));
        btn.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));
    </script>
</body>
</html>
