<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Noter - Documentação Técnica Completa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/shared/global-theme.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/shared/nav-header.js" defer></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1><i class="fas fa-microphone"></i> Smart Noter</h1>
            <span class="version">v1.0</span>
        </div>
        <div class="header-right">
            <a href="index.html" class="header-link">
                <i class="fas fa-home"></i> Início
            </a>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Início</div>
            <ul class="sidebar-nav">
                <li><a href="#overview" class="active"><i class="fas fa-home"></i> Visão Geral</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Fundamentos</div>
            <ul class="sidebar-nav">
                <li><a href="#design-system"><i class="fas fa-palette"></i> Design System</a></li>
                <li><a href="#architecture"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Tecnologia</div>
            <ul class="sidebar-nav">
                <li><a href="#stack"><i class="fas fa-code"></i> Stack Tecnológico</a></li>
                <li><a href="#database"><i class="fas fa-database"></i> Banco de Dados</a></li>
                <li><a href="#apis"><i class="fas fa-plug"></i> APIs e Endpoints</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Desenvolvimento</div>
            <ul class="sidebar-nav">
                <li><a href="#ai-pipeline"><i class="fas fa-brain"></i> Pipeline de IA</a></li>
                <li><a href="#features"><i class="fas fa-hammer"></i> Implementação</a></li>
                <li><a href="#security"><i class="fas fa-shield-alt"></i> Segurança</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-title">Deploy</div>
            <ul class="sidebar-nav">
                <li><a href="#devops"><i class="fas fa-server"></i> DevOps</a></li>
                <li><a href="#testing"><i class="fas fa-vial"></i> Testes</a></li>
                <li><a href="#guide"><i class="fas fa-road"></i> Guia Completo</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

        <!-- ==================== OVERVIEW ==================== -->
        <section id="overview">
            <h1>Smart Noter - Documentação Técnica Completa</h1>
            <p class="lead">Guia de Desenvolvimento de 0 a 100%</p>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Sobre esta documentação</strong><br>
                    Esta documentação técnica completa fornece todos os recursos necessários para construir o Smart Noter do zero até um produto pronto para produção. ~3.000 linhas de documentação, 100+ exemplos de código, 14 models de banco de dados, 20+ endpoints de API documentados.
                </div>
            </div>

            <h2>O que você vai construir</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <i class="fas fa-microphone"></i>
                    <h4>Gravação de Áudio</h4>
                    <p>Sistema completo de gravação de áudio com visualização em tempo real e controles avançados.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Upload Seguro</h4>
                    <p>Armazenamento em cloud com MinIO/S3, incluindo processamento e otimização de arquivos.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-comment-alt"></i>
                    <h4>Transcrição IA</h4>
                    <p>Transcrição automática com 95%+ de precisão usando OpenAI Whisper.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-users"></i>
                    <h4>Identificação de Falantes</h4>
                    <p>Separação e identificação automática de múltiplos falantes com pyannote.audio.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-file-alt"></i>
                    <h4>Resumos Inteligentes</h4>
                    <p>Geração automática de resumos, pontos-chave e action items com GPT-4.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-video"></i>
                    <h4>Integração Meetings</h4>
                    <p>Bot de gravação para Google Meet, Zoom e Microsoft Teams.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-download"></i>
                    <h4>Exportação Múltipla</h4>
                    <p>Exportação em diversos formatos: TXT, PDF, DOCX, com templates customizáveis.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-sync"></i>
                    <h4>Sincronização</h4>
                    <p>Sincronização em tempo real entre dispositivos com WebSocket.</p>
                </div>
            </div>

            <h2>Métricas de Sucesso</h2>
            <table>
                <thead>
                    <tr>
                        <th>Métrica</th>
                        <th>Target</th>
                        <th>Descrição</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Tempo de Processamento</strong></td>
                        <td><span class="badge badge-success">&lt; 2 minutos</span></td>
                        <td>Para 1 hora de áudio</td>
                    </tr>
                    <tr>
                        <td><strong>Precisão de Transcrição</strong></td>
                        <td><span class="badge badge-success">&gt; 95%</span></td>
                        <td>Word Error Rate (WER)</td>
                    </tr>
                    <tr>
                        <td><strong>Precisão de Diarização</strong></td>
                        <td><span class="badge badge-success">&gt; 90%</span></td>
                        <td>Speaker identification accuracy</td>
                    </tr>
                    <tr>
                        <td><strong>API Response Time</strong></td>
                        <td><span class="badge badge-success">&lt; 200ms</span></td>
                        <td>95th percentile</td>
                    </tr>
                    <tr>
                        <td><strong>Uptime</strong></td>
                        <td><span class="badge badge-success">99.9%</span></td>
                        <td>Service availability</td>
                    </tr>
                </tbody>
            </table>

            <h2>Tecnologias Principais</h2>
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-react"></i>
                        <h3>Frontend Mobile</h3>
                    </div>
                    <ul class="checklist">
                        <li>React Native 0.73 + Expo 50</li>
                        <li>TypeScript</li>
                        <li>Redux Toolkit / Zustand</li>
                        <li>React Query</li>
                        <li>React Navigation</li>
                        <li>expo-av (Audio)</li>
                        <li>React Native Reanimated</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-node-js"></i>
                        <h3>Backend API</h3>
                    </div>
                    <ul class="checklist">
                        <li>Node.js 20 + Express</li>
                        <li>TypeScript</li>
                        <li>Prisma ORM</li>
                        <li>PostgreSQL 16</li>
                        <li>Redis 7</li>
                        <li>Bull Queue</li>
                        <li>JWT + bcrypt</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-python"></i>
                        <h3>AI Pipeline</h3>
                    </div>
                    <ul class="checklist">
                        <li>Python 3.11 + FastAPI</li>
                        <li>OpenAI Whisper</li>
                        <li>pyannote.audio 3.1</li>
                        <li>GPT-4</li>
                        <li>Celery</li>
                        <li>PyTorch</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-docker"></i>
                        <h3>Infraestrutura</h3>
                    </div>
                    <ul class="checklist">
                        <li>Docker + Kubernetes</li>
                        <li>NGINX</li>
                        <li>MinIO / S3</li>
                        <li>Prometheus + Grafana</li>
                        <li>GitHub Actions (CI/CD)</li>
                    </ul>
                </div>
            </div>

            <h2>Quick Start</h2>
            <div class="card">
                <pre><code class="language-bash"># 1. Clone o repositório
git clone &lt;seu-repo&gt; && cd smart-noter

# 2. Backend Setup
cd api
npm install
npx prisma migrate dev
npm run dev

# 3. Frontend Setup (novo terminal)
cd mobile
npm install
npx expo start

# 4. AI Pipeline Setup (novo terminal)
cd ai-pipeline
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn src.main:app --reload

# 5. Infrastructure (novo terminal)
docker-compose up -d</code></pre>
            </div>
        </section>

        <!-- ==================== ARCHITECTURE ==================== -->
        <section id="architecture">
            <h2><i class="fas fa-sitemap"></i> Arquitetura de Alto Nível</h2>

            <div class="architecture">
┌─────────────────────────────────────────────────────────────┐
│                      CLIENTE (Mobile)                        │
│  ┌─────────────┐  ┌──────────────┐  ┌──────────────────┐   │
│  │ React Native │  │ Redux/Zustand│  │ React Query      │   │
│  │ + Expo       │  │ (State Mgmt) │  │ (Data Fetching)  │   │
│  └─────────────┘  └──────────────┘  └──────────────────┘   │
└────────────────────────────┬────────────────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   API Gateway   │
                    │   (NGINX)       │
                    └────────┬────────┘
                             │
        ┏────────────────────┼────────────────────┓
        ▼                    ▼                    ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   Auth API    │   │   Core API    │   │  Media API    │
│   (Node.js)   │   │   (Node.js)   │   │  (Node.js)    │
└───────┬───────┘   └───────┬───────┘   └───────┬───────┘
        │                   │                    │
        └───────────────────┼────────────────────┘
                            │
        ┏───────────────────┼───────────────────┓
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│  PostgreSQL   │   │     Redis     │   │   MinIO/S3    │
│  (Primary DB) │   │    (Cache)    │   │ (Object Store)│
└───────────────┘   └───────────────┘   └───────────────┘
                            │
        ┏───────────────────┼───────────────────┓
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│ AI Pipeline   │   │  Transcription│   │   Speaker     │
│ (Python)      │   │   (Whisper)   │   │ Diarization   │
│  FastAPI      │   │   OpenAI API  │   │  (pyannote)   │
└───────────────┘   └───────────────┘   └───────────────┘</div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-layer-group"></i>
                    <h3>Componentes Principais</h3>
                </div>
                <h4>1. Frontend (Mobile)</h4>
                <ul>
                    <li><strong>React Native + Expo:</strong> Framework mobile multiplataforma</li>
                    <li><strong>Redux Toolkit/Zustand:</strong> Gerenciamento de estado</li>
                    <li><strong>React Query:</strong> Data fetching e cache</li>
                    <li><strong>expo-av:</strong> Gravação e reprodução de áudio</li>
                </ul>

                <h4>2. Backend (APIs)</h4>
                <ul>
                    <li><strong>Node.js + Express:</strong> APIs RESTful</li>
                    <li><strong>TypeScript:</strong> Type safety</li>
                    <li><strong>Prisma ORM:</strong> Database access</li>
                    <li><strong>JWT:</strong> Autenticação</li>
                    <li><strong>Bull Queue:</strong> Job processing</li>
                </ul>

                <h4>3. Banco de Dados</h4>
                <ul>
                    <li><strong>PostgreSQL:</strong> Banco principal</li>
                    <li><strong>Redis:</strong> Cache e sessões</li>
                    <li><strong>MinIO/S3:</strong> Armazenamento de arquivos</li>
                </ul>

                <h4>4. IA e Processamento</h4>
                <ul>
                    <li><strong>OpenAI Whisper:</strong> Transcrição de áudio</li>
                    <li><strong>pyannote.audio:</strong> Diarização de falantes</li>
                    <li><strong>GPT-4:</strong> Geração de resumos</li>
                    <li><strong>Python FastAPI:</strong> Pipeline de IA</li>
                </ul>
            </div>

            <h3>Padrões Arquiteturais</h3>
            <div class="card">
                <ul>
                    <li><strong>Layered Architecture:</strong> Camadas separadas de apresentação, negócio e dados</li>
                    <li><strong>Clean Architecture:</strong> Dependências apontam para dentro</li>
                    <li><strong>Repository Pattern:</strong> Abstração de acesso a dados</li>
                    <li><strong>Service Layer:</strong> Lógica de negócio centralizada</li>
                    <li><strong>Factory Pattern:</strong> Criação de objetos complexos</li>
                    <li><strong>Observer Pattern:</strong> Eventos e notificações em tempo real</li>
                    <li><strong>Dependency Injection:</strong> Desacoplamento de componentes</li>
                </ul>
            </div>
        </section>

        <!-- ==================== DESIGN SYSTEM ==================== -->
        <section id="design-system">
            <h2><i class="fas fa-palette"></i> Design System</h2>

            <h3>Paleta de Cores</h3>
            <div class="color-palette">
                <div class="color-swatch">
                    <div class="color-preview" style="background: #3577B9;">Primary</div>
                    <div class="color-info">
                        <div class="color-name">Primary</div>
                        <div class="color-code">#3577B9</div>
                    </div>
                </div>
                <div class="color-swatch">
                    <div class="color-preview" style="background: #0A1F44;">Primary Dark</div>
                    <div class="color-info">
                        <div class="color-name">Primary Dark</div>
                        <div class="color-code">#0A1F44</div>
                    </div>
                </div>
                <div class="color-swatch">
                    <div class="color-preview" style="background: #EF4444;">Secondary</div>
                    <div class="color-info">
                        <div class="color-name">Secondary (Red)</div>
                        <div class="color-code">#EF4444</div>
                    </div>
                </div>
                <div class="color-swatch">
                    <div class="color-preview" style="background: #10B981;">Success</div>
                    <div class="color-info">
                        <div class="color-name">Success (Green)</div>
                        <div class="color-code">#10B981</div>
                    </div>
                </div>
                <div class="color-swatch">
                    <div class="color-preview" style="background: #F59E0B;">Warning</div>
                    <div class="color-info">
                        <div class="color-name">Warning (Yellow)</div>
                        <div class="color-code">#F59E0B</div>
                    </div>
                </div>
                <div class="color-swatch">
                    <div class="color-preview" style="background: #6B7280;">Gray</div>
                    <div class="color-info">
                        <div class="color-name">Gray</div>
                        <div class="color-code">#6B7280</div>
                    </div>
                </div>
            </div>

            <h3>Tipografia</h3>
            <div class="card">
                <h4>Fonte Principal</h4>
                <p><code>font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif</code></p>

                <h4>Tamanhos de Fonte</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tamanho</th>
                            <th>Uso</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>xs</td><td>12px</td><td>Captions, labels pequenos</td></tr>
                        <tr><td>sm</td><td>14px</td><td>Body small, labels</td></tr>
                        <tr><td>base</td><td>16px</td><td>Body text padrão</td></tr>
                        <tr><td>lg</td><td>18px</td><td>Large body text</td></tr>
                        <tr><td>xl</td><td>20px</td><td>H4 headers</td></tr>
                        <tr><td>2xl</td><td>24px</td><td>H3 headers</td></tr>
                        <tr><td>3xl</td><td>30px</td><td>H2 headers</td></tr>
                        <tr><td>4xl</td><td>36px</td><td>H1 headers</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Espaçamento (8pt Grid)</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Valor (px)</th>
                            <th>Rem</th>
                            <th>Uso Comum</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>spacing[1]</td><td>4px</td><td>0.25rem</td><td>Espaçamento mínimo</td></tr>
                        <tr><td>spacing[2]</td><td>8px</td><td>0.5rem</td><td>Pequenos gaps</td></tr>
                        <tr><td>spacing[3]</td><td>12px</td><td>0.75rem</td><td>Padding de inputs</td></tr>
                        <tr><td>spacing[4]</td><td>16px</td><td>1rem</td><td>Padding padrão</td></tr>
                        <tr><td>spacing[6]</td><td>24px</td><td>1.5rem</td><td>Padding de containers</td></tr>
                        <tr><td>spacing[8]</td><td>32px</td><td>2rem</td><td>Margens entre seções</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Componentes UI</h3>
            <div class="card">
                <h4>Buttons</h4>
                <ul>
                    <li><strong>Primary:</strong> Background #3577B9, texto branco, border-radius 12px</li>
                    <li><strong>Secondary:</strong> Background transparente, borda #3577B9, texto #3577B9</li>
                    <li><strong>Danger:</strong> Background #EF4444, texto branco</li>
                    <li><strong>Ghost:</strong> Background transparente, hover com background sutil</li>
                </ul>

                <h4>Cards</h4>
                <ul>
                    <li>Background branco, border-radius 16px, padding 24px</li>
                    <li>Sombra: <code>0 2px 8px rgba(0,0,0,0.05)</code></li>
                    <li>Hover: sombra mais intensa</li>
                </ul>

                <h4>Inputs</h4>
                <ul>
                    <li>Altura 48px, border-radius 12px</li>
                    <li>Border: 1px solid #E5E7EB</li>
                    <li>Focus: border-color #3577B9, shadow 0 0 0 3px rgba(53,119,185,0.1)</li>
                </ul>
            </div>

            <h3>Acessibilidade (WCAG 2.1 AA)</h3>
            <div class="card">
                <ul class="checklist">
                    <li>Contraste mínimo 4.5:1 para texto normal</li>
                    <li>Contraste mínimo 3:1 para texto grande</li>
                    <li>Labels em todos os inputs de formulário</li>
                    <li>Navegação por teclado completa</li>
                    <li>Screen reader compatibility</li>
                    <li>Touch targets mínimo 44x44px</li>
                </ul>
            </div>
        </section>

        <!-- ==================== STACK ==================== -->
        <section id="stack">
            <h2><i class="fas fa-code"></i> Stack Tecnológico</h2>

            <div class="card">
                <div class="card-header">
                    <i class="fab fa-react"></i>
                    <h3>Frontend Mobile - package.json</h3>
                </div>
                <pre><code class="language-json">{
  "dependencies": {
    "react": "^18.2.0",
    "react-native": "^0.73.0",
    "expo": "^50.0.0",
    "@react-navigation/native": "^6.1.9",
    "@react-navigation/bottom-tabs": "^6.5.11",
    "@reduxjs/toolkit": "^2.0.1",
    "react-redux": "^9.0.4",
    "@tanstack/react-query": "^5.17.0",
    "axios": "^1.6.5",
    "expo-av": "^13.10.4",
    "react-native-paper": "^5.11.6",
    "react-native-reanimated": "^3.6.1"
  }
}</code></pre>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fab fa-node-js"></i>
                    <h3>Backend API - package.json</h3>
                </div>
                <pre><code class="language-json">{
  "dependencies": {
    "express": "^4.18.2",
    "typescript": "^5.3.3",
    "@prisma/client": "^5.8.0",
    "pg": "^8.11.3",
    "redis": "^4.6.12",
    "jsonwebtoken": "^9.0.2",
    "bcrypt": "^5.1.1",
    "helmet": "^7.1.0",
    "bull": "^4.12.0",
    "winston": "^3.11.0",
    "zod": "^3.22.4"
  }
}</code></pre>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fab fa-python"></i>
                    <h3>AI Pipeline - requirements.txt</h3>
                </div>
                <pre><code class="language-python">fastapi==0.109.0
uvicorn[standard]==0.26.0
openai==1.7.2
whisper==1.1.10
pyannote.audio==3.1.1
transformers==4.36.2
torch==2.1.2
pydub==0.25.1
librosa==0.10.1
celery==5.3.4
redis==5.0.1</code></pre>
            </div>

            <h3>Estrutura de Pastas</h3>
            <div class="card">
                <pre><code class="language-bash">smart-noter/
├── mobile/                  # React Native + Expo
│   ├── src/
│   │   ├── components/      # Componentes reutilizáveis
│   │   ├── screens/         # Telas do app
│   │   ├── navigation/      # React Navigation config
│   │   ├── store/           # Redux/Zustand store
│   │   ├── hooks/           # Custom hooks
│   │   ├── services/        # API calls
│   │   ├── utils/           # Utilitários
│   │   └── types/           # TypeScript types
│   ├── app.json
│   └── package.json
├── api/                     # Node.js + Express
│   ├── src/
│   │   ├── controllers/     # Route controllers
│   │   ├── services/        # Business logic
│   │   ├── middleware/       # Express middleware
│   │   ├── routes/          # Route definitions
│   │   ├── validators/      # Zod schemas
│   │   ├── utils/           # Utilities
│   │   └── types/           # TypeScript types
│   ├── prisma/
│   │   └── schema.prisma    # Database schema
│   └── package.json
├── ai-pipeline/             # Python + FastAPI
│   ├── src/
│   │   ├── services/        # AI services
│   │   ├── models/          # ML models
│   │   └── utils/           # Utilities
│   ├── requirements.txt
│   └── Dockerfile
├── docker-compose.yml
└── .github/
    └── workflows/           # CI/CD</code></pre>
            </div>
        </section>

        <!-- ==================== DATABASE ==================== -->
        <section id="database">
            <h2><i class="fas fa-database"></i> Banco de Dados</h2>

            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <div>
                    <strong>Schema Prisma</strong><br>
                    O banco de dados utiliza PostgreSQL com Prisma ORM. O schema completo inclui 14 models para gerenciar usuários, notas, transcrições, speakers, folders e mais.
                </div>
            </div>

            <h3>Models Principais</h3>
            <div class="card">
                <pre><code class="language-prisma">model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String?
  lastName      String?
  profileImage  String?
  isPro         Boolean   @default(false)
  notes         Note[]
  folders       Folder[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Note {
  id          String   @id @default(uuid())
  title       String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  audioUrl    String
  duration    Int
  status      NoteStatus @default(PROCESSING)
  transcript  Transcript?
  summary     Summary?
  speakers    Speaker[]
  tags        Tag[]
  folderId    String?
  folder      Folder?  @relation(fields: [folderId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Transcript {
  id          String   @id @default(uuid())
  noteId      String   @unique
  note        Note     @relation(fields: [noteId], references: [id])
  text        String
  language    String
  confidence  Float
  segments    Json
  createdAt   DateTime @default(now())
}

model Summary {
  id          String   @id @default(uuid())
  noteId      String   @unique
  note        Note     @relation(fields: [noteId], references: [id])
  text        String
  keyPoints   Json
  actionItems Json
  createdAt   DateTime @default(now())
}

model Speaker {
  id       String @id @default(uuid())
  noteId   String
  note     Note   @relation(fields: [noteId], references: [id])
  label    String
  segments Json
}

model Folder {
  id        String   @id @default(uuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  notes     Note[]
  createdAt DateTime @default(now())
}

model Tag {
  id    String @id @default(uuid())
  name  String @unique
  notes Note[]
}

enum NoteStatus {
  PROCESSING
  TRANSCRIBING
  ANALYZING
  READY
  FAILED
}</code></pre>
            </div>

            <h3>Redis Cache Strategy</h3>
            <div class="card">
                <h4>Estrutura de Chaves</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Chave</th>
                            <th>TTL</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>user:{userId}</code></td><td>1 hora</td><td>Dados do usuário</td></tr>
                        <tr><td><code>user:{userId}:notes</code></td><td>30 min</td><td>Lista de notas do usuário</td></tr>
                        <tr><td><code>note:{noteId}</code></td><td>30 min</td><td>Dados completos da nota</td></tr>
                        <tr><td><code>note:{noteId}:transcript</code></td><td>30 min</td><td>Transcrição da nota</td></tr>
                        <tr><td><code>session:{sessionId}</code></td><td>24 horas</td><td>Sessão do usuário</td></tr>
                        <tr><td><code>ratelimit:{ip}:{endpoint}</code></td><td>1 min</td><td>Rate limiting</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>MinIO/S3 Object Storage</h3>
            <div class="card">
                <h4>Buckets</h4>
                <ul>
                    <li><strong>audio-original:</strong> Arquivos de áudio originais</li>
                    <li><strong>audio-processed:</strong> Áudio processado/otimizado</li>
                    <li><strong>exports:</strong> Arquivos exportados (PDF, TXT)</li>
                    <li><strong>profile-images:</strong> Imagens de perfil dos usuários</li>
                </ul>

                <h4>Estrutura de Paths</h4>
                <pre><code class="language-bash">audio/original/{userId}/{noteId}.{ext}
audio/processed/{userId}/{noteId}.mp3
exports/{userId}/{noteId}.{format}
profiles/{userId}/avatar.{ext}</code></pre>
            </div>
        </section>

        <!-- ==================== APIS ==================== -->
        <section id="apis">
            <h2><i class="fas fa-plug"></i> APIs e Endpoints</h2>

            <h3>Authentication Endpoints</h3>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Descrição</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/auth/register</td>
                        <td>Registrar novo usuário</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/auth/login</td>
                        <td>Login de usuário</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/auth/refresh</td>
                        <td>Renovar access token</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/auth/logout</td>
                        <td>Logout de usuário</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/auth/google</td>
                        <td>Login com Google OAuth</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>

            <h3>Notes Endpoints</h3>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Descrição</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td>/api/v1/notes</td>
                        <td>Listar todas as notas</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td>/api/v1/notes/:id</td>
                        <td>Buscar nota por ID</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/notes</td>
                        <td>Criar nova nota (com audio)</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-secondary">PATCH</span></td>
                        <td>/api/v1/notes/:id</td>
                        <td>Atualizar nota</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-secondary">DELETE</span></td>
                        <td>/api/v1/notes/:id</td>
                        <td>Deletar nota</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td>/api/v1/notes/:id/export</td>
                        <td>Exportar nota (TXT/PDF)</td>
                        <td>JWT</td>
                    </tr>
                </tbody>
            </table>

            <h3>Folders & Tags Endpoints</h3>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Descrição</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td>/api/v1/folders</td>
                        <td>Listar pastas</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-success">POST</span></td>
                        <td>/api/v1/folders</td>
                        <td>Criar pasta</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-secondary">PATCH</span></td>
                        <td>/api/v1/notes/:id/move</td>
                        <td>Mover nota para pasta</td>
                        <td>JWT</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-primary">GET</span></td>
                        <td>/api/v1/tags</td>
                        <td>Listar tags</td>
                        <td>JWT</td>
                    </tr>
                </tbody>
            </table>

            <h3>Exemplo de Request/Response</h3>
            <div class="card">
                <h4>POST /api/v1/notes</h4>
                <p><strong>Request:</strong></p>
                <pre><code class="language-javascript">const formData = new FormData();
formData.append('audio', audioFile);
formData.append('title', 'My Recording');

const response = await fetch('/api/v1/notes', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`
  },
  body: formData
});</code></pre>

                <p><strong>Response (201 Created):</strong></p>
                <pre><code class="language-json">{
  "status": "success",
  "data": {
    "note": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "My Recording",
      "userId": "123e4567-e89b-12d3-a456-426614174000",
      "audioUrl": "audio/original/user123/note456.mp3",
      "duration": 125,
      "status": "PROCESSING",
      "createdAt": "2026-01-29T12:00:00.000Z"
    }
  }
}</code></pre>
            </div>

            <h3>Auth Controller</h3>
            <div class="card">
                <pre><code class="language-typescript">export class AuthController {
  async register(req: Request, res: Response) {
    const { email, password, firstName, lastName } = registerSchema.parse(req.body);

    const existingUser = await prisma.user.findUnique({ where: { email } });
    if (existingUser) {
      throw new AppError('Email already registered', 409);
    }

    const hashedPassword = await bcrypt.hash(password, 10);
    const user = await prisma.user.create({
      data: { email, password: hashedPassword, firstName, lastName }
    });

    const accessToken = generateAccessToken({ userId: user.id, email: user.email });
    const refreshToken = generateRefreshToken(user.id);

    await redisClient.set(`refresh:${user.id}`, refreshToken, { EX: 60 * 60 * 24 * 7 });

    res.status(201).json({
      status: 'success',
      data: { user: sanitizeUser(user), accessToken, refreshToken }
    });
  }

  async login(req: Request, res: Response) {
    const { email, password } = loginSchema.parse(req.body);

    const user = await prisma.user.findUnique({ where: { email } });
    if (!user || !(await bcrypt.compare(password, user.password))) {
      throw new AppError('Invalid credentials', 401);
    }

    const accessToken = generateAccessToken({ userId: user.id, email: user.email });
    const refreshToken = generateRefreshToken(user.id);

    await redisClient.set(`refresh:${user.id}`, refreshToken, { EX: 60 * 60 * 24 * 7 });

    res.json({
      status: 'success',
      data: { user: sanitizeUser(user), accessToken, refreshToken }
    });
  }
}</code></pre>
            </div>
        </section>

        <!-- ==================== AI PIPELINE ==================== -->
        <section id="ai-pipeline">
            <h2><i class="fas fa-brain"></i> Pipeline de IA</h2>

            <div class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                <div>
                    <strong>Pipeline em 6 Etapas</strong><br>
                    O processamento de IA ocorre em background através de uma fila (Bull Queue) com 6 etapas sequenciais.
                </div>
            </div>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>1. Upload Audio</h4>
                    <p>Upload do arquivo de áudio para MinIO/S3</p>
                    <p><strong>Tecnologia:</strong> MinIO/S3 SDK</p>
                    <p><strong>Tempo médio:</strong> ~2 segundos</p>
                </div>

                <div class="timeline-item">
                    <h4>2. Transcription (Speech-to-Text)</h4>
                    <p>Conversão de áudio em texto usando OpenAI Whisper</p>
                    <p><strong>Tecnologia:</strong> OpenAI Whisper (base model)</p>
                    <p><strong>Tempo médio:</strong> ~1 minuto para 10 minutos de áudio</p>
                    <p><strong>Precisão:</strong> 95%+</p>
                </div>

                <div class="timeline-item">
                    <h4>3. Speaker Diarization</h4>
                    <p>Identificação de quem falou quando</p>
                    <p><strong>Tecnologia:</strong> pyannote.audio 3.1</p>
                    <p><strong>Tempo médio:</strong> ~30 segundos para 10 minutos</p>
                    <p><strong>Precisão:</strong> 90%+</p>
                </div>

                <div class="timeline-item">
                    <h4>4. Content Analysis</h4>
                    <p>Análise semântica do conteúdo</p>
                    <p><strong>Tecnologia:</strong> GPT-4</p>
                    <p><strong>Tempo médio:</strong> ~10 segundos</p>
                </div>

                <div class="timeline-item">
                    <h4>5. Summarization & Action Items</h4>
                    <p>Geração de resumo e extração de action items</p>
                    <p><strong>Tecnologia:</strong> GPT-4</p>
                    <p><strong>Tempo médio:</strong> ~15 segundos</p>
                </div>

                <div class="timeline-item">
                    <h4>6. Finalization</h4>
                    <p>Atualização do banco de dados e envio de notificação</p>
                    <p><strong>Tecnologia:</strong> Expo Push Notifications</p>
                    <p><strong>Tempo médio:</strong> ~1 segundo</p>
                </div>
            </div>

            <h3>Transcription Service (Whisper)</h3>
            <div class="card">
                <pre><code class="language-python">class TranscriptionService:
    def __init__(self):
        model_size = os.getenv("WHISPER_MODEL_SIZE", "base")
        self.model = whisper.load_model(model_size)

    async def transcribe(self, audio_url: str) -> Dict[str, Any]:
        # Download audio file
        temp_file = await self._download_audio(audio_url)

        try:
            # Transcribe
            result = self.model.transcribe(
                temp_file,
                language="en",
                task="transcribe",
                verbose=False,
            )

            return {
                "text": result["text"],
                "language": result["language"],
                "confidence": self._calculate_confidence(result),
                "segments": [
                    {
                        "text": segment["text"],
                        "start": segment["start"],
                        "end": segment["end"],
                    }
                    for segment in result["segments"]
                ],
            }
        finally:
            os.unlink(temp_file)</code></pre>
            </div>

            <h3>Speaker Diarization Service</h3>
            <div class="card">
                <pre><code class="language-python">from pyannote.audio import Pipeline

class DiarizationService:
    def __init__(self):
        self.pipeline = Pipeline.from_pretrained(
            "pyannote/speaker-diarization-3.1",
            use_auth_token=os.getenv("HF_AUTH_TOKEN")
        )

    async def diarize(self, audio_url: str) -> List[Dict]:
        temp_file = await self._download_audio(audio_url)

        try:
            diarization = self.pipeline(temp_file)

            speakers = []
            for turn, _, speaker in diarization.itertracks(yield_label=True):
                speakers.append({
                    "speaker": speaker,
                    "start": turn.start,
                    "end": turn.end,
                })

            return speakers
        finally:
            os.unlink(temp_file)</code></pre>
            </div>

            <h3>Summarization Service (GPT-4)</h3>
            <div class="card">
                <pre><code class="language-python">class SummarizationService:
    def __init__(self):
        self.client = openai.OpenAI()

    async def summarize(self, transcript: str) -> Dict[str, Any]:
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": """Analyze the following transcript and provide:
1. A concise summary (max 300 words)
2. Key points (bullet list)
3. Action items with assignees if mentioned
4. Overall sentiment
Return as JSON."""},
                {"role": "user", "content": transcript}
            ],
            response_format={"type": "json_object"},
            temperature=0.3,
        )

        return json.loads(response.choices[0].message.content)</code></pre>
            </div>

            <h3>Bull Queue Configuration</h3>
            <div class="card">
                <pre><code class="language-typescript">import Bull from 'bull';

export const processingQueue = new Bull('audio-processing', {
  redis: { host: process.env.REDIS_HOST, port: 6379 },
  defaultJobOptions: {
    attempts: 3,
    backoff: { type: 'exponential', delay: 5000 },
    removeOnComplete: 100,
    removeOnFail: 50,
  },
});

processingQueue.process(async (job) => {
  const { noteId, audioUrl } = job.data;

  // Step 1: Update status
  await updateNoteStatus(noteId, 'TRANSCRIBING');
  job.progress(10);

  // Step 2: Transcribe
  const transcript = await aiPipeline.transcribe(audioUrl);
  job.progress(40);

  // Step 3: Diarize
  const speakers = await aiPipeline.diarize(audioUrl);
  job.progress(60);

  // Step 4: Summarize
  const summary = await aiPipeline.summarize(transcript.text);
  job.progress(80);

  // Step 5: Save results
  await saveResults(noteId, { transcript, speakers, summary });
  await updateNoteStatus(noteId, 'READY');
  job.progress(100);

  // Step 6: Notify user
  await sendPushNotification(noteId);
});</code></pre>
            </div>
        </section>

        <!-- ==================== IMPLEMENTATION ==================== -->
        <section id="features">
            <h2><i class="fas fa-hammer"></i> Implementação</h2>

            <h3>Audio Recording Hook (React Native)</h3>
            <div class="card">
                <pre><code class="language-typescript">import { Audio } from 'expo-av';
import { useState, useRef, useCallback } from 'react';

export const useAudioRecording = () => {
  const [isRecording, setIsRecording] = useState(false);
  const [duration, setDuration] = useState(0);
  const [metering, setMetering] = useState&lt;number[]&gt;([]);
  const recordingRef = useRef&lt;Audio.Recording | null&gt;(null);
  const intervalRef = useRef&lt;NodeJS.Timeout | null&gt;(null);

  const startRecording = useCallback(async () => {
    try {
      const { granted } = await Audio.requestPermissionsAsync();
      if (!granted) throw new Error('Permission denied');

      await Audio.setAudioModeAsync({
        allowsRecordingIOS: true,
        playsInSilentModeIOS: true,
      });

      const recording = new Audio.Recording();
      await recording.prepareToRecordAsync(
        Audio.RecordingOptionsPresets.HIGH_QUALITY
      );

      recording.setOnRecordingStatusUpdate((status) => {
        if (status.metering) {
          setMetering(prev => [...prev.slice(-50), status.metering!]);
        }
      });

      await recording.startAsync();
      recordingRef.current = recording;
      setIsRecording(true);

      intervalRef.current = setInterval(() => {
        setDuration(prev => prev + 1);
      }, 1000);
    } catch (error) {
      console.error('Failed to start recording:', error);
    }
  }, []);

  const stopRecording = useCallback(async () => {
    if (!recordingRef.current) return null;

    try {
      await recordingRef.current.stopAndUnloadAsync();
      const uri = recordingRef.current.getURI();

      if (intervalRef.current) clearInterval(intervalRef.current);

      setIsRecording(false);
      setDuration(0);
      setMetering([]);
      recordingRef.current = null;

      return uri;
    } catch (error) {
      console.error('Failed to stop recording:', error);
      return null;
    }
  }, []);

  return { isRecording, duration, metering, startRecording, stopRecording };
};</code></pre>
            </div>

            <h3>WebSocket Real-Time Updates</h3>
            <div class="card">
                <pre><code class="language-typescript">import { Server } from 'socket.io';

export const setupWebSocket = (httpServer: any) => {
  const io = new Server(httpServer, {
    cors: { origin: '*', methods: ['GET', 'POST'] },
  });

  io.use(async (socket, next) => {
    const token = socket.handshake.auth.token;
    try {
      const payload = verifyAccessToken(token);
      socket.data.userId = payload.userId;
      next();
    } catch {
      next(new Error('Authentication error'));
    }
  });

  io.on('connection', (socket) => {
    const userId = socket.data.userId;
    socket.join(`user:${userId}`);

    socket.on('disconnect', () => {
      socket.leave(`user:${userId}`);
    });
  });

  return io;
};

// Emit processing updates
export const emitNoteUpdate = (io: Server, userId: string, noteId: string, status: string, progress: number) => {
  io.to(`user:${userId}`).emit('note:processing', {
    noteId,
    status,
    progress,
    timestamp: new Date().toISOString(),
  });
};</code></pre>
            </div>

            <h3>Features Implementadas</h3>
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-check-circle"></i>
                        <h3>Core Features</h3>
                    </div>
                    <ul class="checklist">
                        <li>Gravação de áudio com visualização</li>
                        <li>Upload para cloud storage</li>
                        <li>Transcrição automática (Whisper)</li>
                        <li>Identificação de falantes</li>
                        <li>Resumo inteligente (GPT-4)</li>
                        <li>Extração de action items</li>
                        <li>Organização em pastas</li>
                        <li>Busca e filtros</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-star"></i>
                        <h3>Advanced Features</h3>
                    </div>
                    <ul class="checklist">
                        <li>Real-time updates (WebSocket)</li>
                        <li>Integração com calendários</li>
                        <li>Bot de gravação para meetings</li>
                        <li>Exportação em múltiplos formatos</li>
                        <li>Sincronização multi-dispositivo</li>
                        <li>Sistema PRO/Freemium</li>
                        <li>Push notifications</li>
                        <li>AI Chat sobre notas</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- ==================== SECURITY ==================== -->
        <section id="security">
            <h2><i class="fas fa-shield-alt"></i> Segurança</h2>

            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>CRÍTICO</strong><br>
                    Todas as implementações de segurança são obrigatórias para ambiente de produção.
                </div>
            </div>

            <h3>Camadas de Segurança</h3>
            <div class="card">
                <ul class="checklist">
                    <li>JWT Authentication com Refresh Tokens</li>
                    <li>bcrypt para hash de senhas (10 rounds)</li>
                    <li>Rate Limiting por IP e endpoint</li>
                    <li>Input Validation com Zod schemas</li>
                    <li>SQL Injection prevention (Prisma ORM)</li>
                    <li>XSS Protection (Helmet middleware)</li>
                    <li>CORS configurado corretamente</li>
                    <li>Data Encryption (AES-256-GCM)</li>
                    <li>Secure Headers (CSP, HSTS, etc.)</li>
                    <li>HTTPS obrigatório em produção</li>
                </ul>
            </div>

            <h3>JWT Implementation</h3>
            <div class="card">
                <pre><code class="language-typescript">import jwt from 'jsonwebtoken';

interface JWTPayload {
  userId: string;
  email: string;
}

export const generateAccessToken = (payload: JWTPayload): string => {
  return jwt.sign(payload, process.env.JWT_SECRET!, {
    expiresIn: '15m',
    issuer: 'smart-noter-api',
    audience: 'smart-noter-client',
  });
};

export const generateRefreshToken = (userId: string): string => {
  return jwt.sign({ userId }, process.env.JWT_REFRESH_SECRET!, {
    expiresIn: '7d',
    issuer: 'smart-noter-api',
    audience: 'smart-noter-client',
  });
};

export const verifyAccessToken = (token: string): JWTPayload => {
  return jwt.verify(token, process.env.JWT_SECRET!, {
    issuer: 'smart-noter-api',
    audience: 'smart-noter-client',
  }) as JWTPayload;
};

// Auth Middleware
export const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const authHeader = req.headers.authorization;
  if (!authHeader?.startsWith('Bearer ')) {
    return res.status(401).json({ error: 'No token provided' });
  }

  try {
    const token = authHeader.split(' ')[1];
    const payload = verifyAccessToken(token);
    req.user = payload;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'Invalid or expired token' });
  }
};</code></pre>
            </div>

            <h3>Rate Limiting Configuration</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint Type</th>
                        <th>Window</th>
                        <th>Max Requests</th>
                        <th>Descrição</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>API Geral</td>
                        <td>15 min</td>
                        <td>100</td>
                        <td>Todos os endpoints</td>
                    </tr>
                    <tr>
                        <td>Auth</td>
                        <td>15 min</td>
                        <td>5</td>
                        <td>Login/Register</td>
                    </tr>
                    <tr>
                        <td>Upload</td>
                        <td>1 hora</td>
                        <td>10</td>
                        <td>Upload de áudio</td>
                    </tr>
                    <tr>
                        <td>PRO Users</td>
                        <td>15 min</td>
                        <td>500</td>
                        <td>5x limite normal</td>
                    </tr>
                </tbody>
            </table>

            <h3>Input Validation (Zod)</h3>
            <div class="card">
                <pre><code class="language-typescript">import { z } from 'zod';

export const registerSchema = z.object({
  email: z.string().email('Email inválido'),
  password: z.string()
    .min(8, 'Mínimo 8 caracteres')
    .regex(/[A-Z]/, 'Deve conter maiúscula')
    .regex(/[0-9]/, 'Deve conter número')
    .regex(/[^A-Za-z0-9]/, 'Deve conter caractere especial'),
  firstName: z.string().min(2).max(50),
  lastName: z.string().min(2).max(50),
});

export const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1),
});

export const createNoteSchema = z.object({
  title: z.string().min(1).max(255),
  folderId: z.string().uuid().optional(),
  tags: z.array(z.string()).optional(),
});</code></pre>
            </div>
        </section>

        <!-- ==================== DEVOPS ==================== -->
        <section id="devops">
            <h2><i class="fas fa-server"></i> DevOps e Infraestrutura</h2>

            <h3>Docker Configuration</h3>
            <div class="card">
                <h4>Backend Dockerfile</h4>
                <pre><code class="language-dockerfile">FROM node:20-alpine AS base

FROM base AS deps
WORKDIR /app
COPY package.json package-lock.json ./
COPY prisma ./prisma/
RUN npm ci --only=production

FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npx prisma generate
RUN npm run build

FROM base AS runner
WORKDIR /app
ENV NODE_ENV production
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nodejs
COPY --from=builder --chown=nodejs:nodejs /app/dist ./dist
COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules
USER nodejs
EXPOSE 3000
CMD ["node", "dist/server.js"]</code></pre>
            </div>

            <div class="card">
                <h4>AI Pipeline Dockerfile</h4>
                <pre><code class="language-dockerfile">FROM python:3.11-slim AS base

WORKDIR /app

RUN apt-get update && apt-get install -y \
    ffmpeg \
    libsndfile1 \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY src/ ./src/

EXPOSE 8000
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]</code></pre>
            </div>

            <div class="card">
                <h4>Docker Compose</h4>
                <pre><code class="language-yaml">version: '3.8'

services:
  api:
    build: ./api
    ports: ["3000:3000"]
    env_file: .env
    depends_on: [postgres, redis, minio]

  ai-pipeline:
    build: ./ai-pipeline
    ports: ["8000:8000"]
    env_file: .env
    depends_on: [redis]
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]

  postgres:
    image: postgres:16
    environment:
      POSTGRES_DB: smartnoter
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes: [postgres_data:/var/lib/postgresql/data]

  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]

  minio:
    image: minio/minio
    ports: ["9000:9000", "9001:9001"]
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: ${MINIO_PASSWORD}
    volumes: [minio_data:/data]
    command: server /data --console-address ":9001"

volumes:
  postgres_data:
  minio_data:</code></pre>
            </div>

            <h3>CI/CD Pipeline (GitHub Actions)</h3>
            <div class="card">
                <pre><code class="language-yaml">name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:16
        env:
          POSTGRES_DB: test_db
          POSTGRES_PASSWORD: test
        ports: [5432:5432]
      redis:
        image: redis:7
        ports: [6379:6379]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - run: cd api && npm ci
      - run: cd api && npx prisma migrate deploy
      - run: cd api && npm run lint
      - run: cd api && npm test -- --coverage
      - run: cd api && npm run build

  deploy:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1
      - run: |
          docker build -t smart-noter-api ./api
          docker tag smart-noter-api:latest $ECR_REGISTRY/smart-noter-api:latest
          docker push $ECR_REGISTRY/smart-noter-api:latest
      - run: aws ecs update-service --cluster production --service smart-noter --force-new-deployment</code></pre>
            </div>

            <h3>Monitoring Stack</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ferramenta</th>
                        <th>Propósito</th>
                        <th>Métricas</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Prometheus</td>
                        <td>Coleta de métricas</td>
                        <td>CPU, Memory, Request rate</td>
                    </tr>
                    <tr>
                        <td>Grafana</td>
                        <td>Visualização</td>
                        <td>Dashboards customizados</td>
                    </tr>
                    <tr>
                        <td>Winston + ELK</td>
                        <td>Logging</td>
                        <td>Application logs</td>
                    </tr>
                    <tr>
                        <td>Sentry</td>
                        <td>Error tracking</td>
                        <td>Errors e exceptions</td>
                    </tr>
                </tbody>
            </table>

            <h3>Environment Variables</h3>
            <div class="card">
                <pre><code class="language-bash"># Database
DATABASE_URL=postgresql://admin:password@localhost:5432/smartnoter

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT
JWT_SECRET=your-super-secret-key
JWT_REFRESH_SECRET=your-refresh-secret-key

# Storage
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=your-secret-key

# AI Pipeline
AI_PIPELINE_URL=http://localhost:8000
OPENAI_API_KEY=sk-...
HF_AUTH_TOKEN=hf_...
WHISPER_MODEL_SIZE=base

# App
NODE_ENV=development
PORT=3000</code></pre>
            </div>
        </section>

        <!-- ==================== TESTING ==================== -->
        <section id="testing">
            <h2><i class="fas fa-vial"></i> Testes</h2>

            <h3>Cobertura de Testes</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Tipo de Teste</th>
                            <th>Framework</th>
                            <th>Cobertura Mínima</th>
                            <th>Descrição</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Unit Tests</td>
                            <td>Jest</td>
                            <td>80%</td>
                            <td>Testes de funções isoladas</td>
                        </tr>
                        <tr>
                            <td>Integration Tests</td>
                            <td>Supertest</td>
                            <td>70%</td>
                            <td>Testes de APIs e endpoints</td>
                        </tr>
                        <tr>
                            <td>Component Tests</td>
                            <td>React Native Testing Library</td>
                            <td>70%</td>
                            <td>Testes de componentes React</td>
                        </tr>
                        <tr>
                            <td>E2E Tests</td>
                            <td>Detox</td>
                            <td>Fluxos críticos</td>
                            <td>Testes end-to-end mobile</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Exemplo de Unit Test</h3>
            <div class="card">
                <pre><code class="language-typescript">describe('NotesService', () => {
  let notesService: NotesService;
  let testUserId: string;

  beforeEach(async () => {
    notesService = new NotesService();
    const user = await prisma.user.create({
      data: {
        email: 'test@example.com',
        password: 'hashedpassword',
      },
    });
    testUserId = user.id;
  });

  describe('createNote', () => {
    it('should create a note successfully', async () => {
      const mockFile = {
        buffer: Buffer.from('mock audio data'),
        mimetype: 'audio/mpeg',
        originalname: 'test.mp3',
      } as Express.Multer.File;

      const note = await notesService.createNote(testUserId, mockFile);

      expect(note).toHaveProperty('id');
      expect(note.userId).toBe(testUserId);
      expect(note.status).toBe('PROCESSING');
    });

    it('should throw error for invalid file type', async () => {
      const mockFile = {
        buffer: Buffer.from('not audio'),
        mimetype: 'text/plain',
        originalname: 'test.txt',
      } as Express.Multer.File;

      await expect(
        notesService.createNote(testUserId, mockFile)
      ).rejects.toThrow('Invalid file type');
    });
  });

  describe('getNoteById', () => {
    it('should return note with transcript', async () => {
      const note = await notesService.getNoteById(testNoteId, testUserId);

      expect(note).toBeDefined();
      expect(note.transcript).toBeDefined();
      expect(note.summary).toBeDefined();
    });

    it('should throw NotFoundError for non-existent note', async () => {
      await expect(
        notesService.getNoteById('invalid-id', testUserId)
      ).rejects.toThrow('Note not found');
    });
  });
});</code></pre>
            </div>

            <h3>Exemplo de Integration Test</h3>
            <div class="card">
                <pre><code class="language-typescript">import request from 'supertest';
import { app } from '../src/app';

describe('Auth API', () => {
  describe('POST /api/v1/auth/register', () => {
    it('should register a new user', async () => {
      const response = await request(app)
        .post('/api/v1/auth/register')
        .send({
          email: 'newuser@example.com',
          password: 'SecurePass123!',
          firstName: 'John',
          lastName: 'Doe',
        });

      expect(response.status).toBe(201);
      expect(response.body.data).toHaveProperty('accessToken');
      expect(response.body.data).toHaveProperty('refreshToken');
      expect(response.body.data.user.email).toBe('newuser@example.com');
    });

    it('should reject duplicate email', async () => {
      const response = await request(app)
        .post('/api/v1/auth/register')
        .send({
          email: 'existing@example.com',
          password: 'SecurePass123!',
          firstName: 'Jane',
          lastName: 'Doe',
        });

      expect(response.status).toBe(409);
    });
  });
});</code></pre>
            </div>
        </section>

        <!-- ==================== DEVELOPMENT GUIDE ==================== -->
        <section id="guide">
            <h2><i class="fas fa-road"></i> Guia de Desenvolvimento (10 Semanas)</h2>

            <div class="alert alert-info">
                <i class="fas fa-calendar-alt"></i>
                <div>
                    <strong>Cronograma Completo</strong><br>
                    Este guia detalha o desenvolvimento completo do Smart Noter em 10 semanas, desde setup inicial até deploy em produção.
                </div>
            </div>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>Semana 1: Setup Inicial</h4>
                    <ul>
                        <li>Configuração do ambiente de desenvolvimento</li>
                        <li>Setup de repositórios Git</li>
                        <li>Inicialização de projetos (Frontend, Backend, AI)</li>
                        <li>Configuração do banco de dados</li>
                        <li>Setup do Docker e docker-compose</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Semana 2-3: Backend API</h4>
                    <p><strong>Sprint 1: Autenticação</strong></p>
                    <ul>
                        <li>Implementar registro de usuário</li>
                        <li>Implementar login e JWT</li>
                        <li>Implementar refresh tokens</li>
                        <li>Testes unitários e integração</li>
                    </ul>
                    <p><strong>Sprint 2: CRUD de Notas</strong></p>
                    <ul>
                        <li>Criar nota com upload de áudio</li>
                        <li>Listar, visualizar, atualizar e deletar notas</li>
                        <li>Testes completos</li>
                    </ul>
                    <p><strong>Sprint 3: Storage e Queue</strong></p>
                    <ul>
                        <li>Configurar MinIO/S3</li>
                        <li>Implementar Bull Queue</li>
                        <li>Criar workers de processamento</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Semana 4-5: Frontend Mobile</h4>
                    <p><strong>Sprint 1: Navegação e Auth</strong></p>
                    <ul>
                        <li>Setup de navegação</li>
                        <li>Telas de login/registro</li>
                        <li>Integração com API</li>
                        <li>Persistência de token</li>
                    </ul>
                    <p><strong>Sprint 2: Gravação de Áudio</strong></p>
                    <ul>
                        <li>Implementar gravação</li>
                        <li>Interface de gravação</li>
                        <li>Upload para API</li>
                        <li>Feedback visual</li>
                    </ul>
                    <p><strong>Sprint 3: Listagem e Visualização</strong></p>
                    <ul>
                        <li>Tela de lista de notas</li>
                        <li>Tela de detalhes</li>
                        <li>Player de áudio</li>
                        <li>Visualização de transcrição</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Semana 6-7: AI Pipeline</h4>
                    <p><strong>Sprint 1: Transcrição</strong></p>
                    <ul>
                        <li>Setup do Whisper</li>
                        <li>API de transcrição</li>
                        <li>Testes e otimização</li>
                    </ul>
                    <p><strong>Sprint 2: Diarização</strong></p>
                    <ul>
                        <li>Setup do pyannote</li>
                        <li>API de diarização</li>
                        <li>Integração com transcrição</li>
                    </ul>
                    <p><strong>Sprint 3: Summarização</strong></p>
                    <ul>
                        <li>Integração GPT-4</li>
                        <li>Extração de action items</li>
                        <li>API de summarização</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Semana 8: Integração e Testes</h4>
                    <ul>
                        <li>Integração completa do pipeline</li>
                        <li>Testes end-to-end</li>
                        <li>Performance testing</li>
                        <li>Bug fixing</li>
                        <li>Code review</li>
                    </ul>
                </div>

                <div class="timeline-item">
                    <h4>Semana 9-10: Deploy e Produção</h4>
                    <ul>
                        <li>Configuração de CI/CD</li>
                        <li>Deploy em ambiente de staging</li>
                        <li>Testes de carga</li>
                        <li>Configuração de monitoring</li>
                        <li>Deploy em produção</li>
                        <li>Documentação final</li>
                    </ul>
                </div>
            </div>

            <h3>Checklist de Produção</h3>
            <div class="card-grid">
                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-node-js"></i>
                        <h3>Backend</h3>
                    </div>
                    <ul class="checklist">
                        <li>Autenticação JWT funcionando</li>
                        <li>CRUD completo de notas</li>
                        <li>Upload de áudio para S3</li>
                        <li>Queue de processamento</li>
                        <li>Rate limiting ativo</li>
                        <li>Logs estruturados</li>
                        <li>Testes > 80% coverage</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-react"></i>
                        <h3>Frontend</h3>
                    </div>
                    <ul class="checklist">
                        <li>Navegação completa</li>
                        <li>Gravação de áudio</li>
                        <li>Upload funcionando</li>
                        <li>Listagem de notas</li>
                        <li>Visualização de transcrição</li>
                        <li>Player de áudio</li>
                        <li>Testes de componentes</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fab fa-docker"></i>
                        <h3>DevOps</h3>
                    </div>
                    <ul class="checklist">
                        <li>Docker configurado</li>
                        <li>CI/CD funcionando</li>
                        <li>Monitoramento ativo</li>
                        <li>Backups configurados</li>
                        <li>SSL/HTTPS configurado</li>
                    </ul>
                </div>
            </div>

            <h3>Checklist de Segurança</h3>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Status</th>
                            <th>Prioridade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>HTTPS configurado</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>Variáveis de ambiente seguras</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>Rate limiting ativo</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>Security headers configurados</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>Backup automático configurado</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>CDN configurado</td><td><span class="badge badge-warning">Recomendado</span></td><td>P1</td></tr>
                        <tr><td>Cache Redis otimizado</td><td><span class="badge badge-warning">Recomendado</span></td><td>P1</td></tr>
                        <tr><td>Database indexes criados</td><td><span class="badge badge-warning">Recomendado</span></td><td>P1</td></tr>
                        <tr><td>Load testing realizado</td><td><span class="badge badge-warning">Recomendado</span></td><td>P1</td></tr>
                        <tr><td>Monitoring ativo</td><td><span class="badge badge-success">Obrigatório</span></td><td>P0</td></tr>
                        <tr><td>GDPR compliance verificado</td><td><span class="badge badge-info">Compliance</span></td><td>P1</td></tr>
                        <tr><td>Privacy policy criada</td><td><span class="badge badge-info">Compliance</span></td><td>P1</td></tr>
                        <tr><td>Terms of service criados</td><td><span class="badge badge-info">Compliance</span></td><td>P1</td></tr>
                        <tr><td>Data retention policy definida</td><td><span class="badge badge-info">Compliance</span></td><td>P2</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>
                <strong>Smart Noter - Documentação Técnica Completa v1.0</strong><br>
                Criado em 29 de Janeiro de 2026<br>
                <a href="#overview">Voltar ao topo</a>
            </p>
        </footer>
    </main>

    <!-- Scroll to top button -->
    <div class="scroll-top" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // Highlight.js
        hljs.highlightAll();

        // Smooth scroll for navigation
        document.querySelectorAll('.sidebar-nav a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Scroll to top button
        const scrollTopBtn = document.getElementById('scrollTop');
        window.addEventListener('scroll', () => {
            scrollTopBtn.classList.toggle('visible', window.pageYOffset > 300);
        });

        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Update active nav on scroll
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.sidebar-nav a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
