<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIs - Smart Noter</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/shared/nav-header.js" defer></script>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1><i class="fas fa-microphone"></i> Smart Noter</h1>
            <span class="version">v1.0</span>
        </div>
        <div class="header-right">
            <a href="index.html" class="header-link"><i class="fas fa-home"></i> Inicio</a>
        </div>
    </header>

    <nav class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Inicio</div>
            <ul class="sidebar-nav">
                <li><a href="index.html"><i class="fas fa-home"></i> Visao Geral</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Fundamentos</div>
            <ul class="sidebar-nav">
                <li><a href="design-system.html"><i class="fas fa-palette"></i> Design System</a></li>
                <li><a href="arquitetura.html"><i class="fas fa-sitemap"></i> Arquitetura</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Tecnologia</div>
            <ul class="sidebar-nav">
                <li><a href="stack-tecnologico.html"><i class="fas fa-code"></i> Stack Tecnologico</a></li>
                <li><a href="banco-de-dados.html"><i class="fas fa-database"></i> Banco de Dados</a></li>
                <li><a href="apis-endpoints.html" class="active"><i class="fas fa-plug"></i> APIs</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Desenvolvimento</div>
            <ul class="sidebar-nav">
                <li><a href="pipeline-ia.html"><i class="fas fa-brain"></i> Pipeline IA</a></li>
                <li><a href="implementacao.html"><i class="fas fa-hammer"></i> Implementacao</a></li>
                <li><a href="seguranca.html"><i class="fas fa-shield-alt"></i> Seguranca</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Deploy</div>
            <ul class="sidebar-nav">
                <li><a href="devops.html"><i class="fas fa-server"></i> DevOps</a></li>
                <li><a href="testes.html"><i class="fas fa-vial"></i> Testes</a></li>
                <li><a href="guia-desenvolvimento.html"><i class="fas fa-road"></i> Guia</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="breadcrumb">
            <a href="index.html">Inicio</a> <i class="fas fa-chevron-right"></i> APIs e Endpoints
        </div>

        <h1>APIs e Endpoints</h1>

        <!-- Authentication Endpoints -->
        <h2><i class="fas fa-lock"></i> Authentication Endpoints</h2>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Descricao</th>
                    <th>Auth</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/auth/register</code></td>
                    <td>Registrar novo usuario</td>
                    <td><span class="badge badge-secondary">-</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/auth/login</code></td>
                    <td>Login de usuario</td>
                    <td><span class="badge badge-secondary">-</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/auth/refresh</code></td>
                    <td>Renovar access token</td>
                    <td><span class="badge badge-secondary">-</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/auth/logout</code></td>
                    <td>Logout</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/auth/google</code></td>
                    <td>Login com Google OAuth</td>
                    <td><span class="badge badge-secondary">-</span></td>
                </tr>
            </tbody>
        </table>

        <!-- Notes Endpoints -->
        <h2><i class="fas fa-sticky-note"></i> Notes Endpoints</h2>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Descricao</th>
                    <th>Auth</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge badge-primary">GET</span></td>
                    <td><code>/api/v1/notes</code></td>
                    <td>Listar todas as notas</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-primary">GET</span></td>
                    <td><code>/api/v1/notes/:id</code></td>
                    <td>Buscar nota por ID</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/notes</code></td>
                    <td>Criar nova nota (com audio)</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-secondary">PATCH</span></td>
                    <td><code>/api/v1/notes/:id</code></td>
                    <td>Atualizar nota</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-secondary">DELETE</span></td>
                    <td><code>/api/v1/notes/:id</code></td>
                    <td>Deletar nota</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-primary">GET</span></td>
                    <td><code>/api/v1/notes/:id/export</code></td>
                    <td>Exportar nota (TXT/PDF)</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
            </tbody>
        </table>

        <!-- Folders & Tags Endpoints -->
        <h2><i class="fas fa-folder-open"></i> Folders &amp; Tags Endpoints</h2>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Descricao</th>
                    <th>Auth</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge badge-primary">GET</span></td>
                    <td><code>/api/v1/folders</code></td>
                    <td>Listar pastas</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-success">POST</span></td>
                    <td><code>/api/v1/folders</code></td>
                    <td>Criar pasta</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-secondary">PATCH</span></td>
                    <td><code>/api/v1/notes/:id/move</code></td>
                    <td>Mover nota para pasta</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
                <tr>
                    <td><span class="badge badge-primary">GET</span></td>
                    <td><code>/api/v1/tags</code></td>
                    <td>Listar tags</td>
                    <td><span class="badge badge-info">JWT</span></td>
                </tr>
            </tbody>
        </table>

        <!-- Exemplo de Request/Response -->
        <h2><i class="fas fa-exchange-alt"></i> Exemplo de Request/Response</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-code"></i>
                <h3><span class="badge badge-success">POST</span> /api/v1/notes</h3>
            </div>
            <h4>Request</h4>
<pre><code class="language-javascript">const formData = new FormData();
formData.append('audio', audioBlob, 'recording.webm');
formData.append('title', 'Minha Nota de Voz');
formData.append('folderId', 'folder_abc123');

const response = await fetch('/api/v1/notes', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`
  },
  body: formData
});</code></pre>
            <h4>Response <span class="badge badge-success">201 Created</span></h4>
<pre><code class="language-json">{
  "success": true,
  "data": {
    "id": "note_7f3a2b1c",
    "title": "Minha Nota de Voz",
    "transcription": "Texto transcrito pelo Whisper...",
    "summary": "Resumo gerado pela IA...",
    "tags": ["reuniao", "projeto"],
    "folderId": "folder_abc123",
    "audioUrl": "/uploads/audio/recording_1700000000.webm",
    "createdAt": "2025-01-15T10:30:00.000Z",
    "updatedAt": "2025-01-15T10:30:05.000Z"
  }
}</code></pre>
        </div>

        <!-- Auth Controller -->
        <h2><i class="fas fa-shield-alt"></i> Auth Controller</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-file-code"></i>
                <h3>auth.controller.ts</h3>
            </div>
<pre><code class="language-typescript">import { Request, Response } from 'express';
import bcrypt from 'bcryptjs';
import jwt from 'jsonwebtoken';
import { redis } from '../config/redis';
import { User } from '../models/User';

export class AuthController {

  // POST /api/v1/auth/register
  async register(req: Request, res: Response) {
    const { name, email, password } = req.body;

    const existingUser = await User.findOne({ email });
    if (existingUser) {
      return res.status(409).json({
        success: false,
        error: 'Email ja cadastrado'
      });
    }

    const salt = await bcrypt.genSalt(12);
    const hashedPassword = await bcrypt.hash(password, salt);

    const user = await User.create({
      name,
      email,
      password: hashedPassword
    });

    const accessToken = jwt.sign(
      { userId: user.id, email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '15m' }
    );

    const refreshToken = jwt.sign(
      { userId: user.id },
      process.env.JWT_REFRESH_SECRET!,
      { expiresIn: '7d' }
    );

    // Armazena refresh token no Redis com TTL de 7 dias
    await redis.setex(
      `refresh:${user.id}`,
      7 * 24 * 60 * 60,
      refreshToken
    );

    return res.status(201).json({
      success: true,
      data: {
        user: { id: user.id, name: user.name, email: user.email },
        accessToken,
        refreshToken
      }
    });
  }

  // POST /api/v1/auth/login
  async login(req: Request, res: Response) {
    const { email, password } = req.body;

    const user = await User.findOne({ email }).select('+password');
    if (!user) {
      return res.status(401).json({
        success: false,
        error: 'Credenciais invalidas'
      });
    }

    const isMatch = await bcrypt.compare(password, user.password);
    if (!isMatch) {
      return res.status(401).json({
        success: false,
        error: 'Credenciais invalidas'
      });
    }

    const accessToken = jwt.sign(
      { userId: user.id, email: user.email },
      process.env.JWT_SECRET!,
      { expiresIn: '15m' }
    );

    const refreshToken = jwt.sign(
      { userId: user.id },
      process.env.JWT_REFRESH_SECRET!,
      { expiresIn: '7d' }
    );

    await redis.setex(
      `refresh:${user.id}`,
      7 * 24 * 60 * 60,
      refreshToken
    );

    return res.status(200).json({
      success: true,
      data: {
        user: { id: user.id, name: user.name, email: user.email },
        accessToken,
        refreshToken
      }
    });
  }
}</code></pre>
        </div>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <a href="banco-de-dados.html" class="nav-button prev"><i class="fas fa-arrow-left"></i> Banco</a>
            <a href="pipeline-ia.html" class="nav-button"><span>Pipeline</span> <i class="fas fa-arrow-right"></i></a>
        </div>

        <footer class="footer">
            <p><strong>Smart Noter v1.0</strong> | <a href="index.html">Inicio</a> | <a href="#top">Topo &#8593;</a></p>
        </footer>
    </main>

    <div class="scroll-top" id="scrollTop"><i class="fas fa-arrow-up"></i></div>

    <script>
        hljs.highlightAll();
        const btn = document.getElementById('scrollTop');
        window.addEventListener('scroll', () => btn.classList.toggle('visible', window.pageYOffset > 300));
        btn.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));
    </script>
</body>
</html>
