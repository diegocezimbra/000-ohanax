<div class="header">
  <h2><span class="service-badge security">SECURITY</span> Security Audit</h2>
  <div class="header-actions">
    <div class="date-filter">
      <select id="security-period" onchange="onPeriodChange('security')">
        <option value="7">Ultimos 7 dias</option>
        <option value="30" selected>Ultimos 30 dias</option>
        <option value="90">Ultimos 90 dias</option>
        <option value="365">Ultimo ano</option>
        <option value="custom">Personalizado</option>
      </select>
      <div class="date-range-inputs" id="security-custom-dates" style="display: none;">
        <input type="date" id="security-start-date">
        <span>ate</span>
        <input type="date" id="security-end-date">
      </div>
    </div>
    <button class="refresh-btn" onclick="loadProjectPage('security')">Atualizar</button>
  </div>
</div>

<!-- ============================================================================= -->
<!-- RESUMO EXECUTIVO - KPIs mais importantes no topo -->
<!-- ============================================================================= -->
<div class="cards">
  <div class="card highlight">
    <div class="card-title">MRR <span class="info-tooltip" data-tooltip="Monthly Recurring Revenue - Receita mensal recorrente de assinaturas ativas."></span></div>
    <div class="card-value" id="security-mrr">R$ --</div>
    <div class="card-subtitle">Receita recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">ARR <span class="info-tooltip" data-tooltip="Annual Recurring Revenue - MRR x 12. Projecao anual."></span></div>
    <div class="card-value" id="security-arr">R$ --</div>
    <div class="card-subtitle">Projecao anual</div>
  </div>
  <div class="card">
    <div class="card-title">Clientes Pagantes <span class="info-tooltip" data-tooltip="Total de clientes unicos que pagaram (assinatura ou pacote avulso)."></span></div>
    <div class="card-value" id="security-unique-customers" style="color: #22c55e;">--</div>
    <div class="card-subtitle">Assinantes + One-Time</div>
  </div>
  <div class="card">
    <div class="card-title">Taxa de Conversao <span class="info-tooltip tooltip-left" data-tooltip="Porcentagem de trials que viraram pagantes. Metrica chave de eficiencia do funil."></span></div>
    <div class="card-value" id="security-conversion-rate" style="color: #f59e0b;">--%</div>
    <div class="card-subtitle">Trial → Pagante</div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- FUNIL VISUAL DE ANALYTICS - Diagrama completo da jornada do usuario -->
<!-- Dados do nosso banco interno (security_analytics_events) -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
    <span>Mapa de Navegacao do Usuario</span>
    <span style="font-size: 11px; color: #3b82f6; font-weight: 500; background: rgba(59, 130, 246, 0.1); padding: 2px 8px; border-radius: 4px;">Analytics Interno</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Funil completo baseado nos eventos trackeados pelo nosso sistema. Mostra a jornada do usuario desde a pagina inicial ate a compra."></span>
  </div>

  <!-- Diagrama Visual do Funil - Layout Vertical (Mobile-First) -->
  <div class="nav-funnel-vertical" id="analytics-funnel-diagram">
    <!-- Step 1: Página do Scan -->
    <div class="funnel-v-step" data-step="1">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Pagina do Scan</span>
        <span class="funnel-v-value" id="af-step-1-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-1-pct">100%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-1">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 2: Inicio Formulario -->
    <div class="funnel-v-step" data-step="2">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Inicio Formulario</span>
        <span class="funnel-v-value" id="af-step-2-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-2-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-2">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 3: Formulario Enviado -->
    <div class="funnel-v-step" data-step="3">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2L15 22l-4-9-9-4 20-7z"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Formulario Enviado</span>
        <span class="funnel-v-value" id="af-step-3-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-3-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-3">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 4: Scan Iniciado -->
    <div class="funnel-v-step" data-step="4">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Scan Iniciado</span>
        <span class="funnel-v-value" id="af-step-4-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-4-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-4">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 5: Encontrou Vulns (highlight) -->
    <div class="funnel-v-step highlight" data-step="5">
      <div class="funnel-v-icon" style="color: #ef4444;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Encontrou Vulns</span>
        <span class="funnel-v-value" id="af-step-5-count">--</span>
      </div>
      <span class="funnel-v-pct highlight" id="af-step-5-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-5">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 6: Pag. de Desbloqueio -->
    <div class="funnel-v-step" data-step="6">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Pag. Desbloqueio</span>
        <span class="funnel-v-value" id="af-step-6-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-6-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-6">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 7: Clicou Desbloquear -->
    <div class="funnel-v-step" data-step="7">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Clicou Desbloquear</span>
        <span class="funnel-v-value" id="af-step-7-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-7-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-7">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 8: Checkout Criado -->
    <div class="funnel-v-step" data-step="8">
      <div class="funnel-v-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Checkout Criado</span>
        <span class="funnel-v-value" id="af-step-8-count">--</span>
      </div>
      <span class="funnel-v-pct" id="af-step-8-pct">--%</span>
    </div>
    <div class="funnel-v-connector">
      <div class="funnel-v-line"></div>
      <div class="funnel-v-dropout" id="af-dropout-8">-<span class="dropout-num">--</span></div>
    </div>

    <!-- Step 9: Pagamento Concluido (success) -->
    <div class="funnel-v-step success" data-step="9">
      <div class="funnel-v-icon" style="color: #10b981;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      </div>
      <div class="funnel-v-info">
        <span class="funnel-v-label">Pagamento Concluido</span>
        <span class="funnel-v-value" id="af-step-9-count">--</span>
      </div>
      <span class="funnel-v-pct success" id="af-step-9-pct">--%</span>
    </div>
  </div>

</div>

<!-- ============================================================================= -->
<!-- VARIACOES DE LANDING PAGE - A/B Testing -->
<!-- Comparativo entre /scan (original), /scan-video e /scan-pro -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
    <span>Variacoes de Landing Page (A/B Test)</span>
    <span style="font-size: 11px; color: #8b5cf6; font-weight: 500; background: rgba(139, 92, 246, 0.1); padding: 2px 8px; border-radius: 4px;">EXPERIMENTO</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Comparativo entre as diferentes versoes da pagina de scan: Original (/scan), Video (/scan-video) e Pro (/scan-pro)."></span>
  </div>

  <!-- Cards de comparacao -->
  <div class="variations-grid">
    <!-- Variacao A: /scan-video -->
    <div class="variation-card video">
      <div class="variation-header">
        <div class="variation-icon" style="background: rgba(239, 68, 68, 0.15); color: #ef4444;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
        </div>
        <div class="variation-title">
          <span class="variation-name">Scan Video</span>
          <span class="variation-path">/scan-video</span>
        </div>
        <span class="variation-badge video">VAR A</span>
      </div>
      <div class="variation-description">Landing com video explicativo antes do formulario</div>

      <div class="variation-funnel">
        <div class="variation-step">
          <span class="variation-step-name">Pagina</span>
          <span class="variation-step-value" id="var-video-page">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Video Play</span>
          <span class="variation-step-value" id="var-video-play">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Form Start</span>
          <span class="variation-step-value" id="var-video-form-start">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Submit</span>
          <span class="variation-step-value" id="var-video-submit">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step highlight">
          <span class="variation-step-name">Scan</span>
          <span class="variation-step-value" id="var-video-scan">--</span>
        </div>
      </div>

      <div class="variation-conversion">
        <span class="variation-conversion-label">Conversao Geral</span>
        <span class="variation-conversion-value" id="var-video-conversion">--%</span>
      </div>
    </div>

    <!-- Variacao B: /scan-pro -->
    <div class="variation-card pro">
      <div class="variation-header">
        <div class="variation-icon" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        </div>
        <div class="variation-title">
          <span class="variation-name">Scan Pro</span>
          <span class="variation-path">/scan-pro</span>
        </div>
        <span class="variation-badge pro">VAR B</span>
      </div>
      <div class="variation-description">Landing com quiz de seguranca e tecnicas de psicologia</div>

      <div class="variation-funnel">
        <div class="variation-step">
          <span class="variation-step-name">Pagina</span>
          <span class="variation-step-value" id="var-pro-page">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Quiz Start</span>
          <span class="variation-step-value" id="var-pro-quiz-start">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Quiz Done</span>
          <span class="variation-step-value" id="var-pro-quiz-done">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Form Start</span>
          <span class="variation-step-value" id="var-pro-form-start">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step">
          <span class="variation-step-name">Submit</span>
          <span class="variation-step-value" id="var-pro-submit">--</span>
        </div>
        <div class="variation-step-arrow">→</div>
        <div class="variation-step highlight">
          <span class="variation-step-name">Scan</span>
          <span class="variation-step-value" id="var-pro-scan">--</span>
        </div>
      </div>

      <div class="variation-conversion">
        <span class="variation-conversion-label">Conversao Geral</span>
        <span class="variation-conversion-value" id="var-pro-conversion">--%</span>
      </div>
    </div>
  </div>

  <!-- Tabela comparativa -->
  <div class="variations-comparison" style="margin-top: 20px;">
    <div class="variations-comparison-header">
      <span class="variations-comparison-title">Comparativo de Performance</span>
    </div>
    <table class="variations-table">
      <thead>
        <tr>
          <th>Metrica</th>
          <th>Original (/scan)</th>
          <th>Video (/scan-video)</th>
          <th>Pro (/scan-pro)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Page Views</td>
          <td id="cmp-original-pv">--</td>
          <td id="cmp-video-pv">--</td>
          <td id="cmp-pro-pv">--</td>
        </tr>
        <tr>
          <td>Form Starts</td>
          <td id="cmp-original-fs">--</td>
          <td id="cmp-video-fs">--</td>
          <td id="cmp-pro-fs">--</td>
        </tr>
        <tr>
          <td>Form Submits</td>
          <td id="cmp-original-sub">--</td>
          <td id="cmp-video-sub">--</td>
          <td id="cmp-pro-sub">--</td>
        </tr>
        <tr>
          <td>Scans Iniciados</td>
          <td id="cmp-original-scan">--</td>
          <td id="cmp-video-scan">--</td>
          <td id="cmp-pro-scan">--</td>
        </tr>
        <tr>
          <td>Encontrou Vulns</td>
          <td id="cmp-original-vulns">--</td>
          <td id="cmp-video-vulns">--</td>
          <td id="cmp-pro-vulns">--</td>
        </tr>
        <tr>
          <td>Pag. Desbloqueio</td>
          <td id="cmp-original-payment">--</td>
          <td id="cmp-video-payment">--</td>
          <td id="cmp-pro-payment">--</td>
        </tr>
        <tr>
          <td>Clicou Desbloquear</td>
          <td id="cmp-original-unlock">--</td>
          <td id="cmp-video-unlock">--</td>
          <td id="cmp-pro-unlock">--</td>
        </tr>
        <tr>
          <td>Checkout Criado</td>
          <td id="cmp-original-checkout">--</td>
          <td id="cmp-video-checkout">--</td>
          <td id="cmp-pro-checkout">--</td>
        </tr>
        <tr>
          <td>Pagamento Concluido</td>
          <td id="cmp-original-paid">--</td>
          <td id="cmp-video-paid">--</td>
          <td id="cmp-pro-paid">--</td>
        </tr>
        <tr class="highlight">
          <td>Conversao (PV → Pago)</td>
          <td id="cmp-original-conv">--%</td>
          <td id="cmp-video-conv">--%</td>
          <td id="cmp-pro-conv">--%</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ============================================================================= -->
<!-- FUNIL DE TRIAL - A jornada do lead -->
<!-- Secao mais importante: mostra de onde vem os clientes -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <span>Funil de Aquisicao</span>
    <span style="font-size: 11px; color: #64748b; background: #1e293b; padding: 2px 8px; border-radius: 4px; font-weight: 500;">(Dados do banco)</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Jornada do visitante ate virar cliente pagante. Dados reais da tabela security_trial_sessions."></span>
  </div>

  <!-- Funil horizontal visual -->
  <div class="acquisition-funnel">
    <div class="acquisition-step">
      <div class="acquisition-step-header" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, transparent 100%);">
        <div class="acquisition-step-icon" style="color: #3b82f6;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/><path d="M9 12l2 2 4-4"/></svg>
        </div>
        <div class="acquisition-step-label">Trials Iniciados</div>
      </div>
      <div class="acquisition-step-value" id="db-funnel-started">--</div>
      <div class="acquisition-step-subtitle">Entrada do funil</div>
    </div>
    <div class="acquisition-arrow">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </div>
    <div class="acquisition-step">
      <div class="acquisition-step-header" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, transparent 100%);">
        <div class="acquisition-step-icon" style="color: #8b5cf6;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        </div>
        <div class="acquisition-step-label">Completados</div>
      </div>
      <div class="acquisition-step-value" id="db-funnel-completed">--</div>
      <div class="acquisition-step-subtitle" id="db-funnel-completed-pct">--% dos iniciados</div>
    </div>
    <div class="acquisition-arrow">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </div>
    <div class="acquisition-step">
      <div class="acquisition-step-header" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, transparent 100%);">
        <div class="acquisition-step-icon" style="color: #f59e0b;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
        </div>
        <div class="acquisition-step-label">Pagaram</div>
      </div>
      <div class="acquisition-step-value" style="color: #f59e0b;" id="db-funnel-paid">--</div>
      <div class="acquisition-step-subtitle" id="db-funnel-paid-pct">--% dos completados</div>
    </div>
    <div class="acquisition-arrow">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
    </div>
    <div class="acquisition-step highlight">
      <div class="acquisition-step-header" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, transparent 100%);">
        <div class="acquisition-step-icon" style="color: #10b981;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17 11 19 13 23 9"/></svg>
        </div>
        <div class="acquisition-step-label">Registraram</div>
      </div>
      <div class="acquisition-step-value" style="color: #10b981;" id="db-funnel-registered">--</div>
      <div class="acquisition-step-subtitle" id="db-funnel-registered-pct">--% conversao total</div>
    </div>
  </div>

  <div class="grid-2" style="margin-top: 20px;">
    <div>
      <div id="db-trial-funnel-chart" style="height: 260px;"></div>
    </div>
    <div class="acquisition-metrics">
      <div class="acquisition-metric-card highlight">
        <div class="acquisition-metric-icon" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        </div>
        <div class="acquisition-metric-content">
          <span class="acquisition-metric-label">Com Vulnerabilidades</span>
          <span class="acquisition-metric-value" id="db-funnel-with-vulns" style="color: #f59e0b;">--</span>
        </div>
      </div>
      <div class="acquisition-metric-row">
        <span class="acquisition-metric-label">Taxa Vuln → Pagamento</span>
        <span class="acquisition-metric-value" id="db-funnel-vuln-conversion" style="color: #f59e0b;">--%</span>
      </div>
      <div class="acquisition-metric-row">
        <span class="acquisition-metric-label">Tempo medio p/ Pagar</span>
        <span class="acquisition-metric-value" id="db-funnel-time-to-pay">-- h</span>
      </div>
      <div class="acquisition-metric-row">
        <span class="acquisition-metric-label">Tempo medio p/ Registrar</span>
        <span class="acquisition-metric-value" id="db-funnel-time-to-register">-- h</span>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- LEADS CAPTURADOS - Emails/WhatsApp capturados no formulario -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title scans-title-row">
    <div class="scans-title-left">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #f59e0b;"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
      Leads Capturados
      <span class="scans-count-badge" id="leads-count">0</span>
      <span class="info-tooltip" data-tooltip="Emails e WhatsApp capturados quando o usuario comeca a preencher o formulario de scan. Leads parciais para remarketing."></span>
    </div>
    <button class="refresh-btn" onclick="loadLeads(1)">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
      Atualizar
    </button>
  </div>

  <div class="scans-filters">
    <div class="scans-filter-group">
      <label>Status</label>
      <select id="leads-status" onchange="loadLeads(1)">
        <option value="">Todos</option>
        <option value="partial">Parcial</option>
        <option value="new">Novo</option>
        <option value="scanning">Escaneando</option>
        <option value="completed">Completado</option>
        <option value="paid">Pago</option>
        <option value="registered">Registrado</option>
      </select>
    </div>
    <div class="scans-filter-group search">
      <label>Buscar</label>
      <div class="scans-search-input">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="leads-search" placeholder="Email, WhatsApp, URL..." onkeyup="debounceLeadsSearch()">
      </div>
    </div>
  </div>

  <div class="scans-table-wrapper">
    <table class="scans-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>WhatsApp</th>
          <th>URL</th>
          <th>Origem</th>
          <th>UTM</th>
          <th>Status</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="leads-table">
        <tr><td colspan="7" class="loading">Carregando...</td></tr>
      </tbody>
    </table>
  </div>
  <div class="scans-pagination" id="leads-pagination"></div>
</div>

<!-- ============================================================================= -->
<!-- RECEITA - Detalhamento financeiro -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #10b981;"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
    Receita
    <span class="info-tooltip" data-tooltip="Detalhamento de toda receita gerada no periodo."></span>
  </div>

  <div class="revenue-grid">
    <!-- Coluna esquerda: KPIs de receita -->
    <div class="revenue-kpis">
      <div class="revenue-kpi-row">
        <div class="revenue-kpi-card">
          <div class="revenue-kpi-icon" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
          </div>
          <div class="revenue-kpi-content">
            <span class="revenue-kpi-label">Assinaturas</span>
            <span class="revenue-kpi-value" id="security-sub-revenue">R$ --</span>
            <span class="revenue-kpi-meta" id="security-subs">-- assinantes ativos</span>
          </div>
        </div>
        <div class="revenue-kpi-card">
          <div class="revenue-kpi-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
          </div>
          <div class="revenue-kpi-content">
            <span class="revenue-kpi-label">One-Time</span>
            <span class="revenue-kpi-value" id="security-onetime-revenue">R$ --</span>
            <span class="revenue-kpi-meta" id="security-onetime-count">-- pacotes vendidos</span>
          </div>
        </div>
      </div>
      <!-- Card de receita total -->
      <div class="revenue-total-card">
        <div class="revenue-total-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        </div>
        <div class="revenue-total-content">
          <span class="revenue-total-label">Receita Total</span>
          <span class="revenue-total-value" id="security-total-revenue">R$ --</span>
          <span class="revenue-total-meta">MRR + One-Time</span>
        </div>
      </div>
    </div>
    <!-- Coluna direita: Transações recentes -->
    <div class="revenue-transactions">
      <div class="revenue-transactions-header">
        <span class="revenue-transactions-title">Transacoes Recentes</span>
        <span class="info-tooltip tooltip-left" data-tooltip="Ultimos assinantes e compradores de pacotes avulsos."></span>
      </div>
      <div class="revenue-transactions-list">
        <table>
          <thead>
            <tr><th>Email</th><th>Plano/Pacote</th><th>Valor</th><th>Tipo</th><th>Data</th></tr>
          </thead>
          <tbody id="security-table"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- USUARIOS - Base de usuarios -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    Base de Usuarios
    <span class="info-tooltip" data-tooltip="Visao geral de todos os usuarios cadastrados."></span>
  </div>

  <div class="users-grid">
    <!-- Coluna esquerda: Métricas e gráfico -->
    <div class="users-metrics-col">
      <div class="users-metrics-row">
        <div class="user-metric-card">
          <div class="user-metric-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <div class="user-metric-content">
            <span class="user-metric-value" id="security-users">--</span>
            <span class="user-metric-label">Total</span>
          </div>
          <span class="info-tooltip" data-tooltip="Todos os usuarios registrados."></span>
        </div>
        <div class="user-metric-card">
          <div class="user-metric-icon" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          </div>
          <div class="user-metric-content">
            <span class="user-metric-value" id="security-users-verified">--</span>
            <span class="user-metric-label">Verificados</span>
          </div>
          <span class="info-tooltip" data-tooltip="Confirmaram email."></span>
        </div>
        <div class="user-metric-card">
          <div class="user-metric-icon" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
          </div>
          <div class="user-metric-content">
            <span class="user-metric-value" id="security-users-active">--</span>
            <span class="user-metric-label">Ativos (7d)</span>
          </div>
          <span class="info-tooltip" data-tooltip="Ativos nos ultimos 7 dias."></span>
        </div>
        <div class="user-metric-card highlight">
          <div class="user-metric-icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
          </div>
          <div class="user-metric-content">
            <span class="user-metric-value" style="color: #10b981;" id="security-users-today">--</span>
            <span class="user-metric-label">Hoje</span>
          </div>
          <span class="info-tooltip tooltip-left" data-tooltip="Novos usuarios hoje."></span>
        </div>
      </div>
      <div class="users-chart-container">
        <div id="securityChart" style="height: 180px;"></div>
      </div>
    </div>
    <!-- Coluna direita: Conversões recentes -->
    <div class="users-conversions-col">
      <div class="users-conversions-header">
        <span class="users-conversions-title">Conversoes Recentes</span>
        <span class="info-tooltip tooltip-left" data-tooltip="Ultimos usuarios que completaram: trial → pagamento → registro."></span>
      </div>
      <div class="users-conversions-list" id="db-funnel-recent-conversions">
        <div class="users-loading">Carregando...</div>
      </div>
    </div>
  </div>
</div>


<!-- ============================================================================= -->
<!-- SCANS POR DIA - Grafico de tendencia -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/></svg>
    Scans por Dia
    <span class="info-tooltip" data-tooltip="Volume de scans executados por dia. Mostra tendencia de uso."></span>
  </div>
  <div class="chart-container">
    <div id="securityScansChart" style="height: 220px;"></div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- TODOS OS SCANS - Lista completa com filtros -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title scans-title-row">
    <div class="scans-title-left">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      Todos os Scans
      <span class="scans-count-badge" id="all-scans-count">0</span>
      <span class="info-tooltip" data-tooltip="Lista completa de todos os scans (trial + pagos), do mais recente ao mais antigo."></span>
    </div>
    <button class="refresh-btn" onclick="loadAllScans(1)">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
      Atualizar
    </button>
  </div>

  <div class="scans-filters">
    <div class="scans-filter-group">
      <label>Tipo</label>
      <select id="all-scans-type" onchange="loadAllScans(1)">
        <option value="">Todos</option>
        <option value="trial">Trial</option>
        <option value="paid">Pago</option>
      </select>
    </div>
    <div class="scans-filter-group">
      <label>Status</label>
      <select id="all-scans-status" onchange="loadAllScans(1)">
        <option value="">Todos</option>
        <option value="pending">Pendente</option>
        <option value="scanning">Escaneando</option>
        <option value="completed">Completado</option>
        <option value="claimed">Resgatado</option>
        <option value="expired">Expirado</option>
        <option value="failed">Falhou</option>
      </select>
    </div>
    <div class="scans-filter-group search">
      <label>Buscar</label>
      <div class="scans-search-input">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="all-scans-search" placeholder="Email, URL, projeto..." onkeyup="debounceAllScansSearch()">
      </div>
    </div>
  </div>

  <div class="scans-table-wrapper">
    <table class="scans-table">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Email</th>
          <th>Frontend URL</th>
          <th>Backend URL</th>
          <th>Projeto</th>
          <th>Status</th>
          <th>Pagamento</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="all-scans-table">
        <tr><td colspan="8" class="loading">Carregando...</td></tr>
      </tbody>
    </table>
  </div>
  <div class="scans-pagination" id="all-scans-pagination"></div>
</div>


<!-- ============================================================================= -->
<!-- ACTIVITY LOG - Registro de atividades dos usuarios -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #f59e0b;"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
    Activity Log
    <span class="activity-period-badge">Ultimos 30 dias</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Registro de acoes dos usuarios: logins, scans, exports, etc. Util para analise de comportamento e debug."></span>
  </div>

  <div class="activity-log-metrics">
    <div class="activity-log-card">
      <div class="activity-log-icon" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      </div>
      <div class="activity-log-content">
        <span class="activity-log-value" id="security-activity-total">--</span>
        <span class="activity-log-label">Total Acoes</span>
      </div>
      <span class="info-tooltip" data-tooltip="Soma de todas as acoes registradas no periodo."></span>
    </div>
    <div class="activity-log-card">
      <div class="activity-log-icon" style="background: rgba(16, 185, 129, 0.15); color: #10b981;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      </div>
      <div class="activity-log-content">
        <span class="activity-log-value" style="color: #10b981;" id="security-activity-logins">--</span>
        <span class="activity-log-label">Logins</span>
      </div>
      <span class="info-tooltip" data-tooltip="Logins bem-sucedidos. Indica engajamento."></span>
    </div>
    <div class="activity-log-card warning">
      <div class="activity-log-icon" style="background: rgba(239, 68, 68, 0.15); color: #ef4444;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
      </div>
      <div class="activity-log-content">
        <span class="activity-log-value" style="color: #ef4444;" id="security-activity-failed-logins">--</span>
        <span class="activity-log-label">Logins Falhos</span>
      </div>
      <span class="info-tooltip" data-tooltip="Tentativas de login que falharam. Muitos de um mesmo IP pode indicar ataque."></span>
    </div>
    <div class="activity-log-card">
      <div class="activity-log-icon" style="background: rgba(139, 92, 246, 0.15); color: #8b5cf6;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </div>
      <div class="activity-log-content">
        <span class="activity-log-value" id="security-activity-scans">--</span>
        <span class="activity-log-label">Scans</span>
      </div>
      <span class="info-tooltip tooltip-left" data-tooltip="Scans iniciados por usuarios logados."></span>
    </div>
  </div>

  <div class="chart-container" style="margin-top: 16px;">
    <div id="securityActivityChart" style="height: 180px;"></div>
  </div>

  <div class="activity-details-grid">
    <div class="activity-details-card">
      <div class="activity-details-header">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;"><path d="M3 3v18h18"/><path d="M18 17l-5-5-4 4-3-3"/></svg>
        <span class="activity-details-title">Por Tipo de Acao</span>
        <span class="info-tooltip" data-tooltip="Ranking das acoes mais executadas."></span>
      </div>
      <div class="activity-details-list" id="security-activity-by-action">
        <div class="activity-loading">Carregando...</div>
      </div>
    </div>
    <div class="activity-details-card">
      <div class="activity-details-header">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span class="activity-details-title">Usuarios Mais Ativos</span>
        <span class="info-tooltip tooltip-left" data-tooltip="Ranking dos usuarios com mais acoes."></span>
      </div>
      <div class="activity-details-list" id="security-activity-by-user">
        <div class="activity-loading">Carregando...</div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- SEGURANCA - Logins falhos e atividades recentes -->
<!-- ============================================================================= -->
<div class="security-monitoring-grid">
  <div class="security-card danger">
    <div class="security-card-header">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #ef4444;"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      <span class="security-card-title">Logins Falhos (24h)</span>
      <span id="security-suspicious-ips" class="security-suspicious-badge"></span>
      <span class="info-tooltip" data-tooltip="Tentativas de login que falharam nas ultimas 24h. Monitore para detectar ataques."></span>
    </div>
    <div class="security-card-list" id="security-failed-logins-list">
      <div class="activity-loading">Carregando...</div>
    </div>
  </div>
  <div class="security-card">
    <div class="security-card-header">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #10b981;"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      <span class="security-card-title">Atividades Recentes</span>
      <span class="info-tooltip tooltip-left" data-tooltip="Ultimas 20 acoes realizadas na plataforma."></span>
    </div>
    <div class="security-table-wrapper">
      <table class="security-table">
        <thead>
          <tr><th>Usuario</th><th>Acao</th><th>IP</th><th>Data</th></tr>
        </thead>
        <tbody id="security-activity-table">
          <tr><td colspan="4" class="loading">Carregando...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Hidden elements for backward compatibility -->
<div style="display: none;">
  <span id="security-users-total"></span>
  <span id="security-subs-active"></span>
  <span id="security-subs-trial"></span>
  <span id="security-subs-canceled"></span>
  <span id="security-scans-total"></span>
  <span id="security-scans-paid"></span>
  <span id="security-scans-free"></span>
  <span id="security-scans-trial"></span>
  <span id="security-onetime-paid"></span>
  <span id="security-onetime-pending"></span>
  <span id="security-revenue-subs"></span>
  <span id="security-revenue-onetime"></span>
  <span id="security-revenue"></span>
  <span id="security-paid-percentage"></span>
</div>
