<div class="header">
  <h2><span class="service-badge security">SECURITY</span> Security Audit</h2>
  <div class="header-actions">
    <div class="date-filter">
      <select id="security-period" onchange="onPeriodChange('security')">
        <option value="7">Ultimos 7 dias</option>
        <option value="30" selected>Ultimos 30 dias</option>
        <option value="90">Ultimos 90 dias</option>
        <option value="365">Ultimo ano</option>
        <option value="custom">Personalizado</option>
      </select>
      <div class="date-range-inputs" id="security-custom-dates" style="display: none;">
        <input type="date" id="security-start-date">
        <span>ate</span>
        <input type="date" id="security-end-date">
      </div>
    </div>
    <button class="refresh-btn" onclick="loadProjectPage('security')">Atualizar</button>
  </div>
</div>

<!-- ============================================================================= -->
<!-- CARDS PRINCIPAIS - Métricas financeiras e de usuários -->
<!-- ============================================================================= -->
<div class="cards">
  <div class="card highlight">
    <div class="card-title">MRR Total <span class="info-tooltip" data-tooltip="Monthly Recurring Revenue - Receita que você recebe todo mês de assinaturas ativas. É a métrica mais importante para negócios SaaS pois mostra receita previsível."></span></div>
    <div class="card-value" id="security-mrr">R$ --</div>
    <div class="card-subtitle">Receita mensal recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Receita One-Time <span class="info-tooltip" data-tooltip="Receita de vendas únicas (pacotes avulsos). Diferente do MRR, esse dinheiro entra uma vez só, sem recorrência mensal."></span></div>
    <div class="card-value" id="security-onetime-revenue">R$ --</div>
    <div class="card-subtitle">Pacotes vendidos</div>
  </div>
  <div class="card">
    <div class="card-title">Receita Total <span class="info-tooltip" data-tooltip="Soma de MRR + One-Time. Mostra todo o dinheiro que entrou no período selecionado."></span></div>
    <div class="card-value" id="security-total-revenue">R$ --</div>
    <div class="card-subtitle">MRR + One-Time</div>
  </div>
  <div class="card">
    <div class="card-title">Usuarios Total <span class="info-tooltip" data-tooltip="Quantidade total de usuários que criaram conta na plataforma, independente de pagarem ou não."></span></div>
    <div class="card-value" id="security-users">--</div>
    <div class="card-subtitle">Usuarios registrados</div>
  </div>
</div>

<div class="cards" style="margin-top: -10px;">
  <div class="card">
    <div class="card-title">ARR Total <span class="info-tooltip" data-tooltip="Annual Recurring Revenue - MRR multiplicado por 12. Projeção de quanto você ganharia em um ano se mantiver os mesmos assinantes."></span></div>
    <div class="card-value" id="security-arr">R$ --</div>
    <div class="card-subtitle">Receita anual recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Assinantes Ativos <span class="info-tooltip" data-tooltip="Usuários com assinatura ativa que estão pagando mensalmente. Inclui quem está em trial (período de teste gratuito)."></span></div>
    <div class="card-value" id="security-subs">--</div>
    <div class="card-subtitle">Assinantes pagantes</div>
  </div>
  <div class="card">
    <div class="card-title">Pacotes Vendidos <span class="info-tooltip" data-tooltip="Quantidade de pacotes avulsos vendidos (compras únicas, não recorrentes)."></span></div>
    <div class="card-value" id="security-onetime-count">--</div>
    <div class="card-subtitle">One-time pagos</div>
  </div>
  <div class="card">
    <div class="card-title">Clientes Unicos <span class="info-tooltip" data-tooltip="Total de pessoas que pagaram algo (assinatura ou pacote). Uma pessoa que tem assinatura E comprou pacote conta como 1 cliente único."></span></div>
    <div class="card-value" id="security-unique-customers">--</div>
    <div class="card-subtitle">Assinantes + Compradores</div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- DETALHES DE USUÁRIOS E ASSINATURAS -->
<!-- ============================================================================= -->
<div class="grid-2">
  <div class="section">
    <div class="section-title">Usuarios <span class="info-tooltip" data-tooltip="Detalhamento dos usuários cadastrados na plataforma Security."></span></div>
    <div class="metric-row">
      <span class="metric-label">Total <span class="info-tooltip" data-tooltip="Todos os usuários que já criaram conta, mesmo que nunca usaram."></span></span>
      <span class="metric-value" id="security-users-total">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Verificados <span class="info-tooltip" data-tooltip="Usuários que confirmaram o email. Importante para garantir que os contatos são válidos."></span></span>
      <span class="metric-value" id="security-users-verified">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Ativos (7d) <span class="info-tooltip" data-tooltip="Usuários que fizeram login ou alguma ação nos últimos 7 dias. Mostra engajamento real."></span></span>
      <span class="metric-value" id="security-users-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Novos hoje <span class="info-tooltip" data-tooltip="Usuários que criaram conta hoje. Útil para medir resultado de campanhas."></span></span>
      <span class="metric-value" id="security-users-today">--</span>
    </div>
  </div>
  <div class="section">
    <div class="section-title">Assinaturas <span class="info-tooltip" data-tooltip="Status das assinaturas mensais/anuais."></span></div>
    <div class="metric-row">
      <span class="metric-label">Ativos <span class="info-tooltip" data-tooltip="Assinantes que estão pagando regularmente e com acesso liberado."></span></span>
      <span class="metric-value" id="security-subs-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Em Trial <span class="info-tooltip" data-tooltip="Usuários em período de teste gratuito. Ainda não pagaram mas podem converter."></span></span>
      <span class="metric-value" id="security-subs-trial">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Cancelados <span class="info-tooltip" data-tooltip="Assinaturas canceladas. Analisar motivos pode ajudar a reduzir churn (cancelamentos)."></span></span>
      <span class="metric-value" id="security-subs-canceled">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Receita Assinaturas <span class="info-tooltip" data-tooltip="Total de dinheiro recebido apenas de assinaturas (não inclui pacotes avulsos)."></span></span>
      <span class="metric-value" id="security-sub-revenue">R$ --</span>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- SCANS EXECUTADOS E PACOTES -->
<!-- ============================================================================= -->
<div class="grid-2">
  <div class="section">
    <div class="section-title">Scans Executados <span class="info-tooltip" data-tooltip="Análises de segurança realizadas pelos usuários em seus sites/aplicações."></span></div>
    <div class="metric-row">
      <span class="metric-label">Total de Scans <span class="info-tooltip" data-tooltip="Quantidade total de scans executados no período."></span></span>
      <span class="metric-value" id="security-scans-total">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Scans Pagos <span class="info-tooltip" data-tooltip="Scans feitos por usuários que pagaram (assinantes ou compradores de pacote). Gera receita."></span></span>
      <span class="metric-value" id="security-scans-paid" style="color: #22c55e;">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Scans Gratuitos <span class="info-tooltip" data-tooltip="Scans inclusos no plano gratuito ou como bônus. Não gera receita direta mas pode converter."></span></span>
      <span class="metric-value" id="security-scans-free">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Trials <span class="info-tooltip" data-tooltip="Scans feitos na página /trial por visitantes que ainda não são clientes. Principal fonte de leads."></span></span>
      <span class="metric-value" id="security-scans-trial">--</span>
    </div>
  </div>
  <div class="section">
    <div class="section-title">Pacotes One-Time <span class="info-tooltip" data-tooltip="Vendas de pacotes avulsos (compra única, sem mensalidade)."></span></div>
    <div class="metric-row">
      <span class="metric-label">Vendas Pagas <span class="info-tooltip" data-tooltip="Pacotes que foram pagos e entregues ao cliente."></span></span>
      <span class="metric-value" id="security-onetime-paid">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Pendentes <span class="info-tooltip" data-tooltip="Pacotes aguardando pagamento. Pode ser boleto não pago ou cartão recusado."></span></span>
      <span class="metric-value" id="security-onetime-pending">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Receita One-Time <span class="info-tooltip" data-tooltip="Total de receita gerada por vendas de pacotes avulsos."></span></span>
      <span class="metric-value" id="security-onetime-revenue">R$ --</span>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- GRÁFICO DE SCANS POR DIA -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">Scans por Dia (Ultimos 30 dias) <span class="info-tooltip" data-tooltip="Gráfico mostrando quantos scans foram executados em cada dia. Útil para identificar padrões (ex: mais scans em dias úteis) e picos de uso."></span></div>
  <div id="securityScansChart" style="height: 280px;"></div>
</div>

<!-- ============================================================================= -->
<!-- SCANS DE HOJE -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">Scans Executados Hoje <span class="info-tooltip" data-tooltip="Atividade de scans em tempo real do dia atual."></span></div>
  <div class="grid-2">
    <div>
      <div class="metric-row" style="background: rgba(239, 68, 68, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
        <span class="metric-label" style="font-size: 16px;">Total de Scans Hoje <span class="info-tooltip" data-tooltip="Quantidade de scans executados desde meia-noite de hoje."></span></span>
        <span class="metric-value" id="security-today-total" style="font-size: 28px; color: #ef4444;">--</span>
      </div>
      <div style="font-size: 14px; color: #94a3b8; margin-bottom: 8px;">Scans por Usuario (Hoje) <span class="info-tooltip" data-tooltip="Ranking de usuários que mais executaram scans hoje."></span></div>
      <div id="security-scans-by-user" style="max-height: 100px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
    <div>
      <div style="font-size: 14px; color: #94a3b8; margin-bottom: 8px;">Lista de Scans (Hoje) <span class="info-tooltip" data-tooltip="Lista detalhada de todos os scans executados hoje, com nome do projeto, usuário e status."></span></div>
      <div id="security-today-scans-list" style="max-height: 160px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- RECEITA E PORCENTAGEM -->
<!-- ============================================================================= -->
<div class="grid-2">
  <div class="section">
    <div class="section-title">Receita Total <span class="info-tooltip" data-tooltip="Breakdown da receita por fonte (assinaturas vs pacotes)."></span></div>
    <div class="metric-row">
      <span class="metric-label">Assinaturas <span class="info-tooltip" data-tooltip="Receita recorrente mensal de assinantes ativos."></span></span>
      <span class="metric-value" id="security-revenue-subs">R$ --</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Pacotes One-Time <span class="info-tooltip" data-tooltip="Receita de vendas únicas de pacotes avulsos."></span></span>
      <span class="metric-value" id="security-revenue-onetime">R$ --</span>
    </div>
    <div class="metric-row" style="border-top: 2px solid #3b82f6; padding-top: 12px;">
      <span class="metric-label" style="font-weight: bold;">Total Geral <span class="info-tooltip" data-tooltip="Soma de todas as receitas (assinaturas + pacotes)."></span></span>
      <span class="metric-value" id="security-revenue" style="color: #3b82f6;">R$ --</span>
    </div>
  </div>
  <div class="section" style="display: flex; align-items: center; justify-content: center;">
    <div style="text-align: center;">
      <div style="font-size: 48px; font-weight: bold; color: #22c55e;" id="security-paid-percentage">--%</div>
      <div style="color: #94a3b8;">dos scans sao pagos <span class="info-tooltip" data-tooltip="Porcentagem de scans que geraram receita. Se muito baixo, pode indicar que o plano gratuito está muito generoso."></span></div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- FUNIL DE CONVERSÃO PRINCIPAL -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">Funil de Conversao - Security (90 dias) <span class="info-tooltip tooltip-left" data-tooltip="Funil geral do produto: mostra a jornada desde visitante até cliente pagante. Cada barra representa uma etapa e a queda entre elas mostra onde estamos perdendo usuários."></span></div>
  <div class="funnel-grid">
    <div class="funnel-chart-container">
      <div id="security-funnel-chart"></div>
    </div>
    <div class="funnel-stats">
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon visitor"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="security-funnel-visitors">--</div>
          <div class="funnel-stat-label">Visitantes <span class="info-tooltip" data-tooltip="Pessoas que acessaram o site. Vem do Umami Analytics."></span></div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon registered"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="security-funnel-registered">--</div>
          <div class="funnel-stat-label">Cadastrados <span class="info-tooltip" data-tooltip="Visitantes que criaram conta. Taxa de cadastro = Cadastrados / Visitantes."></span></div>
          <div class="funnel-stat-percent" id="security-funnel-reg-percent">--% dos visitantes</div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon trial"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="security-funnel-trial">--</div>
          <div class="funnel-stat-label">Em Trial <span class="info-tooltip" data-tooltip="Cadastrados que iniciaram período de teste. Mostra interesse real no produto."></span></div>
          <div class="funnel-stat-percent" id="security-funnel-trial-percent">--% dos cadastros</div>
        </div>
      </div>
      <div class="funnel-stat-card highlight">
        <div class="funnel-stat-icon paying"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="security-funnel-paying">--</div>
          <div class="funnel-stat-label">Pagantes <span class="info-tooltip" data-tooltip="Clientes que efetivamente pagaram. É o objetivo final do funil."></span></div>
          <div class="funnel-stat-percent" id="security-funnel-paying-percent">--% total</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- FUNIL DE SCAN DETALHADO (UMAMI) -->
<!-- Este funil mostra a jornada específica da página /trial -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <span>Funil de Scan - Detalhado</span>
    <span style="font-size: 12px; color: #94a3b8; font-weight: normal;">(Ultimos 30 dias - Umami)</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Este funil mostra a jornada do usuário na página /trial (scan gratuito). Os dados vêm do Umami Analytics que rastreia cliques e ações no site. Útil para identificar onde os visitantes estão abandonando."></span>
  </div>

  <div class="cards" style="margin-bottom: 16px;">
    <div class="card">
      <div class="card-title">Page Views <span class="info-tooltip" data-tooltip="Quantas pessoas abriram a página /trial. É o ponto de entrada do funil de scan gratuito."></span></div>
      <div class="card-value" id="scan-funnel-pageviews">--</div>
      <div class="card-subtitle">Acessos /scan</div>
    </div>
    <div class="card">
      <div class="card-title">Form Engagement <span class="info-tooltip" data-tooltip="Quantas pessoas começaram a preencher o formulário (clicaram em algum campo). Mostra interesse inicial no scan."></span></div>
      <div class="card-value" id="scan-funnel-engagement">--</div>
      <div class="card-subtitle" id="scan-funnel-engagement-pct">--% engajaram</div>
    </div>
    <div class="card">
      <div class="card-title">Scans Iniciados <span class="info-tooltip" data-tooltip="Quantas pessoas enviaram o formulário e iniciaram um scan. O scan começa a rodar no servidor."></span></div>
      <div class="card-value" id="scan-funnel-started" style="color: #3b82f6;">--</div>
      <div class="card-subtitle" id="scan-funnel-started-pct">--% iniciaram</div>
    </div>
    <div class="card highlight">
      <div class="card-title">Compras <span class="info-tooltip" data-tooltip="Quantas pessoas efetivamente pagaram após ver o resultado do scan. É a conversão final do funil."></span></div>
      <div class="card-value" id="scan-funnel-purchases" style="color: #22c55e;">--</div>
      <div class="card-subtitle" id="scan-funnel-purchases-pct">--% conversao</div>
    </div>
  </div>

  <div class="grid-2">
    <div>
      <div class="section-title" style="font-size: 14px;">Funil de Conversao <span class="info-tooltip" data-tooltip="Gráfico visual do funil. Cada barra representa uma etapa. A largura mostra a quantidade de pessoas naquela etapa."></span></div>
      <div id="scan-funnel-chart" style="height: 280px;"></div>
    </div>
    <div>
      <div class="section-title" style="font-size: 14px;">Pontos de Abandono <span class="info-tooltip tooltip-left" data-tooltip="Mostra ONDE os usuários estão desistindo. Cada linha mostra quantas pessoas abandonaram em cada etapa. Use isso para identificar problemas no fluxo."></span></div>
      <div id="scan-funnel-dropouts" style="max-height: 280px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>

  <div style="margin-top: 16px;">
    <div class="section-title" style="font-size: 14px;">Detalhes do Funil <span class="info-tooltip" data-tooltip="Métricas adicionais do funil para análise mais profunda."></span></div>
    <div class="grid-2">
      <div>
        <div class="metric-row">
          <span class="metric-label">Pagina de Pagamento <span class="info-tooltip" data-tooltip="Usuários que chegaram na página de pagamento. Se alto mas compras baixas, o problema está no checkout."></span></span>
          <span class="metric-value" id="scan-funnel-payment-page">--</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Iniciaram Checkout <span class="info-tooltip" data-tooltip="Usuários que clicaram para pagar. Se checkout alto mas compras baixas, pode ser problema de preço ou forma de pagamento."></span></span>
          <span class="metric-value" id="scan-funnel-checkout">--</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Erros de Email <span class="info-tooltip" data-tooltip="Tentativas com email inválido ou já cadastrado. Pode indicar bots ou problemas de UX no formulário."></span></span>
          <span class="metric-value" id="scan-funnel-email-errors" style="color: #f59e0b;">--</span>
        </div>
      </div>
      <div>
        <div class="metric-row">
          <span class="metric-label">Usuarios Existentes <span class="info-tooltip" data-tooltip="Pessoas que tentaram usar o trial mas já tinham conta. São potenciais upsells."></span></span>
          <span class="metric-value" id="scan-funnel-existing-users">--</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Clique Cadastro <span class="info-tooltip" data-tooltip="Cliques no botão 'Criar conta gratuita' após ver o resultado do scan."></span></span>
          <span class="metric-value" id="scan-funnel-register-click">--</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Erros de Scan <span class="info-tooltip" data-tooltip="Scans que falharam por erro técnico. Precisa investigar logs e corrigir. Cada erro é um potencial cliente perdido."></span></span>
          <span class="metric-value" id="scan-funnel-scan-errors" style="color: #ef4444;">--</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- FUNIL DE TRIAL - BANCO DE DADOS -->
<!-- Este funil mostra dados reais da tabela security_trial_sessions -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <span>Funil de Trial - Banco de Dados</span>
    <span style="font-size: 12px; color: #94a3b8; font-weight: normal;">(Dados reais)</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Este funil mostra dados reais da tabela security_trial_sessions. Diferente do funil Umami (baseado em eventos de tracking), este mostra o que realmente aconteceu no banco de dados."></span>
  </div>

  <div class="cards" style="margin-bottom: 16px;">
    <div class="card">
      <div class="card-title">Scans Iniciados <span class="info-tooltip" data-tooltip="Total de scans iniciados na página /trial. Cada linha na tabela security_trial_sessions representa um scan."></span></div>
      <div class="card-value" id="db-funnel-started">--</div>
      <div class="card-subtitle">Total de trials</div>
    </div>
    <div class="card">
      <div class="card-title">Completados <span class="info-tooltip" data-tooltip="Scans que terminaram com sucesso (status = completed). O usuário viu o resultado da análise."></span></div>
      <div class="card-value" id="db-funnel-completed">--</div>
      <div class="card-subtitle" id="db-funnel-completed-pct">--% dos iniciados</div>
    </div>
    <div class="card">
      <div class="card-title">Pagaram <span class="info-tooltip" data-tooltip="Usuários que pagaram após ver o resultado (payment_status = paid). Geram receita."></span></div>
      <div class="card-value" id="db-funnel-paid" style="color: #22c55e;">--</div>
      <div class="card-subtitle" id="db-funnel-paid-pct">--% dos completados</div>
    </div>
    <div class="card highlight">
      <div class="card-title">Registraram <span class="info-tooltip" data-tooltip="Usuários que pagaram E criaram conta (claimed_by_user_id preenchido). Conversão completa."></span></div>
      <div class="card-value" id="db-funnel-registered" style="color: #10b981;">--</div>
      <div class="card-subtitle" id="db-funnel-registered-pct">--% conversao total</div>
    </div>
  </div>

  <div class="grid-2">
    <div>
      <div class="section-title" style="font-size: 14px;">Funil de Conversao (DB) <span class="info-tooltip" data-tooltip="Visualização do funil com dados reais do banco. Cada barra mostra quantos usuários chegaram em cada etapa."></span></div>
      <div id="db-trial-funnel-chart" style="height: 280px;"></div>
    </div>
    <div>
      <div class="section-title" style="font-size: 14px;">Leads Quentes (Pagaram mas nao Registraram) <span class="info-tooltip tooltip-left" data-tooltip="Usuários que pagaram pelo scan mas ainda não criaram conta. São oportunidades de conversão - podem precisar de follow-up."></span></div>
      <div id="db-funnel-hot-leads" style="max-height: 280px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>

  <div class="grid-2" style="margin-top: 16px;">
    <div>
      <div class="section-title" style="font-size: 14px;">Leads Frios (Completaram mas nao Pagaram) <span class="info-tooltip" data-tooltip="Usuários que viram o resultado do scan mas não pagaram. Podem ter desistido pelo preço ou não viram valor suficiente."></span></div>
      <div id="db-funnel-cold-leads" style="max-height: 200px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
    <div>
      <div class="section-title" style="font-size: 14px;">Conversoes Recentes <span class="info-tooltip tooltip-left" data-tooltip="Últimos usuários que completaram a jornada: scan → pagamento → registro. Mostra atividade recente."></span></div>
      <div id="db-funnel-recent-conversions" style="max-height: 200px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>

  <div style="margin-top: 16px;">
    <div class="section-title" style="font-size: 14px;">Metricas de Tempo <span class="info-tooltip" data-tooltip="Quanto tempo em média os usuários levam entre cada etapa do funil."></span></div>
    <div class="grid-2">
      <div>
        <div class="metric-row">
          <span class="metric-label">Tempo medio para Pagar <span class="info-tooltip" data-tooltip="Horas em média entre o scan completar e o usuário pagar."></span></span>
          <span class="metric-value" id="db-funnel-time-to-pay">-- h</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Tempo medio para Registrar <span class="info-tooltip" data-tooltip="Horas em média entre o pagamento e a criação da conta."></span></span>
          <span class="metric-value" id="db-funnel-time-to-register">-- h</span>
        </div>
      </div>
      <div>
        <div class="metric-row">
          <span class="metric-label">Com Vulnerabilidades <span class="info-tooltip" data-tooltip="Scans que encontraram pelo menos uma vulnerabilidade. Esses convertem melhor pois o usuário vê valor."></span></span>
          <span class="metric-value" id="db-funnel-with-vulns">--</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Taxa de Vuln → Pagamento <span class="info-tooltip" data-tooltip="Porcentagem de scans com vulnerabilidades que resultaram em pagamento."></span></span>
          <span class="metric-value" id="db-funnel-vuln-conversion" style="color: #f59e0b;">--%</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================================= -->
<!-- LISTA DE TODOS OS SCANS (TRIAL + PAGOS) -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title" style="display: flex; align-items: center; justify-content: space-between;">
    <div style="display: flex; align-items: center; gap: 12px;">
      <span>Todos os Scans (<span id="all-scans-count">0</span>)</span>
      <span class="info-tooltip" data-tooltip="Lista completa de todos os scans executados (trial e pagos), do mais recente ao mais antigo. Inclui email, URLs escaneadas, tipo, status e datas."></span>
    </div>
    <button class="refresh-btn" onclick="loadAllScans(1)">Atualizar</button>
  </div>

  <div class="filters-row" style="margin-bottom: 16px;">
    <div class="filter-group">
      <label>Tipo</label>
      <select id="all-scans-type" onchange="loadAllScans(1)">
        <option value="">Todos</option>
        <option value="trial">Trial (Landing Page)</option>
        <option value="paid">Usuario Pago</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Status</label>
      <select id="all-scans-status" onchange="loadAllScans(1)">
        <option value="">Todos</option>
        <option value="pending">Pendente</option>
        <option value="scanning">Escaneando</option>
        <option value="completed">Completado</option>
        <option value="claimed">Resgatado</option>
        <option value="expired">Expirado</option>
        <option value="failed">Falhou</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Buscar</label>
      <input type="text" id="all-scans-search" placeholder="Email, URL, projeto..." onkeyup="debounceAllScansSearch()">
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Email</th>
          <th>Frontend URL</th>
          <th>Backend URL</th>
          <th>Projeto</th>
          <th>Status</th>
          <th>Pagamento</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="all-scans-table">
        <tr><td colspan="8" class="loading">Carregando...</td></tr>
      </tbody>
    </table>
  </div>
  <div class="pagination" id="all-scans-pagination"></div>
</div>

<!-- ============================================================================= -->
<!-- GRÁFICO DE CRESCIMENTO DE USUÁRIOS -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">Crescimento de Usuarios <span class="info-tooltip" data-tooltip="Gráfico mostrando novos usuários cadastrados por dia. Tendência de subida indica crescimento saudável."></span></div>
  <div id="securityChart" style="height: 250px;"></div>
</div>

<!-- ============================================================================= -->
<!-- TABELA DE ASSINANTES RECENTES -->
<!-- ============================================================================= -->
<div class="section">
  <div class="section-title">Assinantes Recentes <span class="info-tooltip" data-tooltip="Últimos usuários que assinaram um plano pago. Útil para acompanhar conversões em tempo real."></span></div>
  <table>
    <thead>
      <tr><th>Email</th><th>Plano</th><th>MRR</th><th>Status</th><th>Data</th></tr>
    </thead>
    <tbody id="security-table"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
  </table>
</div>

<!-- ============================================================================= -->
<!-- ACTIVITY LOG - Registro de atividades -->
<!-- ============================================================================= -->
<div class="section" style="margin-top: 24px;">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <span>Activity Log</span>
    <span style="font-size: 12px; color: #94a3b8; font-weight: normal;">(Ultimos 30 dias)</span>
    <span class="info-tooltip tooltip-left" data-tooltip="Registro de todas as ações feitas pelos usuários na plataforma: logins, scans, exports, etc. Útil para debug e análise de comportamento."></span>
  </div>

  <div class="cards" style="margin-bottom: 16px;">
    <div class="card">
      <div class="card-title">Total Atividades <span class="info-tooltip" data-tooltip="Soma de todas as ações registradas no período (logins, scans, exports, etc)."></span></div>
      <div class="card-value" id="security-activity-total">--</div>
      <div class="card-subtitle">No periodo</div>
    </div>
    <div class="card">
      <div class="card-title">Logins <span class="info-tooltip" data-tooltip="Logins bem-sucedidos. Indica engajamento e uso ativo da plataforma."></span></div>
      <div class="card-value" id="security-activity-logins" style="color: #22c55e;">--</div>
      <div class="card-subtitle">Acessos bem-sucedidos</div>
    </div>
    <div class="card">
      <div class="card-title">Logins Falhos <span class="info-tooltip" data-tooltip="Tentativas de login que falharam (senha errada, conta bloqueada, etc). Muitos de um mesmo IP pode indicar tentativa de invasão."></span></div>
      <div class="card-value" id="security-activity-failed-logins" style="color: #ef4444;">--</div>
      <div class="card-subtitle">Tentativas falhas</div>
    </div>
    <div class="card">
      <div class="card-title">Scans Iniciados <span class="info-tooltip" data-tooltip="Scans iniciados por usuários logados (não inclui trials da landing page)."></span></div>
      <div class="card-value" id="security-activity-scans">--</div>
      <div class="card-subtitle">Via activity log</div>
    </div>
  </div>

  <div class="section-title">Atividade por Dia <span class="info-tooltip" data-tooltip="Gráfico mostrando volume de atividades por dia. Picos podem indicar campanhas ou problemas."></span></div>
  <div id="securityActivityChart" style="height: 200px; margin-bottom: 24px;"></div>

  <div class="grid-2">
    <div>
      <div class="section-title" style="font-size: 14px;">Por Tipo de Acao <span class="info-tooltip" data-tooltip="Ranking das ações mais executadas. Mostra o que os usuários mais fazem na plataforma."></span></div>
      <div id="security-activity-by-action" style="max-height: 180px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
    <div>
      <div class="section-title" style="font-size: 14px;">Usuarios Mais Ativos <span class="info-tooltip tooltip-left" data-tooltip="Ranking dos usuários com mais ações no período. Útil para identificar power users e potenciais advocates."></span></div>
      <div id="security-activity-by-user" style="max-height: 180px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>

  <div style="margin-top: 24px;">
    <div class="section-title" style="font-size: 14px; display: flex; justify-content: space-between; align-items: center;">
      <span>Logins Falhos Recentes (24h) <span class="info-tooltip" data-tooltip="Tentativas de login que falharam nas últimas 24 horas. Monitore para detectar ataques de força bruta."></span></span>
      <span id="security-suspicious-ips" style="font-size: 12px; color: #f59e0b;"></span>
    </div>
    <div id="security-failed-logins-list" style="max-height: 160px; overflow-y: auto;">
      <div style="color: #64748b;">Carregando...</div>
    </div>
  </div>

  <div style="margin-top: 24px;">
    <div class="section-title" style="font-size: 14px;">Atividades Recentes <span class="info-tooltip" data-tooltip="Log das últimas 20 ações realizadas na plataforma em ordem cronológica."></span></div>
    <table>
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Acao</th>
          <th>Recurso</th>
          <th>IP</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="security-activity-table">
        <tr><td colspan="5" class="loading">Carregando...</td></tr>
      </tbody>
    </table>
  </div>
</div>
