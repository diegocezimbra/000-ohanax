<div class="header">
  <h2><span class="service-badge oentregador">OENTREGADOR</span> oEntregador</h2>
  <div class="header-actions">
    <div class="date-filter">
      <select id="oentregador-period" onchange="onPeriodChange('oentregador')">
        <option value="7">Ultimos 7 dias</option>
        <option value="30" selected>Ultimos 30 dias</option>
        <option value="90">Ultimos 90 dias</option>
        <option value="365">Ultimo ano</option>
        <option value="custom">Personalizado</option>
      </select>
      <div class="date-range-inputs" id="oentregador-custom-dates" style="display: none;">
        <input type="date" id="oentregador-start-date">
        <span>ate</span>
        <input type="date" id="oentregador-end-date">
      </div>
    </div>
    <button class="refresh-btn" onclick="loadProjectPage('oentregador')">Atualizar</button>
  </div>
</div>

<div class="cards">
  <div class="card highlight">
    <div class="card-title">MRR Total <span class="info-tooltip" data-tooltip="Monthly Recurring Revenue - Receita mensal recorrente do oEntregador. Soma de todas as assinaturas ativas de entregadores."></span></div>
    <div class="card-value" id="oentregador-mrr">R$ --</div>
    <div class="card-subtitle">Receita mensal recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Receita One-Time <span class="info-tooltip" data-tooltip="Receita de vendas unicas de pacotes avulsos do oEntregador. Pagamentos sem recorrencia."></span></div>
    <div class="card-value" id="oentregador-onetime-revenue">R$ --</div>
    <div class="card-subtitle">Pacotes vendidos</div>
  </div>
  <div class="card">
    <div class="card-title">Receita Total <span class="info-tooltip" data-tooltip="Soma total de receita do oEntregador: MRR (assinaturas) + One-Time (pacotes avulsos)."></span></div>
    <div class="card-value" id="oentregador-total-revenue">R$ --</div>
    <div class="card-subtitle">MRR + One-Time</div>
  </div>
  <div class="card">
    <div class="card-title">Usuarios Total <span class="info-tooltip tooltip-left" data-tooltip="Total de entregadores cadastrados no oEntregador. Inclui ativos, inativos e em trial."></span></div>
    <div class="card-value" id="oentregador-users">--</div>
    <div class="card-subtitle">Usuarios registrados</div>
  </div>
</div>

<div class="cards" style="margin-top: -10px;">
  <div class="card">
    <div class="card-title">ARR Total <span class="info-tooltip" data-tooltip="Annual Recurring Revenue - MRR x 12. Projecao anual da receita de assinaturas."></span></div>
    <div class="card-value" id="oentregador-arr">R$ --</div>
    <div class="card-subtitle">Receita anual recorrente</div>
  </div>
  <div class="card">
    <div class="card-title">Assinantes Ativos <span class="info-tooltip" data-tooltip="Entregadores com assinatura ativa pagando mensalmente pelo oEntregador."></span></div>
    <div class="card-value" id="oentregador-subs">--</div>
    <div class="card-subtitle">Assinantes pagantes</div>
  </div>
  <div class="card">
    <div class="card-title">Pacotes Vendidos <span class="info-tooltip" data-tooltip="Total de pacotes avulsos vendidos no oEntregador."></span></div>
    <div class="card-value" id="oentregador-onetime-count">--</div>
    <div class="card-subtitle">One-time pagos</div>
  </div>
  <div class="card">
    <div class="card-title">Clientes Unicos <span class="info-tooltip tooltip-left" data-tooltip="Entregadores unicos que pagaram pelo oEntregador (assinatura ou one-time)."></span></div>
    <div class="card-value" id="oentregador-unique-customers">--</div>
    <div class="card-subtitle">Assinantes + Compradores</div>
  </div>
</div>

<div class="grid-2">
  <div class="section">
    <div class="section-title">Usuarios <span class="info-tooltip" data-tooltip="Metricas de usuarios do oEntregador. Segmentacao por status."></span></div>
    <div class="metric-row">
      <span class="metric-label">Total <span class="info-tooltip" data-tooltip="Todos os entregadores cadastrados."></span></span>
      <span class="metric-value" id="oentregador-users-total">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Verificados <span class="info-tooltip" data-tooltip="Entregadores com email confirmado."></span></span>
      <span class="metric-value" id="oentregador-users-verified">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Ativos (7d) <span class="info-tooltip" data-tooltip="Entregadores que usaram o app nos ultimos 7 dias."></span></span>
      <span class="metric-value" id="oentregador-users-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Novos hoje <span class="info-tooltip" data-tooltip="Entregadores cadastrados hoje."></span></span>
      <span class="metric-value" id="oentregador-users-today">--</span>
    </div>
  </div>
  <div class="section">
    <div class="section-title">Assinaturas <span class="info-tooltip" data-tooltip="Metricas de assinaturas do oEntregador."></span></div>
    <div class="metric-row">
      <span class="metric-label">Ativos <span class="info-tooltip" data-tooltip="Assinaturas ativas - entregadores pagantes."></span></span>
      <span class="metric-value" id="oentregador-subs-active">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Em Trial <span class="info-tooltip" data-tooltip="Entregadores em periodo de teste gratuito."></span></span>
      <span class="metric-value" id="oentregador-subs-trial">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Cancelados <span class="info-tooltip" data-tooltip="Assinaturas canceladas (churn)."></span></span>
      <span class="metric-value" id="oentregador-subs-canceled">--</span>
    </div>
    <div class="metric-row">
      <span class="metric-label">Receita Total <span class="info-tooltip" data-tooltip="Soma de toda receita de assinaturas."></span></span>
      <span class="metric-value" id="oentregador-revenue">R$ --</span>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">Atividade de Hoje <span class="info-tooltip" data-tooltip="Metricas de uso do app hoje. Mostra engajamento real dos entregadores ativos."></span></div>
  <div class="grid-2">
    <div>
      <div class="metric-row" style="background: rgba(245, 158, 11, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
        <span class="metric-label" style="font-size: 16px;">Usuarios Ativos Hoje <span class="info-tooltip" data-tooltip="Entregadores que usaram o app hoje. Indica engajamento diario da base."></span></span>
        <span class="metric-value" id="oentregador-today-users" style="font-size: 28px; color: #f59e0b;">--</span>
      </div>
      <div class="metric-row" style="background: rgba(34, 197, 94, 0.1); padding: 16px; border-radius: 8px;">
        <span class="metric-label" style="font-size: 16px;">Itens Bipados Hoje <span class="info-tooltip" data-tooltip="Total de BRs (codigos de barras de pacotes) bipados hoje por todos os entregadores. Mostra volume de entregas."></span></span>
        <span class="metric-value" id="oentregador-today-bipados" style="font-size: 28px; color: #22c55e;">--</span>
      </div>
    </div>
    <div>
      <div style="font-size: 14px; color: #94a3b8; margin-bottom: 8px;">Bipados por Usuario (Hoje) <span class="info-tooltip" data-tooltip="Ranking de entregadores por quantidade de bipagens hoje. Mostra os mais produtivos."></span></div>
      <div id="oentregador-bipados-list" style="max-height: 140px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">BRs Bipados por Dia (Ultimos 30 dias) <span class="info-tooltip" data-tooltip="Grafico de bipagens diarias. BR = codigo de barras de pacote. Cada barra mostra total de pacotes processados naquele dia."></span></div>
  <div id="oentregadorBipadosChart" style="height: 280px;"></div>
</div>

<div class="section">
  <div class="section-title">Funil de Conversao - oEntregador (90 dias) <span class="info-tooltip" data-tooltip="Jornada do entregador: visitante -> cadastro -> trial -> pagante. Dados dos ultimos 90 dias."></span></div>
  <div class="funnel-grid">
    <div class="funnel-chart-container">
      <div id="oentregador-funnel-chart"></div>
    </div>
    <div class="funnel-stats">
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon visitor"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="oentregador-funnel-visitors">--</div>
          <div class="funnel-stat-label">Visitantes <span class="info-tooltip" data-tooltip="Visitantes unicos no site do oEntregador. Via Umami."></span></div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon registered"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="oentregador-funnel-registered">--</div>
          <div class="funnel-stat-label">Cadastrados <span class="info-tooltip" data-tooltip="Entregadores que criaram conta."></span></div>
          <div class="funnel-stat-percent" id="oentregador-funnel-reg-percent">--% dos visitantes</div>
        </div>
      </div>
      <div class="funnel-stat-card">
        <div class="funnel-stat-icon trial"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="oentregador-funnel-trial">--</div>
          <div class="funnel-stat-label">Em Trial <span class="info-tooltip" data-tooltip="Cadastrados que iniciaram trial."></span></div>
          <div class="funnel-stat-percent" id="oentregador-funnel-trial-percent">--% dos cadastros</div>
        </div>
      </div>
      <div class="funnel-stat-card highlight">
        <div class="funnel-stat-icon paying"></div>
        <div class="funnel-stat-info">
          <div class="funnel-stat-value" id="oentregador-funnel-paying">--</div>
          <div class="funnel-stat-label">Pagantes <span class="info-tooltip" data-tooltip="Entregadores pagantes - metrica principal."></span></div>
          <div class="funnel-stat-percent" id="oentregador-funnel-paying-percent">--% total</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="section">
  <div class="section-title">Crescimento de Usuarios <span class="info-tooltip" data-tooltip="Evolucao de novos cadastros de entregadores ao longo do tempo."></span></div>
  <div id="oentregadorChart" style="height: 250px;"></div>
</div>

<div class="section">
  <div class="section-title">Assinantes Recentes <span class="info-tooltip" data-tooltip="Lista das assinaturas mais recentes do oEntregador."></span></div>
  <table>
    <thead>
      <tr><th>Email</th><th>Plano</th><th>MRR</th><th>Status</th><th>Data</th></tr>
    </thead>
    <tbody id="oentregador-table"><tr><td colspan="5" class="loading">Carregando...</td></tr></tbody>
  </table>
</div>

<!-- ========================================== -->
<!-- SECAO DE AUDITORIA -->
<!-- ========================================== -->

<div class="section" style="margin-top: 30px; border-top: 2px solid #334155; padding-top: 30px;">
  <div class="section-title" style="display: flex; align-items: center; gap: 12px;">
    <span style="font-size: 20px;">üîç</span>
    Sistema de Auditoria <span class="info-tooltip" data-tooltip="Registro completo de todas as acoes no oEntregador. Usado para rastrear operacoes, identificar problemas e compliance."></span>
    <span style="font-size: 12px; background: #22c55e; color: white; padding: 4px 8px; border-radius: 4px; margin-left: auto;">NOVO</span>
  </div>

  <!-- Cards de Estatisticas de Auditoria -->
  <div class="cards" style="margin-top: 20px;">
    <div class="card">
      <div class="card-title">Total de Logs <span class="info-tooltip" data-tooltip="Total de eventos de auditoria nos ultimos 7 dias. Inclui todas as acoes do sistema."></span></div>
      <div class="card-value" id="audit-total-logs">--</div>
      <div class="card-subtitle">Ultimos 7 dias</div>
    </div>
    <div class="card" style="border-left: 3px solid #22c55e;">
      <div class="card-title">Sucesso <span class="info-tooltip" data-tooltip="Operacoes completadas com sucesso. Verde = saudavel."></span></div>
      <div class="card-value" id="audit-success" style="color: #22c55e;">--</div>
      <div class="card-subtitle">Operacoes bem-sucedidas</div>
    </div>
    <div class="card" style="border-left: 3px solid #f59e0b;">
      <div class="card-title">Falhas <span class="info-tooltip" data-tooltip="Operacoes que falharam (ex: erro de validacao). Amarelo = atencao."></span></div>
      <div class="card-value" id="audit-failure" style="color: #f59e0b;">--</div>
      <div class="card-subtitle">Operacoes com falha</div>
    </div>
    <div class="card" style="border-left: 3px solid #ef4444;">
      <div class="card-title">Erros <span class="info-tooltip tooltip-left" data-tooltip="Erros do sistema (ex: timeout, crash). Vermelho = investigar."></span></div>
      <div class="card-value" id="audit-error" style="color: #ef4444;">--</div>
      <div class="card-subtitle">Erros do sistema</div>
    </div>
  </div>

  <!-- Grid de Categorias e Top Users -->
  <div class="grid-2" style="margin-top: 20px;">
    <div class="section" style="background: #0f172a; padding: 20px; border-radius: 8px;">
      <div class="section-title" style="font-size: 14px; margin-bottom: 16px;">Eventos por Categoria <span class="info-tooltip" data-tooltip="Distribuicao de eventos por tipo de acao. Ajuda a entender o uso do sistema."></span></div>
      <div class="metric-row">
        <span class="metric-label">üîê Autenticacao <span class="info-tooltip" data-tooltip="Logins, logouts, sessoes, tokens."></span></span>
        <span class="metric-value" id="audit-cat-auth">--</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üì¶ Bipagem <span class="info-tooltip" data-tooltip="Leitura de codigos de barras de pacotes (BRs)."></span></span>
        <span class="metric-value" id="audit-cat-bipagem">--</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">‚öôÔ∏è Configuracao <span class="info-tooltip" data-tooltip="Alteracoes de configuracao do app ou usuario."></span></span>
        <span class="metric-value" id="audit-cat-config">--</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üîÑ Sincronizacao <span class="info-tooltip" data-tooltip="Sincronizacao de dados offline/online."></span></span>
        <span class="metric-value" id="audit-cat-sync">--</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üìù CRUD <span class="info-tooltip" data-tooltip="Criar, ler, atualizar, deletar registros."></span></span>
        <span class="metric-value" id="audit-cat-crud">--</span>
      </div>
      <div class="metric-row">
        <span class="metric-label">üíª Sistema <span class="info-tooltip" data-tooltip="Eventos do sistema (inicializacao, erros, etc)."></span></span>
        <span class="metric-value" id="audit-cat-system">--</span>
      </div>
    </div>

    <div class="section" style="background: #0f172a; padding: 20px; border-radius: 8px;">
      <div class="section-title" style="font-size: 14px; margin-bottom: 16px;">Usuarios Mais Ativos <span class="info-tooltip" data-tooltip="Ranking de entregadores por quantidade de eventos. Mostra os mais ativos no sistema."></span></div>
      <div id="audit-top-users" style="max-height: 220px; overflow-y: auto;">
        <div style="color: #64748b;">Carregando...</div>
      </div>
    </div>
  </div>

  <!-- Grafico de Timeline -->
  <div style="margin-top: 20px;">
    <div class="section-title" style="font-size: 14px; margin-bottom: 16px;">Atividade de Auditoria (Ultimos 30 dias) <span class="info-tooltip" data-tooltip="Grafico de eventos por dia. Picos podem indicar lancamentos, problemas ou aumento de uso."></span></div>
    <div id="auditTimelineChart" style="height: 280px;"></div>
  </div>

  <!-- Top Acoes -->
  <div class="section" style="background: #0f172a; padding: 20px; border-radius: 8px; margin-top: 20px;">
    <div class="section-title" style="font-size: 14px; margin-bottom: 16px;">Top 10 Acoes Registradas <span class="info-tooltip" data-tooltip="Acoes mais frequentes no sistema. Mostra o que os usuarios mais fazem."></span></div>
    <div id="audit-top-actions" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
      <div style="color: #64748b;">Carregando...</div>
    </div>
  </div>

  <!-- Tabela de Logs Recentes -->
  <div style="margin-top: 20px;">
    <div class="section-title" style="font-size: 14px; margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between;">
      <span>Logs Recentes <span class="info-tooltip" data-tooltip="Ultimos eventos de auditoria. Use os filtros para buscar eventos especificos."></span></span>
      <div style="display: flex; gap: 8px;">
        <select id="audit-filter-category" style="background: #1e293b; border: 1px solid #334155; padding: 6px 12px; border-radius: 4px; color: #f1f5f9; font-size: 12px;">
          <option value="">Todas Categorias</option>
          <option value="auth">Autenticacao</option>
          <option value="bipagem">Bipagem</option>
          <option value="config">Configuracao</option>
          <option value="sync">Sincronizacao</option>
          <option value="crud">CRUD</option>
          <option value="system">Sistema</option>
        </select>
        <select id="audit-filter-status" style="background: #1e293b; border: 1px solid #334155; padding: 6px 12px; border-radius: 4px; color: #f1f5f9; font-size: 12px;">
          <option value="">Todos Status</option>
          <option value="success">Sucesso</option>
          <option value="failure">Falha</option>
          <option value="error">Erro</option>
        </select>
        <button onclick="loadAuditLogs()" style="background: #3b82f6; border: none; padding: 6px 12px; border-radius: 4px; color: white; font-size: 12px; cursor: pointer;">Filtrar</button>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th style="width: 140px;">Data/Hora</th>
          <th>Acao</th>
          <th>Usuario</th>
          <th>Status</th>
          <th>Detalhes</th>
        </tr>
      </thead>
      <tbody id="audit-logs-table">
        <tr><td colspan="5" class="loading">Carregando...</td></tr>
      </tbody>
    </table>
    <div id="audit-pagination" style="display: flex; justify-content: center; gap: 8px; margin-top: 16px;"></div>
  </div>
</div>
